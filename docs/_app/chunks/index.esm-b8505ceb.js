import{_ as t,a as e,g as n,b as r,c as i,i as o,d as s,e as a,h as u,j as c,k as h,l,m as f,L as d,n as p,C as y,f as v}from"./index.esm-db6e4b98.js";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var g=function(t,e){return(g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function m(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var b,w="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},I=I||{},T=w||self;function E(){}function _(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function S(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var D="closure_uid_"+(1e9*Math.random()>>>0),N=0;function A(t,e,n){return t.call.apply(t.bind,arguments)}function k(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function C(t,e,n){return(C=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?A:k).apply(null,arguments)}function x(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function R(){return Date.now()}function O(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Kb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function P(){this.j=this.j,this.i=this.i}P.prototype.j=!1,P.prototype.ja=function(){var t;!this.j&&(this.j=!0,this.G(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,D)&&t[D]||(t[D]=++N))},P.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var L=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},M=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function F(t){return Array.prototype.concat.apply([],arguments)}function V(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function U(t){return/^[\s\xa0]*$/.test(t)}var q,B=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function j(t,e){return-1!=t.indexOf(e)}function K(t,e){return t<e?-1:t>e?1:0}t:{var G=T.navigator;if(G){var z=G.userAgent;if(z){q=z;break t}}q=""}function Q(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function H(t){var e={};for(var n in t)e[n]=t[n];return e}var W="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Y(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<W.length;o++)n=W[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function X(t){return X[" "](t),t}X[" "]=E;var $,J,Z=j(q,"Opera"),tt=j(q,"Trident")||j(q,"MSIE"),et=j(q,"Edge"),nt=et||tt,rt=j(q,"Gecko")&&!(j(q.toLowerCase(),"webkit")&&!j(q,"Edge"))&&!(j(q,"Trident")||j(q,"MSIE"))&&!j(q,"Edge"),it=j(q.toLowerCase(),"webkit")&&!j(q,"Edge");function ot(){var t=T.document;return t?t.documentMode:void 0}t:{var st="",at=(J=q,rt?/rv:([^\);]+)(\)|;)/.exec(J):et?/Edge\/([\d\.]+)/.exec(J):tt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(J):it?/WebKit\/(\S+)/.exec(J):Z?/(?:Version)[ \/]?(\S+)/.exec(J):void 0);if(at&&(st=at?at[1]:""),tt){var ut=ot();if(null!=ut&&ut>parseFloat(st)){$=String(ut);break t}}$=st}var ct,ht={};function lt(t){return function(t,e){var n=ht;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,(function(){for(var e=0,n=B(String($)).split("."),r=B(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var s=n[o]||"",a=r[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==s[0].length&&0==a[0].length)break;e=K(0==s[1].length?0:parseInt(s[1],10),0==a[1].length?0:parseInt(a[1],10))||K(0==s[2].length,0==a[2].length)||K(s[2],a[2]),s=s[3],a=a[3]}while(0==e)}return 0<=e}))}if(T.document&&tt){var ft=ot();ct=ft||(parseInt($,10)||void 0)}else ct=void 0;var dt=ct,pt=!tt||9<=Number(dt),yt=tt&&!lt("9"),vt=function(){if(!T.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{T.addEventListener("test",E,e),T.removeEventListener("test",E,e)}catch(n){}return t}();function gt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function mt(t,e){if(gt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(rt){t:{try{X(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:bt[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}gt.prototype.b=function(){this.defaultPrevented=!0},O(mt,gt);var bt={2:"touch",3:"pen",4:"mouse"};mt.prototype.b=function(){mt.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,yt)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(e){}};var wt="closure_listenable_"+(1e6*Math.random()|0),It=0;function Tt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++It,this.Y=this.Z=!1}function Et(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function _t(t){this.src=t,this.a={},this.b=0}function St(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=L(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(Et(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function Dt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}_t.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Dt(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new Tt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Nt="closure_lm_"+(1e6*Math.random()|0),At={};function kt(t,e,n,r,i){if(r&&r.once)return xt(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)kt(t,e[o],n,r,i);return null}return n=Ut(n),t&&t[wt]?t.va(e,n,S(r)?!!r.capture:!!r,i):Ct(t,e,n,!1,r,i)}function Ct(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=S(i)?!!i.capture:!!i;if(s&&!pt)return null;var a=Ft(t);if(a||(t[Nt]=a=new _t(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=Mt,e=pt?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)vt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Pt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function xt(t,e,n,r,i){if(Array.isArray(e)){for(var o=0;o<e.length;o++)xt(t,e[o],n,r,i);return null}return n=Ut(n),t&&t[wt]?t.wa(e,n,S(r)?!!r.capture:!!r,i):Ct(t,e,n,!0,r,i)}function Rt(t,e,n,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)Rt(t,e[o],n,r,i);else r=S(r)?!!r.capture:!!r,n=Ut(n),t&&t[wt]?(t=t.c,(e=String(e).toString())in t.a&&(-1<(n=Dt(o=t.a[e],n,r,i))&&(Et(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--)))):t&&(t=Ft(t))&&(e=t.a[e.toString()],t=-1,e&&(t=Dt(e,n,r,i)),(n=-1<t?e[t]:null)&&Ot(n))}function Ot(t){if("number"!=typeof t&&t&&!t.Y){var e=t.src;if(e&&e[wt])St(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Pt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ft(e))?(St(n,t),0==n.b&&(n.src=null,e[Nt]=null)):Et(t)}}}function Pt(t){return t in At?At[t]:At[t]="on"+t}function Lt(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&Ot(t),n.call(r,e)}function Mt(t,e){if(t.Y)return!0;if(!pt){if(!e)t:{e=["window","event"];for(var n=T,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Lt(t,e=new mt(e,this))}return Lt(t,new mt(e,this))}function Ft(t){return(t=t[Nt])instanceof _t?t:null}var Vt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ut(t){return"function"==typeof t?t:(t[Vt]||(t[Vt]=function(e){return t.handleEvent(e)}),t[Vt])}function qt(){P.call(this),this.c=new _t(this),this.J=this,this.C=null}function Bt(t,e){var n,r=t.C;if(r)for(n=[];r;r=r.C)n.push(r);if(t=t.J,r=e.type||e,"string"==typeof e)e=new gt(e,t);else if(e instanceof gt)e.target=e.target||t;else{var i=e;Y(e=new gt(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.a=n[o];i=jt(s,r,!0,e)&&i}if(i=jt(s=e.a=t,r,!0,e)&&i,i=jt(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=jt(s=e.a=n[o],r,!1,e)&&i}function jt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.Y&&s.capture==n){var a=s.listener,u=s.ca||s.src;s.Z&&St(t.c,s),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}O(qt,P),qt.prototype[wt]=!0,(b=qt.prototype).addEventListener=function(t,e,n,r){kt(this,t,e,n,r)},b.removeEventListener=function(t,e,n,r){Rt(this,t,e,n,r)},b.G=function(){if(qt.X.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Et(n[r]);delete e.a[t],e.b--}}this.C=null},b.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},b.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Kt=T.JSON.stringify;function Gt(){this.b=this.a=null}var zt,Qt=new(function(){function t(t,e){this.c=t,this.f=e,this.b=0,this.a=null}return t.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},t}())((function(){return new Wt}),(function(t){t.reset()}));function Ht(){var t=Jt,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function Wt(){this.next=this.b=this.a=null}function Yt(t){T.setTimeout((function(){throw t}),0)}function Xt(t,e){zt||function(){var t=T.Promise.resolve(void 0);zt=function(){t.then(Zt)}}(),$t||(zt(),$t=!0),Jt.add(t,e)}Gt.prototype.add=function(t,e){var n=Qt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Wt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},Wt.prototype.reset=function(){this.next=this.b=this.a=null};var $t=!1,Jt=new Gt;function Zt(){for(var t;t=Ht();){try{t.a.call(t.b)}catch(n){Yt(n)}var e=Qt;e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}$t=!1}function te(t,e){qt.call(this),this.b=t||1,this.a=e||T,this.f=C(this.Za,this),this.g=R()}function ee(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function ne(t,e,n){if("function"==typeof t)n&&(t=C(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=C(t.handleEvent,t)}return 2147483647<Number(e)?-1:T.setTimeout(t,e||0)}function re(t){t.a=ne((function(){t.a=null,t.c&&(t.c=!1,re(t))}),t.h);var e=t.b;t.b=null,t.g.apply(null,e)}O(te,qt),(b=te.prototype).aa=!1,b.M=null,b.Za=function(){if(this.aa){var t=R()-this.g;0<t&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),Bt(this,"tick"),this.aa&&(ee(this),this.start()))}},b.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=R())},b.G=function(){te.X.G.call(this),ee(this),delete this.a};var ie=function(t){function e(e,n){var r=t.call(this)||this;return r.g=e,r.h=n,r.b=null,r.c=!1,r.a=null,r}return function(t,e){function n(){this.constructor=t}g(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:re(this)},e.prototype.G=function(){t.prototype.G.call(this),this.a&&(T.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},e}(P);function oe(t){P.call(this),this.b=t,this.a={}}O(oe,P);var se=[];function ae(t,e,n,r){Array.isArray(n)||(n&&(se[0]=n.toString()),n=se);for(var i=0;i<n.length;i++){var o=kt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function ue(t){Q(t.a,(function(t,e){this.a.hasOwnProperty(e)&&Ot(t)}),t),t.a={}}function ce(){this.a=!0}function he(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return Kt(n)}catch(a){return e}}(t,n)+(r?" "+r:"")}))}oe.prototype.G=function(){oe.X.G.call(this),ue(this)},oe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ce.prototype.info=function(){};var le={},fe=null;function de(){return fe=fe||new qt}function pe(t){gt.call(this,le.Fa,t)}function ye(t){var e=de();Bt(e,new pe(e,t))}function ve(t,e){gt.call(this,le.STAT_EVENT,t),this.stat=e}function ge(t){var e=de();Bt(e,new ve(e,t))}function me(t){gt.call(this,le.Ga,t)}function be(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return T.setTimeout((function(){t()}),e)}le.Fa="serverreachability",O(pe,gt),le.STAT_EVENT="statevent",O(ve,gt),le.Ga="timingevent",O(me,gt);var we={NO_ERROR:0,$a:1,nb:2,mb:3,hb:4,lb:5,ob:6,Da:7,TIMEOUT:8,rb:9},Ie={fb:"complete",Bb:"success",Ea:"error",Da:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",ib:"downloadprogress",Jb:"uploadprogress"};function Te(){}function Ee(t){var e;return(e=t.a)||(e=t.a={}),e}function _e(){}Te.prototype.a=null;var Se,De={OPEN:"a",eb:"b",Ea:"c",qb:"d"};function Ne(){gt.call(this,"d")}function Ae(){gt.call(this,"c")}function ke(){}function Ce(t,e,n,r){this.g=t,this.c=e,this.f=n,this.S=r||1,this.J=new oe(this),this.P=xe,t=nt?125:void 0,this.R=new te(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}O(Ne,gt),O(Ae,gt),O(ke,Te),Se=new ke;var xe=45e3,Re={},Oe={};function Pe(t,e,n){t.H=1,t.i=nn(Xe(e)),t.j=n,t.I=!0,Le(t,null)}function Le(t,e){t.u=R(),Ve(t),t.l=Xe(t.i);var n=t.l,r=t.S;Array.isArray(r)||(r=[String(r)]),vn(n.b,"t",r),t.D=0,t.a=hr(t.g,t.g.C?e:null),0<t.O&&(t.F=new ie(C(t.Ca,t,t.a),t.O)),ae(t.J,t.a,"readystatechange",t.Xa),e=t.B?H(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),ye(1),function(t,e,n,r,i,o){t.info((function(){if(t.a)if(o)for(var s="",a=o.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&"type"==l[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s}))}(t.c,t.m,t.l,t.f,t.S,t.j)}function Me(t,e,n){for(var r=!0;!t.A&&t.D<n.length;){var i=Fe(t,n);if(i==Oe){4==e&&(t.h=4,ge(14),r=!1),he(t.c,t.f,null,"[Incomplete Response]");break}if(i==Re){t.h=4,ge(15),he(t.c,t.f,n,"[Invalid Chunk]"),r=!1;break}he(t.c,t.f,i,null),Ke(t,i)}4==e&&0==n.length&&(t.h=1,ge(16),r=!1),t.b=t.b&&r,r?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),nr(e),e.F=!0,ge(11))):(he(t.c,t.f,n,"[Invalid Chunked Response]"),je(t),Be(t))}function Fe(t,e){var n=t.D,r=e.indexOf("\n",n);return-1==r?Oe:(n=Number(e.substring(n,r)),isNaN(n)?Re:(r+=1)+n>e.length?Oe:(e=e.substr(r,n),t.D=r+n,e))}function Ve(t){t.T=R()+t.P,Ue(t,t.P)}function Ue(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=be(C(t.Va,t),e)}function qe(t){t.o&&(T.clearTimeout(t.o),t.o=null)}function Be(t){0==t.g.v||t.A||or(t.g,t)}function je(t){qe(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,ee(t.R),ue(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function Ke(t,e){try{var n=t.g;if(0!=n.v&&(n.a==t||En(n.b,t)))if(n.I=t.N,!t.C&&En(n.b,t)&&3==n.v){try{var r=n.ka.a.parse(e)}catch(v){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.j){if(n.a){if(!(n.a.u+3e3<t.u))break t;ir(n),Hn(n)}er(n),ge(18)}}else n.oa=i[1],0<n.oa-n.P&&37500>i[2]&&n.H&&0==n.o&&!n.m&&(n.m=be(C(n.Sa,n),6e3));if(1>=Tn(n.b)&&n.ea){try{n.ea()}catch(v){}n.ea=void 0}}else ar(n,11)}else if((t.C||n.a==t)&&ir(n),!U(e))for(e=r=n.ka.a.parse(e),r=0;r<e.length;r++)if(i=e[r],n.P=i[0],i=i[1],2==n.v)if("c"==i[0]){n.J=i[1],n.ga=i[2];var o=i[3];null!=o&&(n.ha=o,n.c.info("VER="+n.ha));var s=i[4];null!=s&&(n.pa=s,n.c.info("SVER="+n.pa));var a=i[5];if(null!=a&&"number"==typeof a&&0<a){var u=1.5*a;n.D=u,n.c.info("backChannelRequestTimeoutMs_="+u)}u=n;var c=t.a;if(c){var h=c.a?c.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=u.b;!l.a&&(j(h,"spdy")||j(h,"quic")||j(h,"h2"))&&(l.f=l.g,l.a=new Set,l.b&&(_n(l,l.b),l.b=null))}if(u.A){var f=c.a?c.a.getResponseHeader("X-HTTP-Session-Id"):null;f&&(u.na=f,en(u.B,u.A,f))}}n.v=3,n.f&&n.f.ta(),n.U&&(n.N=R()-t.u,n.c.info("Handshake RTT: "+n.N+"ms"));var d=t;if((u=n).la=cr(u,u.C?u.ga:null,u.fa),d.C){Sn(u.b,d);var p=d,y=u.D;y&&p.setTimeout(y),p.o&&(qe(p),Ve(p)),u.a=d}else tr(u);0<n.g.length&&Xn(n)}else"stop"!=i[0]&&"close"!=i[0]||ar(n,7);else 3==n.v&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?ar(n,7):Qn(n):"noop"!=i[0]&&n.f&&n.f.sa(i),n.o=0);ye(4)}catch(v){}}function Ge(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(_(t)||"string"==typeof t)M(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(_(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(_(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function ze(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof ze)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Qe(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];He(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)He(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function He(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(b=Ce.prototype).setTimeout=function(t){this.P=t},b.Xa=function(t){t=t.target;var e=this.F;e&&3==jn(t)?e.f():this.Ca(t)},b.Ca=function(t){try{if(t==this.a)t:{var e=jn(this.a),n=this.a.ua(),r=this.a.W();if(!(3>e||3==e&&!nt&&!this.a.$())){this.A||4!=e||7==n||ye(8==n||0>=r?3:2),qe(this);var i=this.a.W();this.N=i;var o=this.a.$();if(this.b=200==i,function(t,e,n,r,i,o,s){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s}))}(this.c,this.m,this.l,this.f,this.S,e,i),this.b){if(this.U&&!this.C){e:{if(this.a){var s,a=this.a;if((s=a.a?a.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!U(s)){var u=s;break e}}u=null}if(!u){this.b=!1,this.h=3,ge(12),je(this),Be(this);break t}he(this.c,this.f,u,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Ke(this,u)}this.I?(Me(this,e,o),nt&&this.b&&3==e&&(ae(this.J,this.R,"tick",this.Wa),this.R.start())):(he(this.c,this.f,o,null),Ke(this,o)),4==e&&je(this),this.b&&!this.A&&(4==e?or(this.g,this):(this.b=!1,Ve(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.h=3,ge(12)):(this.h=0,ge(13)),je(this),Be(this)}}}catch(c){}},b.Wa=function(){if(this.a){var t=jn(this.a),e=this.a.$();this.D<e.length&&(qe(this),Me(this,t,e),this.b&&4!=t&&Ve(this))}},b.cancel=function(){this.A=!0,je(this)},b.Va=function(){this.o=null;var t=R();0<=t-this.T?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.c,this.l),2!=this.H&&(ye(3),ge(17)),je(this),this.h=2,Be(this)):Ue(this,this.T-t)},(b=ze.prototype).K=function(){Qe(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},b.L=function(){return Qe(this),this.a.concat()},b.get=function(t,e){return He(this.b,t)?this.b[t]:e},b.set=function(t,e){He(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},b.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var We=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ye(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Ye){this.a=void 0!==e?e:t.a,$e(this,t.f),this.j=t.j,Je(this,t.c),Ze(this,t.h),this.g=t.g,e=t.b;var n=new fn;n.c=e.c,e.a&&(n.a=new ze(e.a),n.b=e.b),tn(this,n),this.i=t.i}else t&&(n=String(t).match(We))?(this.a=!!e,$e(this,n[1]||"",!0),this.j=rn(n[2]||""),Je(this,n[3]||"",!0),Ze(this,n[4]),this.g=rn(n[5]||"",!0),tn(this,n[6]||"",!0),this.i=rn(n[7]||"")):(this.a=!!e,this.b=new fn(null,this.a))}function Xe(t){return new Ye(t)}function $e(t,e,n){t.f=n?rn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Je(t,e,n){t.c=n?rn(e,!0):e}function Ze(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.h=e}else t.h=null}function tn(t,e,n){e instanceof fn?(t.b=e,function(t,e){e&&!t.f&&(dn(t),t.c=null,t.a.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(pn(this,e),vn(this,n,t))}),t)),t.f=e}(t.b,t.a)):(n||(e=on(e,hn)),t.b=new fn(e,t.a))}function en(t,e,n){t.b.set(e,n)}function nn(t){return en(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^R()).toString(36)),t}function rn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function on(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,sn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function sn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ye.prototype.toString=function(){var t=[],e=this.f;e&&t.push(on(e,an,!0),":");var n=this.c;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(on(e,an,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(on(n,"/"==n.charAt(0)?cn:un,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",on(n,ln)),t.join("")};var an=/[#\/\?@]/g,un=/[#\?:]/g,cn=/[#\?]/g,hn=/[#\?@]/g,ln=/#/g;function fn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function dn(t){t.a||(t.a=new ze,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function pn(t,e){dn(t),e=gn(t,e),He(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,He((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Qe(t)))}function yn(t,e){return dn(t),e=gn(t,e),He(t.a.b,e)}function vn(t,e,n){pn(t,e),0<n.length&&(t.c=null,t.a.set(gn(t,e),V(n)),t.b+=n.length)}function gn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(b=fn.prototype).add=function(t,e){dn(this),this.c=null,t=gn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},b.forEach=function(t,e){dn(this),this.a.forEach((function(n,r){M(n,(function(n){t.call(e,n,r,this)}),this)}),this)},b.L=function(){dn(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},b.K=function(t){dn(this);var e=[];if("string"==typeof t)yn(this,t)&&(e=F(e,this.a.get(gn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=F(e,t[n])}return e},b.set=function(t,e){return dn(this),this.c=null,yn(this,t=gn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},b.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},b.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.K(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")};var mn=function(t,e){this.b=t,this.a=e};function bn(t){this.g=t||wn,T.PerformanceNavigationTiming?t=0<(t=T.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(T.ia&&T.ia.ya&&T.ia.ya()&&T.ia.ya().Lb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var wn=10;function In(t){return!!t.b||!!t.a&&t.a.size>=t.f}function Tn(t){return t.b?1:t.a?t.a.size:0}function En(t,e){return t.b?t.b==e:!!t.a&&t.a.has(e)}function _n(t,e){t.a?t.a.add(e):t.b=e}function Sn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function Dn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null!=t.a&&0!==t.a.size){var r=t.c;try{for(var i=m(t.a.values()),o=i.next();!o.done;o=i.next()){var s=o.value;r=r.concat(s.s)}}catch(a){e={error:a}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return V(t.c)}function Nn(){}function An(){this.a=new Nn}function kn(t,e,n){var r=n||"";try{Ge(t,(function(t,n){var i=t;S(t)&&(i=Kt(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(_d){throw e.push(r+"type="+encodeURIComponent("_badmap")),_d}}function Cn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}bn.prototype.cancel=function(){var t,e;if(this.c=Dn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=m(this.a.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(i){t={error:i}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},Nn.prototype.stringify=function(t){return T.JSON.stringify(t,void 0)},Nn.prototype.parse=function(t){return T.JSON.parse(t,void 0)};var xn=T.JSON.parse;function Rn(t){qt.call(this),this.headers=new ze,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=On,this.D=this.F=!1}O(Rn,qt);var On="",Pn=/^https?$/i,Ln=["POST","PUT"];function Mn(t){return"content-type"==t.toLowerCase()}function Fn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Vn(t),qn(t)}function Vn(t){t.u||(t.u=!0,Bt(t,"complete"),Bt(t,"error"))}function Un(t){if(t.b&&void 0!==I&&(!t.s[1]||4!=jn(t)||2!=t.W()))if(t.l&&4==jn(t))ne(t.za,0,t);else if(Bt(t,"readystatechange"),4==jn(t)){t.b=!1;try{var e,n=t.W();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.B).match(We)[1]||null;if(!o&&T.self&&T.self.location){var s=T.self.location.protocol;o=s.substr(0,s.length-1)}i=!Pn.test(o?o.toLowerCase():"")}e=i}if(e)Bt(t,"complete"),Bt(t,"success");else{t.h=6;try{var a=2<jn(t)?t.a.statusText:""}catch(u){a=""}t.f=a+" ["+t.W()+"]",Vn(t)}}finally{qn(t)}}}function qn(t,e){if(t.a){Bn(t);var n=t.a,r=t.s[0]?E:null;t.a=null,t.s=null,e||Bt(t,"ready");try{n.onreadystatechange=r}catch(_d){}}}function Bn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(T.clearTimeout(t.m),t.m=null)}function jn(t){return t.a?t.a.readyState:0}function Kn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return Q(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):en(t,e,n))}function Gn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function zn(t){this.pa=0,this.g=[],this.c=new ce,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Oa=this.R=0,this.La=Gn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Ha=Gn("baseRetryDelayMs",5e3,t),this.Ra=Gn("retryDelaySeedMs",1e4,t),this.Ma=Gn("forwardChannelMaxRetries",2,t),this.ma=Gn("forwardChannelRequestTimeoutMs",2e4,t),this.Na=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new bn(t&&t.concurrentRequestLimit),this.ka=new An,this.da=t&&t.fastHandshake||!1,this.Ia=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&t&&t.detectBufferingProxy||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ka=t&&t.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function Qn(t){if(Wn(t),3==t.v){var e=t.R++,n=Xe(t.B);en(n,"SID",t.J),en(n,"RID",e),en(n,"TYPE","terminate"),Jn(t,n),(e=new Ce(t,t.c,e,void 0)).H=2,e.i=nn(Xe(n)),n=!1,T.navigator&&T.navigator.sendBeacon&&(n=T.navigator.sendBeacon(e.i.toString(),"")),!n&&T.Image&&((new Image).src=e.i,n=!0),n||(e.a=hr(e.g,null),e.a.ba(e.i)),e.u=R(),Ve(e)}ur(t)}function Hn(t){t.a&&(nr(t),t.a.cancel(),t.a=null)}function Wn(t){Hn(t),t.j&&(T.clearTimeout(t.j),t.j=null),ir(t),t.b.cancel(),t.h&&("number"==typeof t.h&&T.clearTimeout(t.h),t.h=null)}function Yn(t,e){t.g.push(new mn(t.Oa++,e)),3==t.v&&Xn(t)}function Xn(t){In(t.b)||t.h||(t.h=!0,Xt(t.Ba,t),t.u=0)}function $n(t,e){var n;n=e?e.f:t.R++;var r=Xe(t.B);en(r,"SID",t.J),en(r,"RID",n),en(r,"AID",t.P),Jn(t,r),t.i&&t.l&&Kn(r,t.i,t.l),n=new Ce(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=Zn(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),_n(t.b,n),Pe(n,r,e)}function Jn(t,e){t.f&&Ge({},(function(t,n){en(e,n,t)}))}function Zn(t,e,n){n=Math.min(t.g.length,n);var r=t.f?C(t.f.Ja,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if(0>(c-=o))o=Math.max(0,i[u].b-100),a=!1;else try{kn(h,s,"req"+c+"_")}catch(l){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function tr(t){t.a||t.j||(t.T=1,Xt(t.Aa,t),t.o=0)}function er(t){return!(t.a||t.j||3<=t.o)&&(t.T++,t.j=be(C(t.Aa,t),sr(t,t.o)),t.o++,!0)}function nr(t){null!=t.s&&(T.clearTimeout(t.s),t.s=null)}function rr(t){t.a=new Ce(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=Xe(t.la);en(e,"RID","rpc"),en(e,"SID",t.J),en(e,"CI",t.H?"0":"1"),en(e,"AID",t.P),Jn(t,e),en(e,"TYPE","xmlhttp"),t.i&&t.l&&Kn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=nn(Xe(e)),n.j=null,n.I=!0,Le(n,t)}function ir(t){null!=t.m&&(T.clearTimeout(t.m),t.m=null)}function or(t,e){var n=null;if(t.a==e){ir(t),nr(t),t.a=null;var r=2}else{if(!En(t.b,e))return;n=e.s,Sn(t.b,e),r=1}if(t.I=e.N,0!=t.v)if(e.b)if(1==r){n=e.j?e.j.length:0,e=R()-e.u;var i=t.u;Bt(r=de(),new me(r,n,e,i)),Xn(t)}else tr(t);else if(3==(i=e.h)||0==i&&0<t.I||!(1==r&&function(t,e){return!(Tn(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.g=e.s.concat(t.g),0):1==t.v||2==t.v||t.u>=(t.La?0:t.Ma)||(t.h=be(C(t.Ba,t,e),sr(t,t.u)),t.u++,0)))}(t,e)||2==r&&er(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:ar(t,5);break;case 4:ar(t,10);break;case 3:ar(t,6);break;default:ar(t,2)}}function sr(t,e){var n=t.Ha+Math.floor(Math.random()*t.Ra);return t.f||(n*=2),n*e}function ar(t,e){if(t.c.info("Error code "+e),2==e){var n=null;t.f&&(n=null);var r=C(t.Ya,t);n||(n=new Ye("//www.google.com/images/cleardot.gif"),T.location&&"http"==T.location.protocol||$e(n,"https"),nn(n)),function(t,e){var n=new ce;if(T.Image){var r=new Image;r.onload=x(Cn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=x(Cn,n,r,"TestLoadImage: error",!1,e),r.onabort=x(Cn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=x(Cn,n,r,"TestLoadImage: timeout",!1,e),T.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else ge(2);t.v=0,t.f&&t.f.ra(e),ur(t),Wn(t)}function ur(t){t.v=0,t.I=-1,t.f&&(0==Dn(t.b).length&&0==t.g.length||(t.b.c.length=0,V(t.g),t.g.length=0),t.f.qa())}function cr(t,e,n){var r=function(t){return t instanceof Ye?Xe(t):new Ye(t,void 0)}(n);if(""!=r.c)e&&Je(r,e+"."+r.c),Ze(r,r.h);else{var i=T.location;r=function(t,e,n,r){var i=new Ye(null,void 0);return t&&$e(i,t),e&&Je(i,e),n&&Ze(i,n),r&&(i.g=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.V&&Q(t.V,(function(t,e){en(r,e,t)})),e=t.A,n=t.na,e&&n&&en(r,e,n),en(r,"VER",t.ha),Jn(t,r),r}function hr(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Rn(t.Na)).F=t.C,e}function lr(){}function fr(){if(tt&&!(10<=Number(dt)))throw Error("Environmental error: no available transport.")}function dr(t,e){qt.call(this),this.a=new zn(e),this.o=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!U(t)&&(this.a.i=t),this.m=e&&e.supportsCrossDomainXhr||!1,this.l=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!U(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new vr(this)}function pr(t){Ne.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function yr(){Ae.call(this),this.status=1}function vr(t){this.a=t}(b=Rn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?Ee(this.H):Ee(Se),this.a.onreadystatechange=C(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(o){return void Fn(this,o)}t=n||"";var i=new ze(this.headers);r&&Ge(r,(function(t,e){i.set(e,t)})),r=function(t){t:{for(var e=Mn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.L()),n=T.FormData&&t instanceof T.FormData,!(0<=L(Ln,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(t,e){this.a.setRequestHeader(e,t)}),this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Bn(this),0<this.o&&((this.D=function(t){return tt&&lt(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=C(this.xa,this)):this.m=ne(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(o){Fn(this,o)}},b.xa=function(){void 0!==I&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,Bt(this,"timeout"),this.abort(8))},b.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,Bt(this,"complete"),Bt(this,"abort"),qn(this))},b.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),qn(this,!0)),Rn.X.G.call(this)},b.za=function(){this.j||(this.A||this.l||this.g?Un(this):this.Ua())},b.Ua=function(){Un(this)},b.W=function(){try{return 2<jn(this)?this.a.status:-1}catch(J){return-1}},b.$=function(){try{return this.a?this.a.responseText:""}catch(J){return""}},b.Pa=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),xn(e)}},b.ua=function(){return this.h},b.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(b=zn.prototype).ha=8,b.v=1,b.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new Ce(this,this.c,t,void 0),r=this.l;if(this.O&&(r?Y(r=H(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if(void 0===(o="__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Zn(this,n,e),en(i=Xe(this.B),"RID",t),en(i,"CVER",22),this.A&&en(i,"X-HTTP-Session-Id",this.A),Jn(this,i),this.i&&r&&Kn(i,this.i,r),_n(this.b,n),this.Ia&&en(i,"TYPE","init"),this.da?(en(i,"$req",e),en(i,"SID","null"),n.U=!0,Pe(n,i,null)):Pe(n,i,e),this.v=2}}else 3==this.v&&(t?$n(this,t):0==this.g.length||In(this.b)||$n(this))},b.Aa=function(){if(this.j=null,rr(this),this.U&&!(this.F||null==this.a||0>=this.N)){var t=2*this.N;this.c.info("BP detection timer enabled: "+t),this.s=be(C(this.Ta,this),t)}},b.Ta=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,ge(10),Hn(this),rr(this))},b.Sa=function(){null!=this.m&&(this.m=null,Hn(this),er(this),ge(19))},b.Ya=function(t){t?(this.c.info("Successfully pinged google.com"),ge(2)):(this.c.info("Failed to ping google.com"),ge(1))},(b=lr.prototype).ta=function(){},b.sa=function(){},b.ra=function(){},b.qa=function(){},b.Ja=function(){},fr.prototype.a=function(t,e){return new dr(t,e)},O(dr,qt),dr.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var t=this.a,e=this.o,n=this.b||void 0;ge(0),t.fa=e,t.V=n||{},t.H=t.S,t.B=cr(t,null,t.fa),Xn(t)},dr.prototype.close=function(){Qn(this.a)},dr.prototype.h=function(t){if("string"==typeof t){var e={};e.__data__=t,Yn(this.a,e)}else this.l?((e={}).__data__=Kt(t),Yn(this.a,e)):Yn(this.a,t)},dr.prototype.G=function(){this.a.f=null,delete this.f,Qn(this.a),delete this.a,dr.X.G.call(this)},O(pr,Ne),O(yr,Ae),O(vr,lr),vr.prototype.ta=function(){Bt(this.a,"a")},vr.prototype.sa=function(t){Bt(this.a,new pr(t))},vr.prototype.ra=function(t){Bt(this.a,new yr(t))},vr.prototype.qa=function(){Bt(this.a,"b")},fr.prototype.createWebChannel=fr.prototype.a,dr.prototype.send=dr.prototype.h,dr.prototype.open=dr.prototype.g,dr.prototype.close=dr.prototype.close,we.NO_ERROR=0,we.TIMEOUT=8,we.HTTP_ERROR=6,Ie.COMPLETE="complete",_e.EventType=De,De.OPEN="a",De.CLOSE="b",De.ERROR="c",De.MESSAGE="d",qt.prototype.listen=qt.prototype.va,Rn.prototype.listenOnce=Rn.prototype.wa,Rn.prototype.getLastError=Rn.prototype.Qa,Rn.prototype.getLastErrorCode=Rn.prototype.ua,Rn.prototype.getStatus=Rn.prototype.W,Rn.prototype.getResponseJson=Rn.prototype.Pa,Rn.prototype.getResponseText=Rn.prototype.$,Rn.prototype.send=Rn.prototype.ba;var gr=we,mr=Ie,br=le,wr=10,Ir=11,Tr=_e,Er=Rn,_r=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();_r.o=-1;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Sr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Dr=function(e){function n(t,n){var r=this;return(r=e.call(this,n)||this).code=t,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return t(n,e),n}(Error),Nr=new d("@firebase/firestore");function Ar(){return Nr.logLevel}function kr(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(Nr.logLevel<=p.DEBUG){var i=n.map(Rr);Nr.debug.apply(Nr,e(["Firestore (8.6.3): "+t],i))}}function Cr(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(Nr.logLevel<=p.ERROR){var i=n.map(Rr);Nr.error.apply(Nr,e(["Firestore (8.6.3): "+t],i))}}function xr(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(Nr.logLevel<=p.WARN){var i=n.map(Rr);Nr.warn.apply(Nr,e(["Firestore (8.6.3): "+t],i))}}function Rr(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(n){return t}var e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Or(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.6.3) INTERNAL ASSERTION FAILED: "+t;throw Cr(e),new Error(e)}function Pr(t,e){t||Or()}function Lr(t,e){return t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mr(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Fr=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=Mr(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function Vr(t,e){return t<e?-1:t>e?1:0}function Ur(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function qr(t){return t+"\0"}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Br=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Dr(Sr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Dr(Sr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Dr(Sr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Dr(Sr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?Vr(this.nanoseconds,t.nanoseconds):Vr(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),jr=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new Br(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kr(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Gr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function zr(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Qr=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&Or(),void 0===n?n=t.length-e:n>t.length-e&&Or(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),Hr=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.construct=function(t,e,r){return new n(t,e,r)},n.prototype.canonicalString=function(){return this.toArray().join("/")},n.prototype.toString=function(){return this.canonicalString()},n.fromString=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter((function(t){return t.length>0})))}return new n(r)},n.emptyPath=function(){return new n([])},n}(Qr),Wr=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Yr=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.construct=function(t,e,r){return new n(t,e,r)},n.isValidIdentifier=function(t){return Wr.test(t)},n.prototype.canonicalString=function(){return this.toArray().map((function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(t)||(t="`"+t+"`"),t})).join(".")},n.prototype.toString=function(){return this.canonicalString()},n.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},n.keyField=function(){return new n(["__name__"])},n.fromServerFormat=function(t){for(var e=[],r="",i=0,o=function(){if(0===r.length)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new Dr(Sr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Dr(Sr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new Dr(Sr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new n(e)},n.emptyPath=function(){return new n([])},n}(Qr),Xr=function(){function t(t){this.fields=t,t.sort(Yr.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return Ur(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},t}(),$r=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return t=this.binaryString,btoa(t);var t},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return Vr(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();$r.EMPTY_BYTE_STRING=new $r("");var Jr=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Zr(t){if(Pr(!!t),"string"==typeof t){var e=0,n=Jr.exec(t);if(Pr(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:ti(t.seconds),nanos:ti(t.nanos)}}function ti(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function ei(t){return"string"==typeof t?$r.fromBase64String(t):$r.fromUint8Array(t)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ni(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ri(t){var e=t.mapValue.fields.__previous_value__;return ni(e)?ri(e):e}function ii(t){var e=Zr(t.mapValue.fields.__local_write_time__.timestampValue);return new Br(e.seconds,e.nanos)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oi(t){return null==t}function si(t){return 0===t&&1/t==-1/0}function ai(t){return"number"==typeof t&&Number.isInteger(t)&&!si(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ui=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(Hr.fromString(e))},t.fromName=function(e){return new t(Hr.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===Hr.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return Hr.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new Hr(e.slice()))},t}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ci(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?ni(t)?4:10:Or()}function hi(t,e){var n,r=ci(t);if(r!==ci(e))return!1;switch(r){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return ii(t).isEqual(ii(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=Zr(t.timestampValue),r=Zr(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return n=e,ei(t.bytesValue).isEqual(ei(n.bytesValue));case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return ti(t.geoPointValue.latitude)===ti(e.geoPointValue.latitude)&&ti(t.geoPointValue.longitude)===ti(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return ti(t.integerValue)===ti(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=ti(t.doubleValue),r=ti(e.doubleValue);return n===r?si(n)===si(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Ur(t.arrayValue.values||[],e.arrayValue.values||[],hi);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Kr(n)!==Kr(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!hi(n[i],r[i])))return!1;return!0}(t,e);default:return Or()}}function li(t,e){return void 0!==(t.values||[]).find((function(t){return hi(t,e)}))}function fi(t,e){var n,r,i,o,s=ci(t),a=ci(e);if(s!==a)return Vr(s,a);switch(s){case 0:return 0;case 1:return Vr(t.booleanValue,e.booleanValue);case 2:return r=e,i=ti((n=t).integerValue||n.doubleValue),o=ti(r.integerValue||r.doubleValue),i<o?-1:i>o?1:i===o?0:isNaN(i)?isNaN(o)?0:-1:1;case 3:return di(t.timestampValue,e.timestampValue);case 4:return di(ii(t),ii(e));case 5:return Vr(t.stringValue,e.stringValue);case 6:return function(t,e){var n=ei(t),r=ei(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Vr(n[i],r[i]);if(0!==o)return o}return Vr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=Vr(ti(t.latitude),ti(e.latitude));return 0!==n?n:Vr(ti(t.longitude),ti(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=fi(n[i],r[i]);if(o)return o}return Vr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=Vr(r[s],o[s]);if(0!==a)return a;var u=fi(n[r[s]],i[o[s]]);if(0!==u)return u}return Vr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Or()}}function di(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Vr(t,e);var n=Zr(t),r=Zr(e),i=Vr(n.seconds,r.seconds);return 0!==i?i:Vr(n.nanos,r.nanos)}function pi(t){return yi(t)}function yi(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?(e=t.timestampValue,"time("+(n=Zr(e)).seconds+","+n.nanos+")"):"stringValue"in t?t.stringValue:"bytesValue"in t?ei(t.bytesValue).toBase64():"referenceValue"in t?(i=t.referenceValue,ui.fromName(i).toString()):"geoPointValue"in t?"geo("+(r=t.geoPointValue).latitude+","+r.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=yi(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+yi(t.fields[o])}return e+"}"}(t.mapValue):Or();var e,n,r,i}function vi(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function gi(t){return!!t&&"integerValue"in t}function mi(t){return!!t&&"arrayValue"in t}function bi(t){return!!t&&"nullValue"in t}function wi(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ii(t){return!!t&&"mapValue"in t}function Ti(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue)return{timestampValue:Object.assign({},Zr(t.timestampValue))};if(t.mapValue){var e={mapValue:{fields:{}}};return Gr(t.mapValue.fields,(function(t,n){return e.mapValue.fields[t]=Ti(n)})),e}if(t.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(t.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=Ti(t.arrayValue.values[r]);return n}return Object.assign({},t)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ei=function(){function t(t){this.value=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.isEmpty())return this.value;for(var e=this.value,n=0;n<t.length-1;++n)if(!Ii(e=(e.mapValue.fields||{})[t.get(n)]))return null;return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},t.prototype.set=function(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Ti(e)},t.prototype.setAll=function(t){var e=this,n=Yr.emptyPath(),r={},i=[];t.forEach((function(t,o){if(!n.isImmediateParentOf(o)){var s=e.getFieldsMap(n);e.applyChanges(s,r,i),r={},i=[],n=o.popLast()}t?r[o.lastSegment()]=Ti(t):i.push(o.lastSegment())}));var o=this.getFieldsMap(n);this.applyChanges(o,r,i)},t.prototype.delete=function(t){var e=this.field(t.popLast());Ii(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]},t.prototype.isEqual=function(t){return hi(this.value,t.value)},t.prototype.getFieldsMap=function(t){var e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(var n=0;n<t.length;++n){var r=e.mapValue.fields[t.get(n)];Ii(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields},t.prototype.applyChanges=function(t,e,n){Gr(e,(function(e,n){return t[e]=n}));for(var r=0,i=n;r<i.length;r++){var o=i[r];delete t[o]}},t.prototype.clone=function(){return new t(Ti(this.value))},t}();function _i(t){var e=[];return Gr(t.fields,(function(t,n){var r=new Yr([t]);if(Ii(n)){var i=_i(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++){var a=s[o];e.push(r.child(a))}}else e.push(r)})),new Xr(e)}var Si=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,jr.min(),Ei.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,Ei.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,Ei.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=Ei.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=Ei.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),Di=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ni(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new Di(t,e,n,r,i,o,s)}function Ai(t){var e=Lr(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((function(t){return(e=t).field.canonicalString()+e.op.toString()+pi(e.value);var e})).join(","),n+="|ob:",n+=e.orderBy.map((function(t){return(e=t).field.canonicalString()+e.dir;var e})).join(","),oi(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=Bi(e.startAt)),e.endAt&&(n+="|ub:",n+=Bi(e.endAt)),e.h=n}return e.h}function ki(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!Ki(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if(i=t.filters[r],o=e.filters[r],i.op!==o.op||!i.field.isEqual(o.field)||!hi(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!zi(t.startAt,e.startAt)&&zi(t.endAt,e.endAt)}function Ci(t){return ui.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var xi=function(e){function n(t,n,r){var i=this;return(i=e.call(this)||this).field=t,i.op=n,i.value=r,i}return t(n,e),n.create=function(t,e,r){return t.isKeyField()?"in"===e||"not-in"===e?this.l(t,e,r):new Ri(t,e,r):"array-contains"===e?new Mi(t,r):"in"===e?new Fi(t,r):"not-in"===e?new Vi(t,r):"array-contains-any"===e?new Ui(t,r):new n(t,e,r)},n.l=function(t,e,n){return"in"===e?new Oi(t,n):new Pi(t,n)},n.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(fi(e,this.value)):null!==e&&ci(this.value)===ci(e)&&this.m(fi(e,this.value))},n.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Or()}},n.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},n}((function(){})),Ri=function(e){function n(t,n,r){var i=this;return(i=e.call(this,t,n,r)||this).key=ui.fromName(r.referenceValue),i}return t(n,e),n.prototype.matches=function(t){var e=ui.comparator(t.key,this.key);return this.m(e)},n}(xi),Oi=function(e){function n(t,n){var r=this;return(r=e.call(this,t,"in",n)||this).keys=Li("in",n),r}return t(n,e),n.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},n}(xi),Pi=function(e){function n(t,n){var r=this;return(r=e.call(this,t,"not-in",n)||this).keys=Li("not-in",n),r}return t(n,e),n.prototype.matches=function(t){return!this.keys.some((function(e){return e.isEqual(t.key)}))},n}(xi);function Li(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(t){return ui.fromName(t.referenceValue)}))}var Mi=function(e){function n(t,n){return e.call(this,t,"array-contains",n)||this}return t(n,e),n.prototype.matches=function(t){var e=t.data.field(this.field);return mi(e)&&li(e.arrayValue,this.value)},n}(xi),Fi=function(e){function n(t,n){return e.call(this,t,"in",n)||this}return t(n,e),n.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&li(this.value.arrayValue,e)},n}(xi),Vi=function(e){function n(t,n){return e.call(this,t,"not-in",n)||this}return t(n,e),n.prototype.matches=function(t){if(li(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!li(this.value.arrayValue,e)},n}(xi),Ui=function(e){function n(t,n){return e.call(this,t,"array-contains-any",n)||this}return t(n,e),n.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!mi(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return li(e.value.arrayValue,t)}))},n}(xi),qi=function(t,e){this.position=t,this.before=e};function Bi(t){return(t.before?"b":"a")+":"+t.position.map((function(t){return pi(t)})).join(",")}var ji=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Ki(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Gi(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?ui.comparator(ui.fromName(s.referenceValue),n.key):fi(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function zi(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!hi(t.position[n],e.position[n]))return!1;return!0}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Qi=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null,this.startAt,this.endAt};function Hi(t,e,n,r,i,o,s,a){return new Qi(t,e,n,r,i,o,s,a)}function Wi(t){return new Qi(t)}function Yi(t){return!oi(t.limit)&&"F"===t.limitType}function Xi(t){return!oi(t.limit)&&"L"===t.limitType}function $i(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function Ji(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function Zi(t){return null!==t.collectionGroup}function to(t){var e=Lr(t);if(null===e.p){e.p=[];var n=Ji(e),r=$i(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new ji(n)),e.p.push(new ji(Yr.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new ji(Yr.keyField(),u))}}}return e.p}function eo(t){var e=Lr(t);if(!e.T)if("F"===e.limitType)e.T=Ni(e.path,e.collectionGroup,to(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=to(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new ji(o.field,s))}var a=e.endAt?new qi(e.endAt.position,!e.endAt.before):null,u=e.startAt?new qi(e.startAt.position,!e.startAt.before):null;e.T=Ni(e.path,e.collectionGroup,n,e.filters,e.limit,a,u)}return e.T}function no(t,e,n){return new Qi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function ro(t,e){return ki(eo(t),eo(e))&&t.limitType===e.limitType}function io(t){return Ai(eo(t))+"|lt:"+t.limitType}function oo(t){return"Query(target="+(e=eo(t),n=e.path.canonicalString(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=", filters: ["+e.filters.map((function(t){return(e=t).field.canonicalString()+" "+e.op+" "+pi(e.value);var e})).join(", ")+"]"),oi(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=", orderBy: ["+e.orderBy.map((function(t){return(e=t).field.canonicalString()+" ("+e.dir+")";var e})).join(", ")+"]"),e.startAt&&(n+=", startAt: "+Bi(e.startAt)),e.endAt&&(n+=", endAt: "+Bi(e.endAt)),"Target("+n+"); limitType=")+t.limitType+")";var e,n}function so(t,e){return e.isFoundDocument()&&(n=t,i=(r=e).key.path,null!==n.collectionGroup?r.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):ui.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i))&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Gi(t.startAt,to(t),e)||t.endAt&&Gi(t.endAt,to(t),e))}(t,e);var n,r,i}function ao(t){return function(e,n){for(var r=!1,i=0,o=to(t);i<o.length;i++){var s=o[i],a=uo(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function uo(t,e,n){var r,i,o,s,a=t.field.isKeyField()?ui.comparator(e.key,n.key):(r=t.field,i=n,o=e.data.field(r),s=i.data.field(r),null!==o&&null!==s?fi(o,s):Or());switch(t.dir){case"asc":return a;case"desc":return-1*a;default:return Or()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function co(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:si(e)?"-0":e}}function ho(t){return{integerValue:""+t}}function lo(t,e){return ai(e)?ho(e):co(t,e)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var fo=function(){this._=void 0};function po(t,e,n){return t instanceof go?(i=e,o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:(r=n).seconds,nanos:r.nanoseconds}}}},i&&(o.fields.__previous_value__=i),{mapValue:o}):t instanceof mo?bo(t,e):t instanceof wo?Io(t,e):function(t,e){var n=vo(t,e),r=Eo(n)+Eo(t.A);return gi(n)&&gi(t.A)?ho(r):co(t.R,r)}(t,e);var r,i,o}function yo(t,e,n){return t instanceof mo?bo(t,e):t instanceof wo?Io(t,e):n}function vo(t,e){return t instanceof To?gi(r=e)||(n=r)&&"doubleValue"in n?e:{integerValue:0}:null;var n,r}var go=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n}(fo),mo=function(e){function n(t){var n=this;return(n=e.call(this)||this).elements=t,n}return t(n,e),n}(fo);function bo(t,e){for(var n=_o(e),r=function(t){n.some((function(e){return hi(e,t)}))||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var wo=function(e){function n(t){var n=this;return(n=e.call(this)||this).elements=t,n}return t(n,e),n}(fo);function Io(t,e){for(var n=_o(e),r=function(t){n=n.filter((function(e){return!hi(e,t)}))},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var To=function(e){function n(t,n){var r=this;return(r=e.call(this)||this).R=t,r.A=n,r}return t(n,e),n}(fo);function Eo(t){return ti(t.integerValue||t.doubleValue)}function _o(t){return mi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var So=function(t,e){this.field=t,this.transform=e},Do=function(t,e){this.version=t,this.transformResults=e},No=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function Ao(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var ko=function(){};function Co(t,e,n){var r,i,o,s,a;t instanceof Lo?(i=e,o=n,s=(r=t).value.clone(),a=Vo(r.fieldTransforms,i,o.transformResults),s.setAll(a),i.convertToFoundDocument(o.version,s).setHasCommittedMutations()):t instanceof Mo?function(t,e,n){if(Ao(t.precondition,e)){var r=Vo(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(Fo(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function xo(t,e,n){var r;t instanceof Lo?function(t,e,n){if(Ao(t.precondition,e)){var r=t.value.clone(),i=Uo(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(Po(e),r).setHasLocalMutations()}}(t,e,n):t instanceof Mo?function(t,e,n){if(Ao(t.precondition,e)){var r=Uo(t.fieldTransforms,n,e),i=e.data;i.setAll(Fo(t)),i.setAll(r),e.convertToFoundDocument(Po(e),i).setHasLocalMutations()}}(t,e,n):(r=e,Ao(t.precondition,r)&&r.convertToNoDocument(jr.min()))}function Ro(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=vo(o.transform,s||null);null!=a&&(null==n&&(n=Ei.empty()),n.set(o.field,a))}return n||null}function Oo(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&(n=t.fieldTransforms,r=e.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&Ur(n,r,(function(t,e){return r=e,(n=t).field.isEqual(r.field)&&(i=n.transform,o=r.transform,i instanceof mo&&o instanceof mo||i instanceof wo&&o instanceof wo?Ur(i.elements,o.elements,hi):i instanceof To&&o instanceof To?hi(i.A,o.A):i instanceof go&&o instanceof go);var n,r,i,o}))))&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask));var n,r}function Po(t){return t.isFoundDocument()?t.version:jr.min()}var Lo=function(e){function n(t,n,r,i){void 0===i&&(i=[]);var o=this;return(o=e.call(this)||this).key=t,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return t(n,e),n}(ko),Mo=function(e){function n(t,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=e.call(this)||this).key=t,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return t(n,e),n}(ko);function Fo(t){var e=new Map;return t.fieldMask.fields.forEach((function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}})),e}function Vo(t,e,n){var r=new Map;Pr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,yo(s,a,n[i]))}return r}function Uo(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,po(a,u,e))}return r}var qo,Bo,jo=function(e){function n(t,n){var r=this;return(r=e.call(this)||this).key=t,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return t(n,e),n}(ko),Ko=function(e){function n(t,n){var r=this;return(r=e.call(this)||this).key=t,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return t(n,e),n}(ko),Go=function(t){this.count=t};function zo(t){switch(t){case Sr.OK:return Or();case Sr.CANCELLED:case Sr.UNKNOWN:case Sr.DEADLINE_EXCEEDED:case Sr.RESOURCE_EXHAUSTED:case Sr.INTERNAL:case Sr.UNAVAILABLE:case Sr.UNAUTHENTICATED:return!1;case Sr.INVALID_ARGUMENT:case Sr.NOT_FOUND:case Sr.ALREADY_EXISTS:case Sr.PERMISSION_DENIED:case Sr.FAILED_PRECONDITION:case Sr.ABORTED:case Sr.OUT_OF_RANGE:case Sr.UNIMPLEMENTED:case Sr.DATA_LOSS:return!0;default:return Or()}}function Qo(t){if(void 0===t)return Cr("GRPC error has no .code"),Sr.UNKNOWN;switch(t){case qo.OK:return Sr.OK;case qo.CANCELLED:return Sr.CANCELLED;case qo.UNKNOWN:return Sr.UNKNOWN;case qo.DEADLINE_EXCEEDED:return Sr.DEADLINE_EXCEEDED;case qo.RESOURCE_EXHAUSTED:return Sr.RESOURCE_EXHAUSTED;case qo.INTERNAL:return Sr.INTERNAL;case qo.UNAVAILABLE:return Sr.UNAVAILABLE;case qo.UNAUTHENTICATED:return Sr.UNAUTHENTICATED;case qo.INVALID_ARGUMENT:return Sr.INVALID_ARGUMENT;case qo.NOT_FOUND:return Sr.NOT_FOUND;case qo.ALREADY_EXISTS:return Sr.ALREADY_EXISTS;case qo.PERMISSION_DENIED:return Sr.PERMISSION_DENIED;case qo.FAILED_PRECONDITION:return Sr.FAILED_PRECONDITION;case qo.ABORTED:return Sr.ABORTED;case qo.OUT_OF_RANGE:return Sr.OUT_OF_RANGE;case qo.UNIMPLEMENTED:return Sr.UNIMPLEMENTED;case qo.DATA_LOSS:return Sr.DATA_LOSS;default:return Or()}}(Bo=qo||(qo={}))[Bo.OK=0]="OK",Bo[Bo.CANCELLED=1]="CANCELLED",Bo[Bo.UNKNOWN=2]="UNKNOWN",Bo[Bo.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Bo[Bo.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Bo[Bo.NOT_FOUND=5]="NOT_FOUND",Bo[Bo.ALREADY_EXISTS=6]="ALREADY_EXISTS",Bo[Bo.PERMISSION_DENIED=7]="PERMISSION_DENIED",Bo[Bo.UNAUTHENTICATED=16]="UNAUTHENTICATED",Bo[Bo.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Bo[Bo.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Bo[Bo.ABORTED=10]="ABORTED",Bo[Bo.OUT_OF_RANGE=11]="OUT_OF_RANGE",Bo[Bo.UNIMPLEMENTED=12]="UNIMPLEMENTED",Bo[Bo.INTERNAL=13]="INTERNAL",Bo[Bo.UNAVAILABLE=14]="UNAVAILABLE",Bo[Bo.DATA_LOSS=15]="DATA_LOSS";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Ho=function(){function t(t,e){this.comparator=t,this.root=e||Yo.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Yo.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Yo.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.inorderTraversal((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new Wo(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new Wo(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new Wo(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new Wo(this.root,t,this.comparator,!0)},t}(),Wo=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),Yo=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Or();if(this.right.isRed())throw Or();var t=this.left.check();if(t!==this.right.check())throw Or();return t+(this.isRed()?0:1)},t}();Yo.EMPTY=null,Yo.RED=!0,Yo.BLACK=!1,Yo.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw Or()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw Or()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw Or()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw Or()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw Or()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new Yo(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Xo=function(){function t(t){this.comparator=t,this.data=new Ho(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new $o(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new $o(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),$o=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),Jo=new Ho(ui.comparator);function Zo(){return Jo}var ts=new Ho(ui.comparator);function es(){return ts}var ns=new Ho(ui.comparator);var rs=new Xo(ui.comparator);function is(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=rs,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var os=new Xo(Vr);function ss(){return os}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var as=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,us.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(jr.min(),r,ss(),Zo(),is())},t}(),us=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t($r.EMPTY_BYTE_STRING,n,is(),is(),is())},t}(),cs=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},hs=function(t,e){this.targetId=t,this.V=e},ls=function(t,e,n,r){void 0===n&&(n=$r.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},fs=function(){function t(){this.S=0,this.D=ys(),this.C=$r.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"k",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"$",{get:function(){return this.F},enumerable:!1,configurable:!0}),t.prototype.O=function(t){t.approximateByteSize()>0&&(this.F=!0,this.C=t)},t.prototype.M=function(){var t=is(),e=is(),n=is();return this.D.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Or()}})),new us(this.C,this.N,t,e,n)},t.prototype.L=function(){this.F=!1,this.D=ys()},t.prototype.B=function(t,e){this.F=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.F=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.F=!0,this.N=!0},t}(),ds=function(){function t(t){this.W=t,this.G=new Map,this.H=Zo(),this.J=ps(),this.Y=new Xo(Vr)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.tt(r,t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,(function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.O(t.resumeToken);break;case 1:r.K(),r.k||r.L(),r.O(t.resumeToken);break;case 2:r.K(),r.k||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.O(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.O(t.resumeToken));break;default:Or()}}))},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach((function(t,r){n.st(r)&&e(r)}))},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(Ci(i))if(0===n){var o=new ui(i.path);this.tt(e,o,Si.newNoDocument(o,jr.min()))}else Pr(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach((function(r,i){var o=e.ot(i);if(o){if(r.current&&Ci(o.target)){var s=new ui(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,Si.newNoDocument(s,t))}r.$&&(n.set(i,r.M()),r.L())}}));var r=is();this.J.forEach((function(t,n){var i=!0;n.forEachWhile((function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new as(t,n,this.Y,this.H,r);return this.H=Zo(),this.J=ps(),this.Y=new Xo(Vr),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new fs,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new Xo(Vr),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||kr("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.k?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new fs),this.W.getRemoteKeysForTarget(t).forEach((function(n){e.tt(t,n,null)}))},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function ps(){return new Ho(ui.comparator)}function ys(){return new Ho(ui.comparator)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var vs={asc:"ASCENDING",desc:"DESCENDING"},gs={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ms=function(t,e){this.databaseId=t,this.I=e};function bs(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function ws(t,e){return t.I?e.toBase64():e.toUint8Array()}function Is(t,e){return bs(t,e.toTimestamp())}function Ts(t){return Pr(!!t),jr.fromTimestamp((e=Zr(t),new Br(e.seconds,e.nanos)));var e}function Es(t,e){return(n=t,new Hr(["projects",n.projectId,"databases",n.database])).child("documents").child(e).canonicalString();var n}function _s(t){var e=Hr.fromString(t);return Pr(Hs(e)),e}function Ss(t,e){return Es(t.databaseId,e.path)}function Ds(t,e){var n=_s(e);if(n.get(1)!==t.databaseId.projectId)throw new Dr(Sr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Dr(Sr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new ui(Cs(n))}function Ns(t,e){return Es(t.databaseId,e)}function As(t){var e=_s(t);return 4===e.length?Hr.emptyPath():Cs(e)}function ks(t){return new Hr(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Cs(t){return Pr(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function xs(t,e,n){return{name:Ss(t,e),fields:n.value.mapValue.fields}}function Rs(t,e){var n,r,i;if(e instanceof Lo)n={update:xs(t,e.key,e.value)};else if(e instanceof jo)n={delete:Ss(t,e.key)};else if(e instanceof Mo)n={update:xs(t,e.key,e.data),updateMask:Qs(e.fieldMask)};else{if(!(e instanceof Ko))return Or();n={verify:Ss(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((function(t){return function(t,e){var n=e.transform;if(n instanceof go)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof mo)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof wo)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof To)return{fieldPath:e.field.canonicalString(),increment:n.A};throw Or()}(0,t)}))),e.precondition.isNone||(n.currentDocument=(r=t,void 0!==(i=e.precondition).updateTime?{updateTime:Is(r,i.updateTime)}:void 0!==i.exists?{exists:i.exists}:Or())),n}function Os(t,e){var n,r=e.currentDocument?void 0!==(n=e.currentDocument).updateTime?No.updateTime(Ts(n.updateTime)):void 0!==n.exists?No.exists(n.exists):No.none():No.none(),i=e.updateTransforms?e.updateTransforms.map((function(e){return function(t,e){var n=null;if("setToServerValue"in e)Pr("REQUEST_TIME"===e.setToServerValue),n=new go;else if("appendMissingElements"in e){var r=e.appendMissingElements.values||[];n=new mo(r)}else if("removeAllFromArray"in e){var i=e.removeAllFromArray.values||[];n=new wo(i)}else"increment"in e?n=new To(t,e.increment):Or();var o=Yr.fromServerFormat(e.fieldPath);return new So(o,n)}(t,e)})):[];if(e.update){e.update.name;var o=Ds(t,e.update.name),s=new Ei({mapValue:{fields:e.update.fields}});if(e.updateMask){var a=function(t){var e=t.fieldPaths||[];return new Xr(e.map((function(t){return Yr.fromServerFormat(t)})))}(e.updateMask);return new Mo(o,s,a,r,i)}return new Lo(o,s,r,i)}if(e.delete){var u=Ds(t,e.delete);return new jo(u,r)}if(e.verify){var c=Ds(t,e.verify);return new Ko(c,r)}return Or()}function Ps(t,e){return{documents:[Ns(t,e.path)]}}function Ls(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Ns(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Ns(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map((function(t){return function(t){if("=="===t.op){if(wi(t.value))return{unaryFilter:{field:js(t.field),op:"IS_NAN"}};if(bi(t.value))return{unaryFilter:{field:js(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(wi(t.value))return{unaryFilter:{field:js(t.field),op:"IS_NOT_NAN"}};if(bi(t.value))return{unaryFilter:{field:js(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:js(t.field),op:Bs(t.op),value:t.value}}}(t)}));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map((function(t){return{field:js((e=t).field),direction:qs(e.dir)};var e}))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s,a,u=(s=t,a=e.limit,s.I||oi(a)?a:{value:a});return null!==u&&(n.structuredQuery.limit=u),e.startAt&&(n.structuredQuery.startAt=Vs(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Vs(e.endAt)),n}function Ms(t){var e=As(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){Pr(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=Fs(n.where));var a=[];n.orderBy&&(a=n.orderBy.map((function(t){return new ji(Ks((e=t).field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction));var e})));var u,c,h=null;n.limit&&(u=n.limit,h=oi(c="object"==typeof u?u.value:u)?null:c);var l=null;n.startAt&&(l=Us(n.startAt));var f=null;return n.endAt&&(f=Us(n.endAt)),Hi(e,i,a,s,h,"F",l,f)}function Fs(t){return t?void 0!==t.unaryFilter?[zs(t)]:void 0!==t.fieldFilter?[Gs(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((function(t){return Fs(t)})).reduce((function(t,e){return t.concat(e)})):Or():[]}function Vs(t){return{before:t.before,values:t.position}}function Us(t){var e=!!t.before,n=t.values||[];return new qi(n,e)}function qs(t){return vs[t]}function Bs(t){return gs[t]}function js(t){return{fieldPath:t.canonicalString()}}function Ks(t){return Yr.fromServerFormat(t.fieldPath)}function Gs(t){return xi.create(Ks(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Or()}}(t.fieldFilter.op),t.fieldFilter.value)}function zs(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Ks(t.unaryFilter.field);return xi.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Ks(t.unaryFilter.field);return xi.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Ks(t.unaryFilter.field);return xi.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Ks(t.unaryFilter.field);return xi.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Or()}}function Qs(t){var e=[];return t.fields.forEach((function(t){return e.push(t.canonicalString())})),{fieldPaths:e}}function Hs(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ws(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=Xs(e)),e=Ys(t.get(n),e);return Xs(e)}function Ys(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function Xs(t){return t+""}function $s(t){var e=t.length;if(Pr(e>=2),2===e)return Pr(""===t.charAt(0)&&""===t.charAt(1)),Hr.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||s>n)&&Or(),t.charAt(s+1)){case"":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:Or()}o=s+2}return new Hr(r)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Js=function(t,e){this.seconds=t,this.nanoseconds=e},Zs=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};Zs.store="owner",Zs.key="owner";var ta=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};ta.store="mutationQueues",ta.keyPath="userId";var ea=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};ea.store="mutations",ea.keyPath="batchId",ea.userMutationsIndex="userMutationsIndex",ea.userMutationsKeyPath=["userId","batchId"];var na=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,Ws(e)]},t.key=function(t,e,n){return[t,Ws(e),n]},t}();na.store="documentMutations",na.PLACEHOLDER=new na;var ra=function(t,e){this.path=t,this.readTime=e},ia=function(t,e){this.path=t,this.version=e},oa=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};oa.store="remoteDocuments",oa.readTimeIndex="readTimeIndex",oa.readTimeIndexPath="readTime",oa.collectionReadTimeIndex="collectionReadTimeIndex",oa.collectionReadTimeIndexPath=["parentPath","readTime"];var sa=function(t){this.byteSize=t};sa.store="remoteDocumentGlobal",sa.key="remoteDocumentGlobalKey";var aa=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};aa.store="targets",aa.keyPath="targetId",aa.queryTargetsIndexName="queryTargetsIndex",aa.queryTargetsKeyPath=["canonicalId","targetId"];var ua=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};ua.store="targetDocuments",ua.keyPath=["targetId","path"],ua.documentTargetsIndex="documentTargetsIndex",ua.documentTargetsKeyPath=["path","targetId"];var ca=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};ca.key="targetGlobalKey",ca.store="targetGlobal";var ha=function(t,e){this.collectionId=t,this.parent=e};ha.store="collectionParents",ha.keyPath=["collectionId","parent"];var la=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};la.store="clientMetadata",la.keyPath="clientId";var fa=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};fa.store="bundles",fa.keyPath="bundleId";var da=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};da.store="namedQueries",da.keyPath="name";var pa=e(e([],e(e([],e(e([],e(e([],[ta.store,ea.store,na.store,oa.store,aa.store,Zs.store,ca.store,ua.store]),[la.store])),[sa.store])),[ha.store])),[fa.store,da.store]),ya="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",va=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach((function(t){return t()}))},t}(),ga=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},ma=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)}),(function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&Or(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t((function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}}))},t.prototype.toPromise=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(r){return t.reject(r)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.waitFor=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t()}),(function(t){return n(t)}))})),o=!0,i===r&&t()}))},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.waitFor(r)},t}(),ba=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new ga,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new Ta(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=Na(e.target.error);n.ft.reject(new Ta(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(o){throw new Ta(n,o)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(kr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new _a(e)},t}(),wa=function(){function t(e,r,i){this.name=e,this.version=r,this.wt=i,12.2===t._t(n())&&Cr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return kr("SimpleDb","Removing database:",t),Sa(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=n(),r=t._t(e),i=0<r&&r<10,o=t.Et(e),s=0<o&&o<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||i||s)},t.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.At=function(t){return r(this,void 0,void 0,(function(){var e,n=this;return i(this,(function(r){switch(r.label){case 0:return this.db?[3,2]:(kr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise((function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){r(new Ta(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;"VersionError"===n.name?r(new Dr(Sr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(new Ta(t,n))},i.onupgradeneeded=function(t){kr("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;n.wt.Rt(e,i.transaction,t.oldVersion,n.version).next((function(){kr("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}))]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}}))}))},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,o){return r(this,void 0,void 0,(function(){var r,s,a,u,c;return i(this,(function(h){switch(h.label){case 0:r="readonly"===e,s=0,a=function(){var e,a,c,h,l;return i(this,(function(i){switch(i.label){case 0:++s,i.label=1;case 1:return i.trys.push([1,4,,5]),[4,u.At(t)];case 2:return u.db=i.sent(),e=ba.open(u.db,t,r?"readonly":"readwrite",n),a=o(e).catch((function(t){return e.abort(t),ma.reject(t)})).toPromise(),c={},a.catch((function(){})),[4,e.dt];case 3:return[2,(c.value=(i.sent(),a),c)];case 4:return h=i.sent(),l="FirebaseError"!==h.name&&s<3,kr("SimpleDb","Transaction failed with error:",h.message,"Retrying:",l),u.close(),l?[3,5]:[2,{value:Promise.reject(h)}];case 5:return[2]}}))},u=this,h.label=1;case 1:return[5,a()];case 2:if("object"==typeof(c=h.sent()))return[2,c.value];h.label=3;case 3:return[3,1];case 4:return[2]}}))}))},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),Ia=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return Sa(this.Pt.delete())},t}(),Ta=function(e){function n(t,n){var r=this;return(r=e.call(this,Sr.UNAVAILABLE,"IndexedDB transaction '"+t+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return t(n,e),n}(Dr);function Ea(t){return"IndexedDbTransactionError"===t.name}var _a=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(kr("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(kr("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Sa(n)},t.prototype.add=function(t){return kr("SimpleDb","ADD",this.store.name,t,t),Sa(this.store.add(t))},t.prototype.get=function(t){var e=this;return Sa(this.store.get(t)).next((function(n){return void 0===n&&(n=null),kr("SimpleDb","GET",e.store.name,t,n),n}))},t.prototype.delete=function(t){return kr("SimpleDb","DELETE",this.store.name,t),Sa(this.store.delete(t))},t.prototype.count=function(){return kr("SimpleDb","COUNT",this.store.name),Sa(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.Ft=function(t,e){kr("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.kt=!1;var r=this.cursor(n);return this.xt(r,(function(t,e,n){return n.delete()}))},t.prototype.$t=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.Ot=function(t){var e=this.cursor({});return new ma((function(n,r){e.onerror=function(t){var e=Na(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.xt=function(t,e){var n=[];return new ma((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Ia(i),s=e(i.primaryKey,i.value,o);if(s instanceof ma){var a=s.catch((function(t){return o.done(),ma.reject(t)}));n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}})).next((function(){return ma.waitFor(n)}))},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.kt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function Sa(t){return new ma((function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=Na(t.target.error);n(e)}}))}var Da=!1;function Na(t){var e=wa._t(n());if(e>=12.2&&e<13){var r="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(r)>=0){var i=new Dr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+r+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Da||(Da=!0,setTimeout((function(){throw i}),0)),i}}return t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Aa=function(e){function n(t,n){var r=this;return(r=e.call(this)||this).Mt=t,r.currentSequenceNumber=n,r}return t(n,e),n}(va);function ka(t,e){var n=Lr(t);return wa.It(n.Mt,e)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ca=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&Co(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&xo(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&xo(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach((function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(jr.min())}))},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),is())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&Ur(this.mutations,t.mutations,(function(t,e){return Oo(t,e)}))&&Ur(this.baseMutations,t.baseMutations,(function(t,e){return Oo(t,e)}))},t}(),xa=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){Pr(e.mutations.length===r.length);for(var i=ns,o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),Ra=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=jr.min()),void 0===o&&(o=jr.min()),void 0===s&&(s=$r.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),Oa=function(t){this.Lt=t};function Pa(t,e){if(e.document)return function(t,e,n){var r=Ds(t,e.name),i=Ts(e.updateTime),o=new Ei({mapValue:{fields:e.fields}}),s=Si.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=ui.fromSegments(e.noDocument.path),r=Ua(e.noDocument.readTime),i=Si.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=ui.fromSegments(e.unknownDocument.path);return r=Ua(e.unknownDocument.version),Si.newUnknownDocument(o,r)}return Or()}function La(t,e,n){var r,i,o=Ma(n),s=e.key.path.popLast().toArray();if(e.isFoundDocument()){var a={name:Ss(r=t.Lt,(i=e).key),fields:i.data.value.mapValue.fields,updateTime:bs(r,i.version.toTimestamp())},u=e.hasCommittedMutations;return new oa(null,null,a,u,o,s)}if(e.isNoDocument()){var c=e.key.path.toArray(),h=Va(e.version);return u=e.hasCommittedMutations,new oa(null,new ra(c,h),null,u,o,s)}if(e.isUnknownDocument()){var l=e.key.path.toArray(),f=Va(e.version);return new oa(new ia(l,f),null,null,!0,o,s)}return Or()}function Ma(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Fa(t){var e=new Br(t[0],t[1]);return jr.fromTimestamp(e)}function Va(t){var e=t.toTimestamp();return new Js(e.seconds,e.nanoseconds)}function Ua(t){var e=new Br(t.seconds,t.nanoseconds);return jr.fromTimestamp(e)}function qa(t,e){for(var n=(e.baseMutations||[]).map((function(e){return Os(t.Lt,e)})),r=0;r<e.mutations.length-1;++r){var i=e.mutations[r];if(r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform){var o=e.mutations[r+1];i.updateTransforms=o.transform.fieldTransforms,e.mutations.splice(r+1,1),++r}}var s=e.mutations.map((function(e){return Os(t.Lt,e)})),a=Br.fromMillis(e.localWriteTimeMs);return new Ca(e.batchId,a,n,s)}function Ba(t){var e,n,r=Ua(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?Ua(t.lastLimboFreeSnapshotVersion):jr.min();return void 0!==t.query.documents?(Pr(1===(n=t.query).documents.length),e=eo(Wi(As(n.documents[0])))):e=eo(Ms(t.query)),new Ra(e,t.targetId,0,t.lastListenSequenceNumber,r,i,$r.fromBase64String(t.resumeToken))}function ja(t,e){var n,r=Va(e.snapshotVersion),i=Va(e.lastLimboFreeSnapshotVersion);n=Ci(e.target)?Ps(t.Lt,e.target):Ls(t.Lt,e.target);var o=e.resumeToken.toBase64();return new aa(e.targetId,Ai(e.target),r,o,e.sequenceNumber,i,n)}function Ka(t){var e=Ms({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?no(e,e.limit,"L"):e}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ga=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return za(t).get(e).next((function(t){if(t)return{id:(e=t).bundleId,createTime:Ua(e.createTime),version:e.version};var e}))},t.prototype.saveBundleMetadata=function(t,e){return za(t).put({bundleId:(n=e).id,createTime:Va(Ts(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return Qa(t).get(e).next((function(t){if(t)return{name:(e=t).name,query:Ka(e.bundledQuery),readTime:Ua(e.readTime)};var e}))},t.prototype.saveNamedQuery=function(t,e){return Qa(t).put({name:(n=e).name,readTime:Va(Ts(n.readTime)),bundledQuery:n.bundledQuery});var n},t}();function za(t){return ka(t,fa.store)}function Qa(t){return ka(t,da.store)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ha=function(){function t(){this.Bt=new Wa}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),ma.resolve()},t.prototype.getCollectionParents=function(t,e){return ma.resolve(this.Bt.getEntries(e))},t}(),Wa=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Xo(Hr.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new Xo(Hr.comparator)).toArray()},t}(),Ya=function(){function t(){this.qt=new Wa}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener((function(){n.qt.add(e)}));var o={collectionId:r,parent:Ws(i)};return Xa(t).put(o)}return ma.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[qr(e),""],!1,!0);return Xa(t).Nt(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push($s(o.parent))}return n}))},t}();function Xa(t){return ka(t,ha.store)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var $a={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ja=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Za(t,e,n){var r=t.store(ea.store),i=t.store(na.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.$t({range:s},(function(t,e,n){return a++,n.delete()}));o.push(u.next((function(){Pr(1===a)})));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],d=na.key(e,f.key.path,n.batchId);o.push(i.delete(d)),c.push(f.key)}return ma.waitFor(o).next((function(){return c}))}function tu(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Or();e=t.noDocument}return JSON.stringify(e).length}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ja.DEFAULT_COLLECTION_PERCENTILE=10,Ja.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ja.DEFAULT=new Ja(41943040,Ja.DEFAULT_COLLECTION_PERCENTILE,Ja.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ja.DISABLED=new Ja(-1,0,0);var eu=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Qt={}}return t.Kt=function(e,n,r,i){return Pr(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ru(t).$t({index:ea.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=iu(t),s=ru(t);return s.add({}).next((function(a){Pr("number"==typeof a);for(var u=new Ca(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map((function(e){return Rs(t.Lt,e)})),i=n.mutations.map((function(e){return Rs(t.Lt,e)}));return new ea(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),h=[],l=new Xo((function(t,e){return Vr(t.canonicalString(),e.canonicalString())})),f=0,d=r;f<d.length;f++){var p=d[f],y=na.key(i.userId,p.key.path,a);l=l.add(p.key.path.popLast()),h.push(s.put(c)),h.push(o.put(y,na.PLACEHOLDER))}return l.forEach((function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((function(){i.Qt[a]=u.keys()})),ma.waitFor(h).next((function(){return u}))}))},t.prototype.lookupMutationBatch=function(t,e){var n=this;return ru(t).get(e).next((function(t){return t?(Pr(t.userId===n.userId),qa(n.R,t)):null}))},t.prototype.jt=function(t,e){var n=this;return this.Qt[e]?ma.resolve(this.Qt[e]):this.lookupMutationBatch(t,e).next((function(t){if(t){var r=t.keys();return n.Qt[e]=r,r}return null}))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return ru(t).$t({index:ea.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(Pr(e.batchId>=r),o=qa(n.R,e)),i.done()})).next((function(){return o}))},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return ru(t).$t({index:ea.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ru(t).Nt(ea.userMutationsIndex,n).next((function(t){return t.map((function(t){return qa(e.R,t)}))}))},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=na.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return iu(t).$t({range:i},(function(r,i,s){var a=r[0],u=r[1],c=r[2],h=$s(u);if(a===n.userId&&e.path.isEqual(h))return ru(t).get(c).next((function(t){if(!t)throw Or();Pr(t.userId===n.userId),o.push(qa(n.R,t))}));s.done()})).next((function(){return o}))},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Xo(Vr),i=[];return e.forEach((function(e){var o=na.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=iu(t).$t({range:s},(function(t,i,o){var s=t[0],a=t[1],u=t[2],c=$s(a);s===n.userId&&e.path.isEqual(c)?r=r.add(u):o.done()}));i.push(a)})),ma.waitFor(i).next((function(){return n.Wt(t,r)}))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=na.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new Xo(Vr);return iu(t).$t({range:s},(function(t,e,o){var s=t[0],u=t[1],c=t[2],h=$s(u);s===n.userId&&r.isPrefixOf(h)?h.length===i&&(a=a.add(c)):o.done()})).next((function(){return n.Wt(t,a)}))},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(ru(t).get(e).next((function(t){if(null===t)throw Or();Pr(t.userId===n.userId),r.push(qa(n.R,t))})))})),ma.waitFor(i).next((function(){return r}))},t.prototype.removeMutationBatch=function(t,e){var n=this;return Za(t.Mt,this.userId,e).next((function(r){return t.addOnCommittedListener((function(){n.Gt(e.batchId)})),ma.forEach(r,(function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)}))}))},t.prototype.Gt=function(t){delete this.Qt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next((function(n){if(!n)return ma.resolve();var r=IDBKeyRange.lowerBound(na.prefixForUser(e.userId)),i=[];return iu(t).$t({range:r},(function(t,n,r){if(t[0]===e.userId){var o=$s(t[1]);i.push(o)}else r.done()})).next((function(){Pr(0===i.length)}))}))},t.prototype.containsKey=function(t,e){return nu(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return ou(t).get(this.userId).next((function(t){return t||new ta(e.userId,-1,"")}))},t}();function nu(t,e,n){var r=na.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return iu(t).$t({range:o,kt:!0},(function(t,n,r){var o=t[0],a=t[1];t[2],o===e&&a===i&&(s=!0),r.done()})).next((function(){return s}))}function ru(t){return ka(t,ea.store)}function iu(t){return ka(t,na.store)}function ou(t){return ka(t,ta.store)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var su=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),au=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next((function(n){var r=new su(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next((function(t){return jr.fromTimestamp(new Br(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next((function(t){return t.highestListenSequenceNumber}))},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)}))},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next((function(){return n.Xt(t).next((function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)}))}))},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next((function(){return uu(t).delete(e.targetId)})).next((function(){return n.Xt(t)})).next((function(e){return Pr(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)}))},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return uu(t).$t((function(s,a){var u=Ba(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))})).next((function(){return ma.waitFor(o)})).next((function(){return i}))},t.prototype.forEachTarget=function(t,e){return uu(t).$t((function(t,n){var r=Ba(n);e(r)}))},t.prototype.Xt=function(t){return cu(t).get(ca.key).next((function(t){return Pr(null!==t),t}))},t.prototype.Zt=function(t,e){return cu(t).put(ca.key,e)},t.prototype.te=function(t,e){return uu(t).put(ja(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next((function(t){return t.targetCount}))},t.prototype.getTargetData=function(t,e){var n=Ai(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return uu(t).$t({range:r,index:aa.queryTargetsIndexName},(function(t,n,r){var o=Ba(n);ki(e,o.target)&&(i=o,r.done())})).next((function(){return i}))},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=hu(t);return e.forEach((function(e){var s=Ws(e.path);i.push(o.put(new ua(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))})),ma.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=hu(t);return ma.forEach(e,(function(e){var o=Ws(e.path);return ma.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])}))},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=hu(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=hu(t),i=is();return r.$t({range:n,kt:!0},(function(t,e,n){var r=$s(t[1]),o=new ui(r);i=i.add(o)})).next((function(){return i}))},t.prototype.containsKey=function(t,e){var n=Ws(e.path),r=IDBKeyRange.bound([n],[qr(n)],!1,!0),i=0;return hu(t).$t({index:ua.documentTargetsIndex,kt:!0,range:r},(function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.lt=function(t,e){return uu(t).get(e).next((function(t){return t?Ba(t):null}))},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uu(t){return ka(t,aa.store)}function cu(t){return ka(t,ca.store)}function hu(t){return ka(t,ua.store)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lu(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){if(t.code!==Sr.FAILED_PRECONDITION||t.message!==ya)throw t;return kr("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fu(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=Vr(n,i);return 0===s?Vr(r,o):s}var du=function(){function t(t){this.ne=t,this.buffer=new Xo(fu),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();fu(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),pu=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;kr("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,(function(){return r(e,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return Ea(e=n.sent())?(kr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,lu(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}}))}))}))},t}(),yu=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return ma.resolve(_r.o);var r=new du(e);return this.ae.forEachTarget(t,(function(t){return r.re(t.sequenceNumber)})).next((function(){return n.ae.le(t,(function(t){return r.re(t)}))})).next((function(){return r.maxValue}))},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(kr("LruGarbageCollector","Garbage collection skipped; disabled"),ma.resolve($a)):this.getCacheSize(t).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(kr("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),$a):n.fe(t,e)}))},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,i,o,s,a,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((function(e){return e>c.params.maximumSequenceNumbersToCollect?(kr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),r=c.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),c.nthSequenceNumber(t,r)})).next((function(r){return n=r,s=Date.now(),c.removeTargets(t,n,e)})).next((function(e){return i=e,a=Date.now(),c.removeOrphanedDocuments(t,n)})).next((function(t){return u=Date.now(),Ar()<=p.DEBUG&&kr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(a-s)+"ms\n\tRemoved "+t+" documents in "+(u-a)+"ms\nTotal Duration: "+(u-h)+"ms"),ma.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})}))},t}(),vu=function(){function t(t,e){this.db=t,this.garbageCollector=new yu(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.de=function(t){var e=0;return this.le(t,(function(t){e++})).next((function(){return e}))},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,(function(t,n){return e(n)}))},t.prototype.addReference=function(t,e,n){return gu(t,n)},t.prototype.removeReference=function(t,e,n){return gu(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return gu(t,e)},t.prototype._e=function(t,e){return r=e,i=!1,ou(n=t).Ot((function(t){return nu(n,t,r).next((function(t){return t&&(i=!0),ma.resolve(!t)}))})).next((function(){return i}));var n,r,i},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,(function(s,a){if(a<=e){var u=n._e(t,s).next((function(e){if(!e)return o++,r.getEntry(t,s).next((function(){return r.removeEntry(s),hu(t).delete([0,Ws(s.path)])}))}));i.push(u)}})).next((function(){return ma.waitFor(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return gu(t,e)},t.prototype.we=function(t,e){var n,r=hu(t),i=_r.o;return r.$t({index:ua.documentTargetsIndex},(function(t,r){var o=t[0],s=(t[1],r.path),a=r.sequenceNumber;0===o?(i!==_r.o&&e(new ui($s(n)),i),i=a,n=s):i=_r.o})).next((function(){i!==_r.o&&e(new ui($s(n)),i)}))},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function gu(t,e){return hu(t).put((n=e,r=t.currentSequenceNumber,new ua(0,Ws(n.path),r)));var n,r}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var mu=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];if(this.equalsFn(s,t))return a}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){Gr(this.inner,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];t(s,a)}}))},t.prototype.isEmpty=function(){return zr(this.inner)},t}(),bu=function(){function t(){this.changes=new mu((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:jr.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:Si.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?ma.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),wu=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return Eu(t).put(_u(e),n)},t.prototype.removeEntry=function(t,e){var n=Eu(t),r=_u(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.me(t,r)}))},t.prototype.getEntry=function(t,e){var n=this;return Eu(t).get(_u(e)).next((function(t){return n.ye(e,t)}))},t.prototype.ge=function(t,e){var n=this;return Eu(t).get(_u(e)).next((function(t){return{document:n.ye(e,t),size:tu(t)}}))},t.prototype.getEntries=function(t,e){var n=this,r=Zo();return this.pe(t,e,(function(t,e){var i=n.ye(t,e);r=r.insert(t,i)})).next((function(){return r}))},t.prototype.Ee=function(t,e){var n=this,r=Zo(),i=new Ho(ui.comparator);return this.pe(t,e,(function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,tu(e))})).next((function(){return{documents:r,Te:i}}))},t.prototype.pe=function(t,e,n){if(e.isEmpty())return ma.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return Eu(t).$t({range:r},(function(t,e,r){for(var s=ui.fromSegments(t);o&&ui.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()})).next((function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=Zo(),o=e.path.length+1,s={};if(n.isEqual(jr.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=Ma(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=oa.collectionReadTimeIndex}return Eu(t).$t(s,(function(t,n,s){if(t.length===o){var a=Pa(r.R,n);e.path.isPrefixOf(a.key.path)?so(e,a)&&(i=i.insert(a.key,a)):s.done()}})).next((function(){return i}))},t.prototype.newChangeBuffer=function(t){return new Iu(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return Tu(t).get(sa.key).next((function(t){return Pr(!!t),t}))},t.prototype.me=function(t,e){return Tu(t).put(sa.key,e)},t.prototype.ye=function(t,e){if(e){var n=Pa(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(jr.min()))return n}return Si.newInvalidDocument(t)},t}(),Iu=function(e){function n(t,n){var r=this;return(r=e.call(this)||this).Ie=t,r.trackRemovals=n,r.Ae=new mu((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),r}return t(n,e),n.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new Xo((function(t,e){return Vr(t.canonicalString(),e.canonicalString())}));return this.changes.forEach((function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var u=La(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=tu(u);r+=c-a,n.push(e.Ie.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var h=La(e.Ie.R,Si.newNoDocument(o,jr.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))})),i.forEach((function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))})),n.push(this.Ie.updateMetadata(t,r)),ma.waitFor(n)},n.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next((function(t){return n.Ae.set(e,t.size),t.document}))},n.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next((function(t){var e=t.documents;return t.Te.forEach((function(t,e){n.Ae.set(t,e)})),e}))},n}(bu);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tu(t){return ka(t,sa.store)}function Eu(t){return ka(t,oa.store)}function _u(t){return t.path.toArray()}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Su=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;Pr(n<r&&n>=0&&r<=11);var o=new ba("createOrUpgrade",e);n<1&&r>=1&&(t.createObjectStore(Zs.store),function(t){t.createObjectStore(ta.store,{keyPath:ta.keyPath}),t.createObjectStore(ea.store,{keyPath:ea.keyPath,autoIncrement:!0}).createIndex(ea.userMutationsIndex,ea.userMutationsKeyPath,{unique:!0}),t.createObjectStore(na.store)}(t),Du(t),function(t){t.createObjectStore(oa.store)}(t));var s=ma.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(ua.store),t.deleteObjectStore(aa.store),t.deleteObjectStore(ca.store)}(t),Du(t)),s=s.next((function(){return function(t){var e=t.store(ca.store),n=new ca(0,0,jr.min().toTimestamp(),0);return e.put(ca.key,n)}(o)}))),n<4&&r>=4&&(0!==n&&(s=s.next((function(){return function(t,e){return e.store(ea.store).Nt().next((function(n){t.deleteObjectStore(ea.store),t.createObjectStore(ea.store,{keyPath:ea.keyPath,autoIncrement:!0}).createIndex(ea.userMutationsIndex,ea.userMutationsKeyPath,{unique:!0});var r=e.store(ea.store),i=n.map((function(t){return r.put(t)}));return ma.waitFor(i)}))}(t,o)}))),s=s.next((function(){!function(t){t.createObjectStore(la.store,{keyPath:la.keyPath})}(t)}))),n<5&&r>=5&&(s=s.next((function(){return i.Re(o)}))),n<6&&r>=6&&(s=s.next((function(){return function(t){t.createObjectStore(sa.store)}(t),i.be(o)}))),n<7&&r>=7&&(s=s.next((function(){return i.ve(o)}))),n<8&&r>=8&&(s=s.next((function(){return i.Pe(t,o)}))),n<9&&r>=9&&(s=s.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(oa.store);e.createIndex(oa.readTimeIndex,oa.readTimeIndexPath,{unique:!1}),e.createIndex(oa.collectionReadTimeIndex,oa.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(s=s.next((function(){return i.Ve(o)}))),n<11&&r>=11&&(s=s.next((function(){!function(t){t.createObjectStore(fa.store,{keyPath:fa.keyPath})}(t),function(t){t.createObjectStore(da.store,{keyPath:da.keyPath})}(t)}))),s},t.prototype.be=function(t){var e=0;return t.store(oa.store).$t((function(t,n){e+=tu(n)})).next((function(){var n=new sa(e);return t.store(sa.store).put(sa.key,n)}))},t.prototype.Re=function(t){var e=this,n=t.store(ta.store),r=t.store(ea.store);return n.Nt().next((function(n){return ma.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(ea.userMutationsIndex,i).next((function(r){return ma.forEach(r,(function(r){Pr(r.userId===n.userId);var i=qa(e.R,r);return Za(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.ve=function(t){var e=t.store(ua.store),n=t.store(oa.store);return t.store(ca.store).get(ca.key).next((function(t){var r=[];return n.$t((function(n,i){var o=new Hr(n),s=[0,Ws(o)];r.push(e.get(s).next((function(n){return n?ma.resolve():(r=o,e.put(new ua(0,Ws(r),t.highestListenSequenceNumber)));var r})))})).next((function(){return ma.waitFor(r)}))}))},t.prototype.Pe=function(t,e){t.createObjectStore(ha.store,{keyPath:ha.keyPath});var n=e.store(ha.store),r=new Wa,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:Ws(i)})}};return e.store(oa.store).$t({kt:!0},(function(t,e){var n=new Hr(t);return i(n.popLast())})).next((function(){return e.store(na.store).$t({kt:!0},(function(t,e){t[0];var n=t[1],r=(t[2],$s(n));return i(r.popLast())}))}))},t.prototype.Ve=function(t){var e=this,n=t.store(aa.store);return n.$t((function(t,r){var i=Ba(r),o=ja(e.R,i);return n.put(o)}))},t}();function Du(t){t.createObjectStore(ua.store,{keyPath:ua.keyPath}).createIndex(ua.documentTargetsIndex,ua.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(aa.store,{keyPath:aa.keyPath}).createIndex(aa.queryTargetsIndexName,aa.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(ca.store)}var Nu="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Au=function(){function t(e,n,r,i,o,s,a,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fe=null,this.inForeground=!1,this.ke=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new Dr(Sr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");var l,f;this.referenceDelegate=new vu(this,i),this.Le=n+"main",this.R=new Oa(u),this.Be=new wa(this.Le,11,new Su(this.R)),this.qe=new au(this.referenceDelegate,this.R),this.Ut=new Ya,this.Ue=(l=this.R,f=this.Ut,new wu(l,f)),this.Qe=new Ga,this.window&&this.window.localStorage?this.Ke=this.window.localStorage:(this.Ke=null,!1===h&&Cr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new Dr(Sr.FAILED_PRECONDITION,Nu);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t.qe.getHighestSequenceNumber(e)}))})).then((function(e){t.Ne=new _r(e,t.De)})).then((function(){t.xe=!0})).catch((function(e){return t.Be&&t.Be.close(),Promise.reject(e)}))},t.prototype.He=function(t){var e=this;return this.Me=function(n){return r(e,void 0,void 0,(function(){return i(this,(function(e){return this.started?[2,t(n)]:[2]}))}))},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt((function(n){return r(e,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget((function(){return r(e,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return Cu(e).put(new la(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.Je(e).next((function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable((function(){return t.Me(!1)})))}))})).next((function(){return t.Ye(e)})).next((function(n){return t.isPrimary&&!n?t.Xe(e).next((function(){return!1})):!!n&&t.Ze(e).next((function(){return!0}))}))})).catch((function(e){if(Ea(e))return kr("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return kr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.Se.enqueueRetryable((function(){return t.Me(e)})),t.isPrimary=e}))},t.prototype.Je=function(t){var e=this;return ku(t).get(Zs.key).next((function(t){return ma.resolve(e.tn(t))}))},t.prototype.en=function(t){return Cu(t).delete(this.clientId)},t.prototype.nn=function(){return r(this,void 0,void 0,(function(){var t,e,n,r,o=this;return i(this,(function(i){switch(i.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(t){var e=ka(t,la.store);return e.Nt().next((function(t){var n=o.rn(t,18e5),r=t.filter((function(t){return-1===n.indexOf(t)}));return ma.forEach(r,(function(t){return e.delete(t.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}))]);case 1:if(t=i.sent(),this.Ke)for(e=0,n=t;e<n.length;e++)r=n[e],this.Ke.removeItem(this.on(r.clientId));i.label=2;case 2:return[2]}}))}))},t.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,(function(){return t.je().then((function(){return t.nn()})).then((function(){return t.ze()}))}))},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?ma.resolve(!0):ku(t).get(Zs.key).next((function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new Dr(Sr.FAILED_PRECONDITION,Nu);return!1}}return!(!e.networkEnabled||!e.inForeground)||Cu(t).Nt().next((function(t){return void 0===e.rn(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&kr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},t.prototype.shutdown=function(){return r(this,void 0,void 0,(function(){var t=this;return i(this,(function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[Zs.store,la.store],(function(e){var n=new Aa(e,_r.o);return t.Xe(n).next((function(){return t.en(n)}))}))];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}}))}))},t.prototype.rn=function(t,e){var n=this;return t.filter((function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)}))},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return Cu(e).Nt().next((function(e){return t.rn(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return eu.Kt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Qe},t.prototype.runTransaction=function(t,e,n){var r=this;kr("IndexedDbPersistence","Starting transaction:",t);var i,o="readonly"===e?"readonly":"readwrite";return this.Be.runTransaction(t,o,pa,(function(o){return i=new Aa(o,r.Ne?r.Ne.next():_r.o),"readwrite-primary"===e?r.Je(i).next((function(t){return!!t||r.Ye(i)})).next((function(e){if(!e)throw Cr("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.Se.enqueueRetryable((function(){return r.Me(!1)})),new Dr(Sr.FAILED_PRECONDITION,ya);return n(i)})).next((function(t){return r.Ze(i).next((function(){return t}))})):r.dn(i).next((function(){return n(i)}))})).then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.dn=function(t){var e=this;return ku(t).get(Zs.key).next((function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Dr(Sr.FAILED_PRECONDITION,Nu)}))},t.prototype.Ze=function(t){var e=new Zs(this.clientId,this.allowTabSynchronization,Date.now());return ku(t).put(Zs.key,e)},t.yt=function(){return wa.yt()},t.prototype.Xe=function(t){var e=this,n=ku(t);return n.get(Zs.key).next((function(t){return e.tn(t)?(kr("IndexedDbPersistence","Releasing primary lease."),n.delete(Zs.key)):ma.resolve()}))},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(Cr("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ke=function(){t.Se.enqueueAndForget((function(){return t.inForeground="visible"===t.document.visibilityState,t.je()}))},this.document.addEventListener("visibilitychange",this.ke),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.ke&&(this.document.removeEventListener("visibilitychange",this.ke),this.ke=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Fe=function(){e.un(),e.Se.enqueueAndForget((function(){return e.shutdown()}))},this.window.addEventListener("pagehide",this.Fe))},t.prototype.hn=function(){this.Fe&&(this.window.removeEventListener("pagehide",this.Fe),this.Fe=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Ke)||void 0===e?void 0:e.getItem(this.on(t)));return kr("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(r){return Cr("IndexedDbPersistence","Failed to get zombied client id.",r),!1}},t.prototype.un=function(){if(this.Ke)try{this.Ke.setItem(this.on(this.clientId),String(Date.now()))}catch(t){Cr("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Ke)try{this.Ke.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function ku(t){return ka(t,Zs.store)}function Cu(t){return ka(t,la.store)}function xu(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var Ru=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next((function(r){return n.yn(t,e,r)}))},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next((function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t}))},t.prototype.gn=function(t,e){t.forEach((function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)}))},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next((function(e){return n.En(t,e).next((function(){return e}))}))},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next((function(t){return n.gn(e,t)}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return r=e,ui.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.Tn(t,e.path):Zi(e)?this.In(t,e,n):this.An(t,e,n);var r},t.prototype.Tn=function(t,e){return this.mn(t,new ui(e)).next((function(t){var e=es();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=es();return this.Ut.getCollectionParents(t,i).next((function(s){return ma.forEach(s,(function(s){var a,u,c=(a=e,u=s.child(i),new Qi(u,null,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt));return r.An(t,c,n).next((function(t){t.forEach((function(t,e){o=o.insert(t,e)}))}))})).next((function(){return o}))}))},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next((function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)})).next((function(e){return i=e,o.Rn(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c);null==h&&(h=Si.newInvalidDocument(c),r=r.insert(c,h)),xo(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}}))})).next((function(){return r.forEach((function(t,n){so(e,n)||(r=r.remove(t))})),r}))},t.prototype.Rn=function(t,e,n){for(var r=is(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof Mo&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next((function(t){return t.forEach((function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))})),c}))},t}(),Ou=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=is(),i=is(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),Pu=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i,o=this;return 0===(i=e).filters.length&&null===i.limit&&null==i.startAt&&null==i.endAt&&(0===i.explicitOrderBy.length||1===i.explicitOrderBy.length&&i.explicitOrderBy[0].field.isKeyField())||n.isEqual(jr.min())?this.Dn(t,e):this.Sn.pn(t,r).next((function(i){var s=o.Cn(e,i);return(Yi(e)||Xi(e))&&o.Nn(e.limitType,s,r,n)?o.Dn(t,e):(Ar()<=p.DEBUG&&kr("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),oo(e)),o.Sn.getDocumentsMatchingQuery(t,e,n).next((function(t){return s.forEach((function(e){t=t.insert(e.key,e)})),t})))}))},t.prototype.Cn=function(t,e){var n=new Xo(ao(t));return e.forEach((function(e,r){so(t,r)&&(n=n.add(r))})),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return Ar()<=p.DEBUG&&kr("QueryEngine","Using full collection scan to execute query:",oo(e)),this.Sn.getDocumentsMatchingQuery(t,e,jr.min())},t}(),Lu=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.Fn=new Ho(Vr),this.kn=new mu((function(t){return Ai(t)}),ki),this.$n=jr.min(),this._n=t.getMutationQueue(n),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new Ru(this.On,this._n,this.persistence.getIndexManager()),this.Qe=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.collect(n,e.Fn)}))},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mu(t,e,n,r){return new Lu(t,e,n,r)}function Fu(t,e){return r(this,void 0,void 0,(function(){var n,r,o,s;return i(this,(function(i){switch(i.label){case 0:return n=Lr(t),r=n._n,o=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",(function(t){var i;return n._n.getAllMutationBatches(t).next((function(s){return i=s,r=n.persistence.getMutationQueue(e),o=new Ru(n.On,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)})).next((function(e){for(var n=[],r=[],s=is(),a=0,u=i;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++){var f=l[h];s=s.add(f.key)}}for(var d=0,p=e;d<p.length;d++){var y=p[d];r.push(y.batchId);for(var v=0,g=y.mutations;v<g.length;v++){var m=g[v];s=s.add(m.key)}}return o.pn(t,s).next((function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}}))}))}))];case 1:return s=i.sent(),[2,(n._n=r,n.Mn=o,n.xn.Vn(n.Mn),s)]}}))}))}function Vu(t,e){var n=Lr(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(t){var r,i,o,s,a,u,c,h=e.batch.keys(),l=n.On.newChangeBuffer({trackRemovals:!0});return(r=n,i=t,o=e,s=l,a=o.batch,u=a.keys(),c=ma.resolve(),u.forEach((function(t){c=c.next((function(){return s.getEntry(i,t)})).next((function(e){var n=o.docVersions.get(t);Pr(null!==n),e.version.compareTo(n)<0&&(a.applyToRemoteDocument(e,o),e.isValidDocument()&&s.addEntry(e,o.commitVersion))}))})),c.next((function(){return r._n.removeMutationBatch(i,a)}))).next((function(){return l.apply(t)})).next((function(){return n._n.performConsistencyCheck(t)})).next((function(){return n.Mn.pn(t,h)}))}))}function Uu(t){var e=Lr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(function(t){return e.qe.getLastRemoteSnapshotVersion(t)}))}function qu(t,e){var n=Lr(t),r=e.snapshotVersion,i=n.Fn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(t){var o=n.On.newChangeBuffer({trackRemovals:!0});i=n.Fn;var s=[];e.targetChanges.forEach((function(e,o){var a,u,c,h=i.get(o);if(h){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next((function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)})));var l=e.resumeToken;if(l.approximateByteSize()>0){var f=h.withResumeToken(l,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,f),a=h,c=e,Pr((u=f).resumeToken.approximateByteSize()>0),(0===a.resumeToken.approximateByteSize()||u.snapshotVersion.toMicroseconds()-a.snapshotVersion.toMicroseconds()>=3e8||c.addedDocuments.size+c.modifiedDocuments.size+c.removedDocuments.size>0)&&s.push(n.qe.updateTargetData(t,f))}}}));var a=Zo();if(e.documentUpdates.forEach((function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),s.push(function(t,e,n,r,i){var o=is();return n.forEach((function(t){return o=o.add(t)})),e.getEntries(t,o).next((function(t){var o=Zo();return n.forEach((function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(jr.min())?(e.removeEntry(n,u),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):kr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)})),o}))}(t,o,e.documentUpdates,r,void 0).next((function(t){a=t}))),!r.isEqual(jr.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next((function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)}));s.push(u)}return ma.waitFor(s).next((function(){return o.apply(t)})).next((function(){return n.Mn.En(t,a)})).next((function(){return a}))})).then((function(t){return n.Fn=i,t}))}function Bu(t,e){var n=Lr(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)}))}function ju(t,e){var n=Lr(t);return n.persistence.runTransaction("Allocate target","readwrite",(function(t){var r;return n.qe.getTargetData(t,e).next((function(i){return i?(r=i,ma.resolve(r)):n.qe.allocateTargetId(t).next((function(i){return r=new Ra(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next((function(){return r}))}))}))})).then((function(t){var r=n.Fn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Fn=n.Fn.insert(t.targetId,t),n.kn.set(e,t.targetId)),t}))}function Ku(t,e,n){return r(this,void 0,void 0,(function(){var r,o,s,a;return i(this,(function(i){switch(i.label){case 0:r=Lr(t),o=r.Fn.get(e),s=n?"readwrite":"readwrite-primary",i.label=1;case 1:return i.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",s,(function(t){return r.persistence.referenceDelegate.removeTarget(t,o)}))];case 2:i.sent(),i.label=3;case 3:return[3,5];case 4:if(!Ea(a=i.sent()))throw a;return kr("LocalStore","Failed to update sequence numbers for target "+e+": "+a),[3,5];case 5:return r.Fn=r.Fn.remove(e),r.kn.delete(o.target),[2]}}))}))}function Gu(t,e,n){var r=Lr(t),i=jr.min(),o=is();return r.persistence.runTransaction("Execute query","readonly",(function(t){return(s=r,a=t,u=eo(e),c=Lr(s),h=c.kn.get(u),void 0!==h?ma.resolve(c.Fn.get(h)):c.qe.getTargetData(a,u)).next((function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next((function(t){o=t}))})).next((function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:jr.min(),n?o:is())})).next((function(t){return{documents:t,Bn:o}}));var s,a,u,c,h}))}function zu(t,e){var n=Lr(t),r=Lr(n.qe),i=n.Fn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(t){return r.lt(t,e).next((function(t){return t?t.target:null}))}))}function Qu(t){var e=Lr(t);return e.persistence.runTransaction("Get new document changes","readonly",(function(t){return n=e.On,r=t,i=e.$n,o=Lr(n),s=Zo(),a=Ma(i),u=Eu(r),c=IDBKeyRange.lowerBound(a,!0),u.$t({index:oa.readTimeIndex,range:c},(function(t,e){var n=Pa(o.R,e);s=s.insert(n.key,n),a=e.readTime})).next((function(){return{wn:s,readTime:Fa(a)}}));var n,r,i,o,s,a,u,c})).then((function(t){var n=t.wn,r=t.readTime;return e.$n=r,n}))}function Hu(t){return r(this,void 0,void 0,(function(){var e;return i(this,(function(n){return[2,(e=Lr(t)).persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return e=Eu(t),n=jr.min(),e.$t({index:oa.readTimeIndex,reverse:!0},(function(t,e,r){e.readTime&&(n=Fa(e.readTime)),r.done()})).next((function(){return n}));var e,n})).then((function(t){e.$n=t}))]}))}))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Wu=function(){function t(t){this.R=t,this.Kn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return ma.resolve(this.Kn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Kn.set(e.id,{id:(n=e).id,version:n.version,createTime:Ts(n.createTime)}),ma.resolve()},t.prototype.getNamedQuery=function(t,e){return ma.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,{name:(n=e).name,query:Ka(n.bundledQuery),readTime:Ts(n.readTime)}),ma.resolve();var n},t}(),Yu=function(){function t(){this.Wn=new Xo(Xu.Gn),this.zn=new Xo(Xu.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new Xu(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach((function(t){return n.addReference(t,e)}))},t.prototype.removeReference=function(t,e){this.Yn(new Xu(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach((function(t){return n.removeReference(t,e)}))},t.prototype.Zn=function(t){var e=this,n=new ui(new Hr([])),r=new Xu(n,t),i=new Xu(n,t+1),o=[];return this.zn.forEachInRange([r,i],(function(t){e.Yn(t),o.push(t.key)})),o},t.prototype.ts=function(){var t=this;this.Wn.forEach((function(e){return t.Yn(e)}))},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new ui(new Hr([])),n=new Xu(e,t),r=new Xu(e,t+1),i=is();return this.zn.forEachInRange([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.containsKey=function(t){var e=new Xu(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),Xu=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return ui.comparator(t.key,e.key)||Vr(t.ns,e.ns)},t.Hn=function(t,e){return Vr(t.ns,e.ns)||ui.comparator(t.key,e.key)},t}(),$u=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new Xo(Xu.Gn)}return t.prototype.checkEmpty=function(t){return ma.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++,this._n.length>0&&this._n[this._n.length-1];var o=new Ca(i,e,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.rs=this.rs.add(new Xu(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return ma.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return ma.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.cs(n),i=r<0?0:r;return ma.resolve(this._n.length>i?this._n[i]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return ma.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return ma.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new Xu(e,0),i=new Xu(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],(function(t){var e=n.os(t.ns);o.push(e)})),ma.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Xo(Vr);return e.forEach((function(t){var e=new Xu(t,0),i=new Xu(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],(function(t){r=r.add(t.ns)}))})),ma.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;ui.isDocumentKey(i)||(i=i.child(""));var o=new Xu(new ui(i),0),s=new Xo(Vr);return this.rs.forEachWhile((function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)}),o),ma.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.os(t);null!==r&&n.push(r)})),n},t.prototype.removeMutationBatch=function(t,e){var n=this;Pr(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return ma.forEach(e.mutations,(function(i){var o=new Xu(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)})).next((function(){n.rs=r}))},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new Xu(e,0),r=this.rs.firstAfterOrEqual(n);return ma.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return this._n.length,ma.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),Ju=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new Ho(ui.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return ma.resolve(n?n.document.clone():Si.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=Zo();return e.forEach((function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():Si.newInvalidDocument(t))})),ma.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=Zo(),i=new ui(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.key,u=s.value,c=u.document,h=u.readTime;if(!e.path.isPrefixOf(a.path))break;h.compareTo(n)<=0||so(e,c)&&(r=r.insert(c.key,c.clone()))}return ma.resolve(r)},t.prototype.fs=function(t,e){return ma.forEach(this.docs,(function(t){return e(t)}))},t.prototype.newChangeBuffer=function(t){return new Zu(this)},t.prototype.getSize=function(t){return ma.resolve(this.size)},t}(),Zu=function(e){function n(t){var n=this;return(n=e.call(this)||this).Ie=t,n}return t(n,e),n.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach((function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)})),ma.waitFor(n)},n.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},n.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},n}(bu),tc=function(){function t(t){this.persistence=t,this.ds=new mu((function(t){return Ai(t)}),ki),this.lastRemoteSnapshotVersion=jr.min(),this.highestTargetId=0,this.ws=0,this._s=new Yu,this.targetCount=0,this.ys=su.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach((function(t,n){return e(n)})),ma.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return ma.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return ma.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),ma.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),ma.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new su(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,ma.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),ma.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,ma.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach((function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)})),ma.waitFor(o).next((function(){return i}))},t.prototype.getTargetCount=function(t){return ma.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return ma.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),ma.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((function(e){i.push(r.markPotentiallyOrphaned(t,e))})),ma.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),ma.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return ma.resolve(n)},t.prototype.containsKey=function(t,e){return ma.resolve(this._s.containsKey(e))},t}(),ec=function(){function t(t,e){var n,r=this;this.gs={},this.Ne=new _r(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new tc(this),this.Ut=new Ha,this.Ue=(n=this.Ut,new Ju(n,(function(t){return r.referenceDelegate.ps(t)}))),this.R=new Oa(e),this.Qe=new Wu(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new $u(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Qe},t.prototype.runTransaction=function(t,e,n){var r=this;kr("MemoryPersistence","Starting transaction:",t);var i=new nc(this.Ne.next());return this.referenceDelegate.Es(),n(i).next((function(t){return r.referenceDelegate.Ts(i).next((function(){return t}))})).toPromise().then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.Is=function(t,e){return ma.or(Object.values(this.gs).map((function(n){return function(){return n.containsKey(t,e)}})))},t}(),nc=function(e){function n(t){var n=this;return(n=e.call(this)||this).currentSequenceNumber=t,n}return t(n,e),n}(va),rc=function(){function t(t){this.persistence=t,this.As=new Yu,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw Or()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),ma.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),ma.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),ma.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach((function(t){return n.vs.add(t.toString())}));var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next((function(t){t.forEach((function(t){return n.vs.add(t.toString())}))})).next((function(){return r.removeTargetData(t,e)}))},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ma.forEach(this.vs,(function(r){var i=ui.fromPath(r);return e.Ps(t,i).next((function(t){t||n.removeEntry(i)}))})).next((function(){return e.Rs=null,n.apply(t)}))},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next((function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())}))},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return ma.or([function(){return ma.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),ic=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oc(t,e){return"firestore_clients_"+t+"_"+e}function sc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function ac(t,e){return"firestore_targets_"+t+"_"+e}ic.UNAUTHENTICATED=new ic(null),ic.GOOGLE_CREDENTIALS=new ic("google-credentials-uid"),ic.FIRST_PARTY=new ic("first-party-uid");var uc=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new Dr(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(Cr("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),cc=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new Dr(i.error.code,i.error.message)),o?new t(e,i.state,r):(Cr("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),hc=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=ss(),s=0;i&&s<r.activeTargetIds.length;++s)i=ai(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(Cr("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),lc=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(Cr("SharedClientState","Failed to parse online state: "+e),null)},t}(),fc=function(){function t(){this.activeTargetIds=ss()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),dc=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.Fs.bind(this),this.ks=new Ho(Vr),this.started=!1,this.$s=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Os=oc(this.persistenceKey,this.Ns),this.Ms="firestore_sequence_number_"+this.persistenceKey,this.ks=this.ks.insert(this.Ns,new fc),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Qs=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return r(this,void 0,void 0,(function(){var t,e,n,r,o,s,a,u,c,h,l,f=this;return i(this,(function(i){switch(i.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=i.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ns&&(o=this.getItem(oc(this.persistenceKey,r)))&&(s=hc.Vs(r,o))&&(this.ks=this.ks.insert(s.clientId,s));for(this.Ks(),(a=this.storage.getItem(this.Us))&&(u=this.js(a))&&this.Ws(u),c=0,h=this.$s;c<h.length;c++)l=h[c],this.Fs(l);return this.$s=[],this.window.addEventListener("pagehide",(function(){return f.shutdown()})),this.started=!0,[2]}}))}))},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.ks)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.ks.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(ac(this.persistenceKey,t));if(n){var r=cc.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Ks(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Ks()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(ac(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach((function(t){r.Hs(t)})),this.currentUser=t,n.forEach((function(t){r.addPendingMutation(t)}))},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return kr("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){kr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){kr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Fs=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(kr("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Os)return void Cr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable((function(){return r(e,void 0,void 0,(function(){var t,e,r,o,s,a;return i(this,(function(i){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(e=this.ni(n.key,n.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(r=this.si(n.key,n.newValue)))return[2,this.ii(r)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(o=this.ri(n.key,n.newValue)))return[2,this.oi(o)]}else if(n.key===this.Us){if(null!==n.newValue&&(s=this.js(n.newValue)))return[2,this.Ws(s)]}else if(n.key===this.Ms)(a=function(t){var e=_r.o;if(null!=t)try{var n=JSON.parse(t);Pr("number"==typeof n),e=n}catch(r){Cr("SharedClientState","Failed to read sequence number from WebStorage",r)}return e}(n.newValue))!==_r.o&&this.sequenceNumberHandler(a);else if(n.key===this.Qs)return[2,this.syncEngine.ci()]}else this.$s.push(n);return[2]}))}))}))}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.ks.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Ks=function(){this.setItem(this.Os,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new uc(this.currentUser,t,e,n),i=sc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=sc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){var e={clientId:this.Ns,onlineState:t};this.storage.setItem(this.Us,JSON.stringify(e))},t.prototype.Ys=function(t,e,n){var r=ac(this.persistenceKey,t),i=new cc(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Qs,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return hc.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return uc.Vs(new ic(i),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return cc.Vs(r,e)},t.prototype.js=function(t){return lc.Vs(t)},t.prototype.ii=function(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(kr("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.ks.insert(t,e):this.ks.remove(t),i=this.Gs(this.ks),o=this.Gs(r),s=[],a=[];return o.forEach((function(t){i.has(t)||s.push(t)})),i.forEach((function(t){o.has(t)||a.push(t)})),this.syncEngine.hi(s,a).then((function(){n.ks=r}))},t.prototype.Ws=function(t){this.ks.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=ss();return t.forEach((function(t,n){e=e.unionWith(n.activeTargetIds)})),e},t}(),pc=function(){function t(){this.li=new fc,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new fc,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),yc=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),vc=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){kr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){kr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),gc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},mc=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),bc=function(e){function n(t){var n=this;return(n=e.call(this,t)||this).forceLongPolling=t.forceLongPolling,n.autoDetectLongPolling=t.autoDetectLongPolling,n}return t(n,e),n.prototype.ki=function(t,e,n,r){return new Promise((function(i,o){var s=new Er;s.listenOnce(mr.COMPLETE,(function(){try{switch(s.getLastErrorCode()){case gr.NO_ERROR:var e=s.getResponseJson();kr("Connection","XHR received:",JSON.stringify(e)),i(e);break;case gr.TIMEOUT:kr("Connection",'RPC "'+t+'" timed out'),o(new Dr(Sr.DEADLINE_EXCEEDED,"Request time out"));break;case gr.HTTP_ERROR:var n=s.getStatus();if(kr("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=(u=r.status,c=u.toLowerCase().replace(/_/g,"-"),Object.values(Sr).indexOf(c)>=0?c:Sr.UNKNOWN);o(new Dr(a,r.message))}else o(new Dr(Sr.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new Dr(Sr.UNAVAILABLE,"Connection failed."));break;default:Or()}}finally{kr("Connection",'RPC "'+t+'" completed.')}var u,c}));var a=JSON.stringify(r);s.send(e,"POST",a,n,15)}))},n.prototype.Oi=function(t,e){var n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=new fr,i=de(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.Fi(l.initMessageHeaders,e),o()||s()||a()||u()||c()||h()||(l.httpHeadersOverwriteParam="$httpHeaders");var f=n.join("");kr("Connection","Creating WebChannel: "+f,l);var d=r.createWebChannel(f,l),p=!1,y=!1,v=new mc({Ei:function(t){y?kr("Connection","Not sending because WebChannel is closed:",t):(p||(kr("Connection","Opening WebChannel transport."),d.open(),p=!0),kr("Connection","WebChannel sending:",t),d.send(t))},Ti:function(){return d.close()}}),g=function(t,e,n){t.listen(e,(function(t){try{n(t)}catch(e){setTimeout((function(){throw e}),0)}}))};return g(d,Tr.EventType.OPEN,(function(){y||kr("Connection","WebChannel transport opened.")})),g(d,Tr.EventType.CLOSE,(function(){y||(y=!0,kr("Connection","WebChannel transport closed"),v.Vi())})),g(d,Tr.EventType.ERROR,(function(t){y||(y=!0,xr("Connection","WebChannel transport errored:",t),v.Vi(new Dr(Sr.UNAVAILABLE,"The operation could not be completed")))})),g(d,Tr.EventType.MESSAGE,(function(t){var e;if(!y){var n=t.data[0];Pr(!!n);var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){kr("Connection","WebChannel received error:",i);var o=i.status,s=function(t){var e=qo[t];if(void 0!==e)return Qo(e)}(o),a=i.message;void 0===s&&(s=Sr.INTERNAL,a="Unknown error status: "+o+" with message "+i.message),y=!0,v.Vi(new Dr(s,a)),d.close()}else kr("Connection","WebChannel received:",n),v.Si(n)}})),g(i,br.STAT_EVENT,(function(t){t.stat===wr?kr("Connection","Detected buffering proxy"):t.stat===Ir&&kr("Connection","Detected no buffering proxy")})),setTimeout((function(){v.Pi()}),0),v},n}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.Di=e+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);kr("RestConnection","Sending: ",i,n);var o={};return this.Fi(o,r),this.ki(t,i,o,n).then((function(t){return kr("RestConnection","Received: ",t),t}),(function(e){throw xr("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e}))},t.prototype.$i=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.Fi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.6.3",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){var n=gc[t];return this.Di+"/v1/"+e+":"+n},t}());
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wc(){return"undefined"!=typeof window?window:null}function Ic(){return"undefined"!=typeof document?document:null}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tc(t){return new ms(t,!0)}var Ec=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Qi=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Ki=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Qi),i=Math.max(0,n-r);i>0&&kr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,(function(){return e.Qi=Date.now(),t()})),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),_c=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new Ec(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,(function(){return t.rr()})))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return r(this,void 0,void 0,(function(){return i(this,(function(t){return this.er()?[2,this.close(0)]:[2]}))}))},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return r(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===Sr.RESOURCE_EXHAUSTED?(Cr(e.toString()),Cr("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Ki()):e&&e.code===Sr.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}}))}))},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then((function(e){t.Yi===n&&t.lr(e)}),(function(n){e((function(){var e=new Dr(Sr.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)}))}))},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii((function(){n((function(){return e.state=2,e.listener.Ii()}))})),this.stream.Ri((function(t){n((function(){return e.dr(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji((function(){return r(t,void 0,void 0,(function(){return i(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},t.prototype.dr=function(t){return kr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget((function(){return e.Yi===t?n():(kr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},t}(),Sc=function(e){function n(t,n,r,i,o){var s=this;return(s=e.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return t(n,e),n.prototype.wr=function(t){return this.Hi.Oi("Listen",t)},n.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n,r;if("targetChange"in e){e.targetChange;var i="NO_CHANGE"===(r=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:Or(),o=e.targetChange.targetIds||[],s=function(t,e){return t.I?(Pr(void 0===e||"string"==typeof e),$r.fromBase64String(e||"")):(Pr(void 0===e||e instanceof Uint8Array),$r.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),a=(u=e.targetChange.cause)&&function(t){var e=void 0===t.code?Sr.UNKNOWN:Qo(t.code);return new Dr(e,t.message||"")}(u);n=new ls(i,o,s,a||null)}else if("documentChange"in e){e.documentChange,(i=e.documentChange).document,i.document.name,i.document.updateTime,o=Ds(t,i.document.name),s=Ts(i.document.updateTime);var u=new Ei({mapValue:{fields:i.document.fields}}),c=(a=Si.newFoundDocument(o,s,u),i.targetIds||[]),h=i.removedTargetIds||[];n=new cs(c,h,a.key,a)}else if("documentDelete"in e)e.documentDelete,(i=e.documentDelete).document,o=Ds(t,i.document),s=i.readTime?Ts(i.readTime):jr.min(),u=Si.newNoDocument(o,s),a=i.removedTargetIds||[],n=new cs([],a,u.key,u);else if("documentRemove"in e)e.documentRemove,(i=e.documentRemove).document,o=Ds(t,i.document),s=i.removedTargetIds||[],n=new cs([],s,o,null);else{if(!("filter"in e))return Or();e.filter;var l=e.filter;l.targetId,i=l.count||0,o=new Go(i),s=l.targetId,n=new hs(s,o)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return jr.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?jr.min():e.readTime?Ts(e.readTime):jr.min()}(t);return this.listener._r(e,n)},n.prototype.mr=function(t){var e,n,r,i,o={};o.database=ks(this.R),o.addTarget=(e=this.R,i=(n=t).target,(r=Ci(i)?{documents:Ps(e,i)}:{query:Ls(e,i)}).targetId=n.targetId,n.resumeToken.approximateByteSize()>0?r.resumeToken=ws(e,n.resumeToken):n.snapshotVersion.compareTo(jr.min())>0&&(r.readTime=bs(e,n.snapshotVersion.toTimestamp())),r);var s=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Or()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.R,t);s&&(o.labels=s),this.cr(o)},n.prototype.yr=function(t){var e={};e.database=ks(this.R),e.removeTarget=t,this.cr(e)},n}(_c),Dc=function(e){function n(t,n,r,i,o){var s=this;return(s=e.call(this,t,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return t(n,e),Object.defineProperty(n.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),n.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,e.prototype.start.call(this)},n.prototype.ar=function(){this.gr&&this.Er([])},n.prototype.wr=function(t){return this.Hi.Oi("Write",t)},n.prototype.onMessage=function(t){if(Pr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=(r=t.writeResults,i=t.commitTime,r&&r.length>0?(Pr(void 0!==i),r.map((function(t){return n=i,(r=(e=t).updateTime?Ts(e.updateTime):Ts(n)).isEqual(jr.min())&&(r=Ts(n)),new Do(r,e.transformResults||[]);var e,n,r}))):[]),n=Ts(t.commitTime);return this.listener.Tr(n,e)}var r,i;return Pr(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},n.prototype.Ar=function(){var t={};t.database=ks(this.R),this.cr(t)},n.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map((function(t){return Rs(e.R,t)}))};this.cr(n)},n}(_c),Nc=function(e){function n(t,n,r){var i=this;return(i=e.call(this)||this).credentials=t,i.Hi=n,i.R=r,i.Rr=!1,i}return t(n,e),n.prototype.br=function(){if(this.Rr)throw new Dr(Sr.FAILED_PRECONDITION,"The client has already been terminated.")},n.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then((function(i){return r.Hi.Ni(t,e,n,i)})).catch((function(t){throw"FirebaseError"===t.name?(t.code===Sr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new Dr(Sr.UNKNOWN,t.toString())}))},n.prototype.$i=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then((function(i){return r.Hi.$i(t,e,n,i)})).catch((function(t){throw"FirebaseError"===t.name?(t.code===Sr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new Dr(Sr.UNKNOWN,t.toString())}))},n.prototype.terminate=function(){this.Rr=!0},n}((function(){})),Ac=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()})))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.Fr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.Fr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(Cr(e),this.Vr=!1):kr("OnlineStateTracker",e)},t.prototype.Fr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),kc=function(t,e,n,o,s){var a=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.kr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=s,this.Lr.di((function(t){n.enqueueAndForget((function(){return r(a,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return Vc(this)?(kr("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return r(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return(e=Lr(t)).Or.add(4),[4,xc(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.Or.delete(4),[4,Cc(e)];case 2:return n.sent(),[2]}}))}))}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.Br=new Ac(n,o)};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cc(t){return r(this,void 0,void 0,(function(){var e,n;return i(this,(function(r){switch(r.label){case 0:if(!Vc(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function xc(t){return r(this,void 0,void 0,(function(){var e,n;return i(this,(function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function Rc(t,e){var n=Lr(t);n.$r.has(e.targetId)||(n.$r.set(e.targetId,e),Fc(n)?Mc(n):Zc(n).er()&&Pc(n,e))}function Oc(t,e){var n=Lr(t),r=Zc(n);n.$r.delete(e),r.er()&&Lc(n,e),0===n.$r.size&&(r.er()?r.ir():Vc(n)&&n.Br.set("Unknown"))}function Pc(t,e){t.qr.U(e.targetId),Zc(t).mr(e)}function Lc(t,e){t.qr.U(e),Zc(t).yr(e)}function Mc(t){t.qr=new ds({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.$r.get(e)||null}}),Zc(t).start(),t.Br.Sr()}function Fc(t){return Vc(t)&&!Zc(t).tr()&&t.$r.size>0}function Vc(t){return 0===Lr(t).Or.size}function Uc(t){t.qr=void 0}function qc(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){return t.$r.forEach((function(e,n){Pc(t,e)})),[2]}))}))}function Bc(t,e){return r(this,void 0,void 0,(function(){return i(this,(function(n){return Uc(t),Fc(t)?(t.Br.Nr(e),Mc(t)):t.Br.set("Unknown"),[2]}))}))}function jc(t,e,n){return r(this,void 0,void 0,(function(){var o,s,a;return i(this,(function(u){switch(u.label){case 0:if(t.Br.set("Online"),!(e instanceof ls&&2===e.state&&e.cause))return[3,6];u.label=1;case 1:return u.trys.push([1,3,,5]),[4,function(t,e){return r(this,void 0,void 0,(function(){var n,r,o,s;return i(this,(function(i){switch(i.label){case 0:n=e.cause,r=0,o=e.targetIds,i.label=1;case 1:return r<o.length?(s=o[r],t.$r.has(s)?[4,t.remoteSyncer.rejectListen(s,n)]:[3,3]):[3,5];case 2:i.sent(),t.$r.delete(s),t.qr.removeTarget(s),i.label=3;case 3:i.label=4;case 4:return r++,[3,1];case 5:return[2]}}))}))}(t,e)];case 2:return u.sent(),[3,5];case 3:return o=u.sent(),kr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),o),[4,Kc(t,o)];case 4:return u.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof cs?t.qr.X(e):e instanceof hs?t.qr.rt(e):t.qr.et(e),n.isEqual(jr.min()))return[3,13];u.label=7;case 7:return u.trys.push([7,11,,13]),[4,Uu(t.localStore)];case 8:return s=u.sent(),n.compareTo(s)>=0?[4,(c=t,h=n,l=c.qr.ut(h),l.targetChanges.forEach((function(t,e){if(t.resumeToken.approximateByteSize()>0){var n=c.$r.get(e);n&&c.$r.set(e,n.withResumeToken(t.resumeToken,h))}})),l.targetMismatches.forEach((function(t){var e=c.$r.get(t);if(e){c.$r.set(t,e.withResumeToken($r.EMPTY_BYTE_STRING,e.snapshotVersion)),Lc(c,t);var n=new Ra(e.target,t,1,e.sequenceNumber);Pc(c,n)}})),c.remoteSyncer.applyRemoteEvent(l))]:[3,10];case 9:u.sent(),u.label=10;case 10:return[3,13];case 11:return kr("RemoteStore","Failed to raise snapshot:",a=u.sent()),[4,Kc(t,a)];case 12:return u.sent(),[3,13];case 13:return[2]}var c,h,l}))}))}function Kc(t,e,n){return r(this,void 0,void 0,(function(){var o=this;return i(this,(function(s){switch(s.label){case 0:if(!Ea(e))throw e;return t.Or.add(1),[4,xc(t)];case 1:return s.sent(),t.Br.set("Offline"),n||(n=function(){return Uu(t.localStore)}),t.asyncQueue.enqueueRetryable((function(){return r(o,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return kr("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.Or.delete(1),[4,Cc(t)];case 2:return e.sent(),[2]}}))}))})),[2]}}))}))}function Gc(t,e){return e().catch((function(n){return Kc(t,n,e)}))}function zc(t){return r(this,void 0,void 0,(function(){var e,n,r,o,s;return i(this,(function(i){switch(i.label){case 0:e=Lr(t),n=th(e),r=e.kr.length>0?e.kr[e.kr.length-1].batchId:-1,i.label=1;case 1:if(!(Vc(a=e)&&a.kr.length<10))return[3,7];i.label=2;case 2:return i.trys.push([2,4,,6]),[4,Bu(e.localStore,r)];case 3:return null===(o=i.sent())?(0===e.kr.length&&n.ir(),[3,7]):(r=o.batchId,function(t,e){t.kr.push(e);var n=th(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,o),[3,6]);case 4:return s=i.sent(),[4,Kc(e,s)];case 5:return i.sent(),[3,6];case 6:return[3,1];case 7:return Qc(e)&&Hc(e),[2]}var a}))}))}function Qc(t){return Vc(t)&&!th(t).tr()&&t.kr.length>0}function Hc(t){th(t).start()}function Wc(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){return th(t).Ar(),[2]}))}))}function Yc(t){return r(this,void 0,void 0,(function(){var e,n,r,o;return i(this,(function(i){for(e=th(t),n=0,r=t.kr;n<r.length;n++)o=r[n],e.Er(o.mutations);return[2]}))}))}function Xc(t,e,n){return r(this,void 0,void 0,(function(){var r,o;return i(this,(function(i){switch(i.label){case 0:return r=t.kr.shift(),o=xa.from(r,e,n),[4,Gc(t,(function(){return t.remoteSyncer.applySuccessfulWrite(o)}))];case 1:return i.sent(),[4,zc(t)];case 2:return i.sent(),[2]}}))}))}function $c(t,e){return r(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return e&&th(t).pr?[4,function(t,e){return r(this,void 0,void 0,(function(){var n,r;return i(this,(function(i){switch(i.label){case 0:return zo(r=e.code)&&r!==Sr.ABORTED?(n=t.kr.shift(),th(t).sr(),[4,Gc(t,(function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)}))]):[3,3];case 1:return i.sent(),[4,zc(t)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return Qc(t)&&Hc(t),[2]}}))}))}function Jc(t,e){return r(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return n=Lr(t),e?(n.Or.delete(2),[4,Cc(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Or.add(2),[4,xc(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}}))}))}function Zc(t){var e,n,o,s,a=this;return t.Ur||(t.Ur=(e=t.datastore,n=t.asyncQueue,o={Ii:qc.bind(null,t),Ri:Bc.bind(null,t),_r:jc.bind(null,t)},(s=Lr(e)).br(),new Sc(n,s.Hi,s.credentials,s.R,o)),t.Mr.push((function(e){return r(a,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return e?(t.Ur.sr(),Fc(t)?Mc(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:n.sent(),Uc(t),n.label=3;case 3:return[2]}}))}))}))),t.Ur}function th(t){var e,n,o,s,a=this;return t.Qr||(t.Qr=(e=t.datastore,n=t.asyncQueue,o={Ii:Wc.bind(null,t),Ri:$c.bind(null,t),Ir:Yc.bind(null,t),Tr:Xc.bind(null,t)},(s=Lr(e)).br(),new Dc(n,s.Hi,s.credentials,s.R,o)),t.Mr.push((function(e){return r(a,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return e?(t.Qr.sr(),[4,zc(t)]):[3,2];case 1:return n.sent(),[3,4];case 2:return[4,t.Qr.stop()];case 3:n.sent(),t.kr.length>0&&(kr("RemoteStore","Stopping write stream with "+t.kr.length+" pending writes"),t.kr=[]),n.label=4;case 4:return[2]}}))}))}))),t.Qr}var eh=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new ga,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((function(t){}))}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout((function(){return e.handleDelayElapsed()}),t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Dr(Sr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget((function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then((function(e){return t.deferred.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function nh(t,e){if(Cr("AsyncQueue",e+": "+t),Ea(t))return new Dr(Sr.UNAVAILABLE,e+": "+t);throw t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var rh=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||ui.comparator(e.key,n.key)}:function(t,e){return ui.comparator(t.key,e.key)},this.keyedMap=es(),this.sortedSet=new Ho(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),ih=function(){function t(){this.Kr=new Ho(ui.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Kr.get(e);n?0!==t.type&&3===n.type?this.Kr=this.Kr.insert(e,t):3===t.type&&1!==n.type?this.Kr=this.Kr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Kr=this.Kr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Kr=this.Kr.remove(e):1===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):Or():this.Kr=this.Kr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Kr.inorderTraversal((function(e,n){t.push(n)})),t},t}(),oh=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:0,doc:t})})),new t(e,n,rh.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&ro(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),sh=function(){this.Wr=void 0,this.listeners=[]},ah=function(){this.queries=new mu((function(t){return io(t)}),ro),this.onlineState="Unknown",this.Gr=new Set};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uh(t,e){return r(this,void 0,void 0,(function(){var n,r,o,s,a,u,c;return i(this,(function(i){switch(i.label){case 0:if(n=Lr(t),r=e.query,o=!1,(s=n.queries.get(r))||(o=!0,s=new sh),!o)return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),a=s,[4,n.onListen(r)];case 2:return a.Wr=i.sent(),[3,4];case 3:return u=i.sent(),c=nh(u,"Initialization of query '"+oo(e.query)+"' failed"),[2,void e.onError(c)];case 4:return n.queries.set(r,s),s.listeners.push(e),e.zr(n.onlineState),s.Wr&&e.Hr(s.Wr)&&fh(n),[2]}}))}))}function ch(t,e){return r(this,void 0,void 0,(function(){var n,r,o,s,a;return i(this,(function(i){return n=Lr(t),r=e.query,o=!1,(s=n.queries.get(r))&&(a=s.listeners.indexOf(e))>=0&&(s.listeners.splice(a,1),o=0===s.listeners.length),o?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]}))}))}function hh(t,e){for(var n=Lr(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=s.query,u=n.queries.get(a);if(u){for(var c=0,h=u.listeners;c<h.length;c++)h[c].Hr(s)&&(r=!0);u.Wr=s}}r&&fh(n)}function lh(t,e,n){var r=Lr(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function fh(t){t.Gr.forEach((function(t){t.next()}))}var dh=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new oh(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.so&&n||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){if(t.docChanges.length>0)return!0;var e=this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=oh.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),ph=function(t){this.key=t},yh=function(t){this.key=t},vh=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=is(),this.mutatedKeys=is(),this.lo=ao(t),this.fo=new rh(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new ih,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=Yi(this.query)&&i.size===this.query.limit?i.last():null,c=Xi(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((function(t,e){var h=i.get(t),l=so(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),d=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),p=!1;h&&l?h.data.isEqual(l.data)?f!==d&&(r.track({type:3,doc:l}),p=!0):n.yo(h,l)||(r.track({type:2,doc:l}),p=!0,(u&&n.lo(l,u)>0||c&&n.lo(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),p=!0):h&&!l&&(r.track({type:1,doc:h}),p=!0,(u||c)&&(a=!0)),p&&(l?(s=s.add(l),o=d?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))})),Yi(this.query)||Xi(this.query))for(;s.size>this.query.limit;){var h=Yi(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort((function(t,e){return n=t.type,i=e.type,(o=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Or()}})(n)-o(i)||r.lo(t.doc,e.doc);var n,i,o})),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,u=a!==this.ao;return this.ao=a,0!==o.length||u?{snapshot:new oh(this.query,t.fo,i,o,t.mutatedKeys,0===a,u,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new ih,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach((function(t){return e.uo=e.uo.add(t)})),t.modifiedDocuments.forEach((function(t){})),t.removedDocuments.forEach((function(t){return e.uo=e.uo.delete(t)})),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=is(),this.fo.forEach((function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))}));var n=[];return e.forEach((function(e){t.ho.has(e)||n.push(new yh(e))})),this.ho.forEach((function(t){e.has(t)||n.push(new ph(t))})),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=is();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return oh.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),gh=function(t,e,n){this.query=t,this.targetId=e,this.view=n},mh=function(t){this.key=t,this.bo=!1},bh=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new mu((function(t){return io(t)}),ro),this.Vo=new Map,this.So=new Set,this.Do=new Ho(ui.comparator),this.Co=new Map,this.No=new Yu,this.xo={},this.Fo=new Map,this.ko=su.Yt(),this.onlineState="Unknown",this.$o=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wh(t,e){return r(this,void 0,void 0,(function(){var n,r,o,s,a,u;return i(this,(function(i){switch(i.label){case 0:return n=Yh(t),(s=n.Po.get(e))?(r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),o=s.view.Ro(),[3,4]):[3,1];case 1:return[4,ju(n.localStore,eo(e))];case 2:return a=i.sent(),u=n.sharedClientState.addLocalQueryTarget(a.targetId),r=a.targetId,[4,Ih(n,e,r,"current"===u)];case 3:o=i.sent(),n.isPrimaryClient&&Rc(n.remoteStore,a),i.label=4;case 4:return[2,o]}}))}))}function Ih(t,e,n,o){return r(this,void 0,void 0,(function(){var s,a,u,c,h,l;return i(this,(function(f){switch(f.label){case 0:return t.Oo=function(e,n,o){return function(t,e,n,o){return r(this,void 0,void 0,(function(){var r,s,a;return i(this,(function(i){switch(i.label){case 0:return(r=e.view._o(n)).Nn?[4,Gu(t.localStore,e.query,!1).then((function(t){var n=t.documents;return e.view._o(n,r)}))]:[3,2];case 1:r=i.sent(),i.label=2;case 2:return s=o&&o.targetChanges.get(e.targetId),a=e.view.applyChanges(r,t.isPrimaryClient,s),[2,(Ph(t,e.targetId,a.To),a.snapshot)]}}))}))}(t,e,n,o)},[4,Gu(t.localStore,e,!0)];case 1:return s=f.sent(),a=new vh(e,s.Bn),u=a._o(s.documents),c=us.createSynthesizedTargetChangeForCurrentChange(n,o&&"Offline"!==t.onlineState),h=a.applyChanges(u,t.isPrimaryClient,c),Ph(t,n,h.To),l=new gh(e,n,a),[2,(t.Po.set(e,l),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),h.snapshot)]}}))}))}function Th(t,e){return r(this,void 0,void 0,(function(){var n,r,o;return i(this,(function(i){switch(i.label){case 0:return n=Lr(t),r=n.Po.get(e),(o=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,o.filter((function(t){return!ro(t,e)}))),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,Ku(n.localStore,r.targetId,!1).then((function(){n.sharedClientState.clearQueryState(r.targetId),Oc(n.remoteStore,r.targetId),Rh(n,r.targetId)})).catch(lu)]):[3,3];case 1:i.sent(),i.label=2;case 2:return[3,5];case 3:return Rh(n,r.targetId),[4,Ku(n.localStore,r.targetId,!0)];case 4:i.sent(),i.label=5;case 5:return[2]}}))}))}function Eh(t,e,n){return r(this,void 0,void 0,(function(){var r,o,s,a;return i(this,(function(i){switch(i.label){case 0:r=Xh(t),i.label=1;case 1:return i.trys.push([1,5,,6]),[4,(u=r.localStore,c=e,l=Lr(u),f=Br.now(),d=c.reduce((function(t,e){return t.add(e.key)}),is()),l.persistence.runTransaction("Locally write mutations","readwrite",(function(t){return l.Mn.pn(t,d).next((function(e){h=e;for(var n=[],r=0,i=c;r<i.length;r++){var o=i[r],s=Ro(o,h.get(o.key));null!=s&&n.push(new Mo(o.key,s,_i(s.value.mapValue),No.exists(!0)))}return l._n.addMutationBatch(t,f,n,c)}))})).then((function(t){return t.applyToLocalDocumentSet(h),{batchId:t.batchId,changes:h}})))];case 2:return o=i.sent(),r.sharedClientState.addPendingMutation(o.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new Ho(Vr)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,o.batchId,n),[4,Fh(r,o.changes)];case 3:return i.sent(),[4,zc(r.remoteStore)];case 4:return i.sent(),[3,6];case 5:return s=i.sent(),a=nh(s,"Failed to persist write"),n.reject(a),[3,6];case 6:return[2]}var u,c,h,l,f,d}))}))}function _h(t,e){return r(this,void 0,void 0,(function(){var n,r;return i(this,(function(i){switch(i.label){case 0:n=Lr(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,qu(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach((function(t,e){var r=n.Co.get(e);r&&(Pr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?Pr(r.bo):t.removedDocuments.size>0&&(Pr(r.bo),r.bo=!1))})),[4,Fh(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,lu(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}}))}))}function Sh(t,e,n){var r=Lr(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach((function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)})),function(t,e){var n=Lr(t);n.onlineState=e;var r=!1;n.queries.forEach((function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)})),r&&fh(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Dh(t,e,n){return r(this,void 0,void 0,(function(){var r,o,s,a,u,c;return i(this,(function(i){switch(i.label){case 0:return(r=Lr(t)).sharedClientState.updateQueryState(e,"rejected",n),o=r.Co.get(e),(s=o&&o.key)?(a=(a=new Ho(ui.comparator)).insert(s,Si.newNoDocument(s,jr.min())),u=is().add(s),c=new as(jr.min(),new Map,new Xo(Vr),a,u),[4,_h(r,c)]):[3,2];case 1:return i.sent(),r.Do=r.Do.remove(s),r.Co.delete(e),Mh(r),[3,4];case 2:return[4,Ku(r.localStore,e,!1).then((function(){return Rh(r,e,n)})).catch(lu)];case 3:i.sent(),i.label=4;case 4:return[2]}}))}))}function Nh(t,e){return r(this,void 0,void 0,(function(){var n,r,o;return i(this,(function(i){switch(i.label){case 0:n=Lr(t),r=e.batch.batchId,i.label=1;case 1:return i.trys.push([1,4,,6]),[4,Vu(n.localStore,e)];case 2:return o=i.sent(),xh(n,r,null),Ch(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,Fh(n,o)];case 3:return i.sent(),[3,6];case 4:return[4,lu(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}}))}))}function Ah(t,e,n){return r(this,void 0,void 0,(function(){var r,o;return i(this,(function(i){switch(i.label){case 0:r=Lr(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,(s=r.localStore,a=e,u=Lr(s),u.persistence.runTransaction("Reject batch","readwrite-primary",(function(t){var e;return u._n.lookupMutationBatch(t,a).next((function(n){return Pr(null!==n),e=n.keys(),u._n.removeMutationBatch(t,n)})).next((function(){return u._n.performConsistencyCheck(t)})).next((function(){return u.Mn.pn(t,e)}))})))];case 2:return o=i.sent(),xh(r,e,n),Ch(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,Fh(r,o)];case 3:return i.sent(),[3,6];case 4:return[4,lu(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}var s,a,u}))}))}function kh(t,e){return r(this,void 0,void 0,(function(){var n,r,o,s,a;return i(this,(function(i){switch(i.label){case 0:Vc((n=Lr(t)).remoteStore)||kr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,(u=n.localStore,c=Lr(u),c.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(t){return c._n.getHighestUnacknowledgedBatchId(t)})))];case 2:return-1===(r=i.sent())?[2,void e.resolve()]:((o=n.Fo.get(r)||[]).push(e),n.Fo.set(r,o),[3,4]);case 3:return s=i.sent(),a=nh(s,"Initialization of waitForPendingWrites() operation failed"),e.reject(a),[3,4];case 4:return[2]}var u,c}))}))}function Ch(t,e){(t.Fo.get(e)||[]).forEach((function(t){t.resolve()})),t.Fo.delete(e)}function xh(t,e,n){var r=Lr(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function Rh(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach((function(e){t.No.containsKey(e)||Oh(t,e)}))}function Oh(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(Oc(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),Mh(t))}function Ph(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof ph?(t.No.addReference(o.key,e),Lh(t,o)):o instanceof yh?(kr("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||Oh(t,o.key)):Or()}}function Lh(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(kr("SyncEngine","New document in limbo: "+n),t.So.add(r),Mh(t))}function Mh(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new ui(Hr.fromString(e)),r=t.ko.next();t.Co.set(r,new mh(n)),t.Do=t.Do.insert(n,r),Rc(t.remoteStore,new Ra(eo(Wi(n.path)),r,2,_r.o))}}function Fh(t,e,n){return r(this,void 0,void 0,(function(){var o,s,a,u;return i(this,(function(c){switch(c.label){case 0:return o=Lr(t),s=[],a=[],u=[],o.Po.isEmpty()?[3,3]:(o.Po.forEach((function(t,r){u.push(o.Oo(r,e,n).then((function(t){if(t){o.isPrimaryClient&&o.sharedClientState.updateQueryState(r.targetId,t.fromCache?"not-current":"current"),s.push(t);var e=Ou.Pn(r.targetId,t);a.push(e)}})))})),[4,Promise.all(u)]);case 1:return c.sent(),o.vo._r(s),[4,function(t,e){return r(this,void 0,void 0,(function(){var n,r,o,s,a,u,c,h,l;return i(this,(function(i){switch(i.label){case 0:n=Lr(t),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(t){return ma.forEach(e,(function(e){return ma.forEach(e.bn,(function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)})).next((function(){return ma.forEach(e.vn,(function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)}))}))}))}))];case 2:return i.sent(),[3,4];case 3:if(!Ea(r=i.sent()))throw r;return kr("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(o=0,s=e;o<s.length;o++)a=s[o],u=a.targetId,a.fromCache||(c=n.Fn.get(u),h=c.snapshotVersion,l=c.withLastLimboFreeSnapshotVersion(h),n.Fn=n.Fn.insert(u,l));return[2]}}))}))}(o.localStore,a)];case 2:c.sent(),c.label=3;case 3:return[2]}}))}))}function Vh(t,e){return r(this,void 0,void 0,(function(){var n,r;return i(this,(function(i){switch(i.label){case 0:return(n=Lr(t)).currentUser.isEqual(e)?[3,3]:(kr("SyncEngine","User change. New user:",e.toKey()),[4,Fu(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,(o=n).Fo.forEach((function(t){t.forEach((function(t){t.reject(new Dr(Sr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),o.Fo.clear(),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,Fh(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}var o}))}))}function Uh(t,e){var n=Lr(t),r=n.Co.get(e);if(r&&r.bo)return is().add(r.key);var i=is(),o=n.Vo.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=a[s],c=n.Po.get(u);i=i.unionWith(c.view.wo)}return i}function qh(t,e){return r(this,void 0,void 0,(function(){var n,r,o;return i(this,(function(i){switch(i.label){case 0:return[4,Gu((n=Lr(t)).localStore,e.query,!0)];case 1:return r=i.sent(),o=e.view.Ao(r),[2,(n.isPrimaryClient&&Ph(n,e.targetId,o.To),o)]}}))}))}function Bh(t){return r(this,void 0,void 0,(function(){var e;return i(this,(function(n){return[2,Qu((e=Lr(t)).localStore).then((function(t){return Fh(e,t)}))]}))}))}function jh(t,e,n,o){return r(this,void 0,void 0,(function(){var r,s;return i(this,(function(i){switch(i.label){case 0:return[4,(a=(r=Lr(t)).localStore,u=e,c=Lr(a),h=Lr(c._n),c.persistence.runTransaction("Lookup mutation documents","readonly",(function(t){return h.jt(t,u).next((function(e){return e?c.Mn.pn(t,e):ma.resolve(null)}))})))];case 1:return null===(s=i.sent())?[3,6]:"pending"!==n?[3,3]:[4,zc(r.remoteStore)];case 2:return i.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(xh(r,e,o||null),Ch(r,e),function(t,e){Lr(Lr(t)._n).Gt(e)}(r.localStore,e)):Or(),i.label=4;case 4:return[4,Fh(r,s)];case 5:return i.sent(),[3,7];case 6:kr("SyncEngine","Cannot apply mutation batch with id: "+e),i.label=7;case 7:return[2]}var a,u,c,h}))}))}function Kh(t,e){return r(this,void 0,void 0,(function(){var n,r,o,s,a,u,c,h;return i(this,(function(i){switch(i.label){case 0:return Yh(n=Lr(t)),Xh(n),!0!==e||!0===n.$o?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,Gh(n,r.toArray())]);case 1:return o=i.sent(),n.$o=!0,[4,Jc(n.remoteStore,!0)];case 2:for(i.sent(),s=0,a=o;s<a.length;s++)u=a[s],Rc(n.remoteStore,u);return[3,7];case 3:return!1!==e||!1===n.$o?[3,7]:(c=[],h=Promise.resolve(),n.Vo.forEach((function(t,e){n.sharedClientState.isLocalQueryTarget(e)?c.push(e):h=h.then((function(){return Rh(n,e),Ku(n.localStore,e,!0)})),Oc(n.remoteStore,e)})),[4,h]);case 4:return i.sent(),[4,Gh(n,c)];case 5:return i.sent(),(l=Lr(n)).Co.forEach((function(t,e){Oc(l.remoteStore,e)})),l.No.ts(),l.Co=new Map,l.Do=new Ho(ui.comparator),n.$o=!1,[4,Jc(n.remoteStore,!1)];case 6:i.sent(),i.label=7;case 7:return[2]}var l}))}))}function Gh(t,e,n){return r(this,void 0,void 0,(function(){var n,r,o,s,a,u,c,h,l,f,d,p,y,v;return i(this,(function(i){switch(i.label){case 0:n=Lr(t),r=[],o=[],s=0,a=e,i.label=1;case 1:return s<a.length?(u=a[s],c=void 0,(h=n.Vo.get(u))&&0!==h.length?[4,ju(n.localStore,eo(h[0]))]:[3,7]):[3,13];case 2:c=i.sent(),l=0,f=h,i.label=3;case 3:return l<f.length?(d=f[l],p=n.Po.get(d),[4,qh(n,p)]):[3,6];case 4:(y=i.sent()).snapshot&&o.push(y.snapshot),i.label=5;case 5:return l++,[3,3];case 6:return[3,11];case 7:return[4,zu(n.localStore,u)];case 8:return v=i.sent(),[4,ju(n.localStore,v)];case 9:return c=i.sent(),[4,Ih(n,zh(v),u,!1)];case 10:i.sent(),i.label=11;case 11:r.push(c),i.label=12;case 12:return s++,[3,1];case 13:return[2,(n.vo._r(o),r)]}}))}))}function zh(t){return Hi(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Qh(t){var e=Lr(t);return Lr(Lr(e.localStore).persistence).fn()}function Hh(t,e,n,o){return r(this,void 0,void 0,(function(){var r,s,a;return i(this,(function(i){switch(i.label){case 0:return(r=Lr(t)).$o?(kr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!r.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,Qu(r.localStore)];case 3:return s=i.sent(),a=as.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,Fh(r,s,a)];case 4:return i.sent(),[3,8];case 5:return[4,Ku(r.localStore,e,!0)];case 6:return i.sent(),Rh(r,e,o),[3,8];case 7:Or(),i.label=8;case 8:return[2]}}))}))}function Wh(t,e,n){return r(this,void 0,void 0,(function(){var r,o,s,a,u,c,h,l,f,d;return i(this,(function(p){switch(p.label){case 0:if(!(r=Yh(t)).$o)return[3,10];o=0,s=e,p.label=1;case 1:return o<s.length?(a=s[o],r.Vo.has(a)?(kr("SyncEngine","Adding an already active target "+a),[3,5]):[4,zu(r.localStore,a)]):[3,6];case 2:return u=p.sent(),[4,ju(r.localStore,u)];case 3:return c=p.sent(),[4,Ih(r,zh(u),c.targetId,!1)];case 4:p.sent(),Rc(r.remoteStore,c),p.label=5;case 5:return o++,[3,1];case 6:h=function(t){return i(this,(function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,Ku(r.localStore,t,!1).then((function(){Oc(r.remoteStore,t),Rh(r,t)})).catch(lu)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},l=0,f=n,p.label=7;case 7:return l<f.length?(d=f[l],[5,h(d)]):[3,10];case 8:p.sent(),p.label=9;case 9:return l++,[3,7];case 10:return[2]}}))}))}function Yh(t){var e=Lr(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=_h.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Uh.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Dh.bind(null,e),e.vo._r=hh.bind(null,e.eventManager),e.vo.Mo=lh.bind(null,e.eventManager),e}function Xh(t){var e=Lr(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Nh.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Ah.bind(null,e),e}var $h=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return this.R=Tc(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Qo(t),[2]}}))}))},t.prototype.Uo=function(t){return null},t.prototype.Qo=function(t){return Mu(this.persistence,new Pu,t.initialUser,this.R)},t.prototype.qo=function(t){return new ec(rc.bs,this.R)},t.prototype.Bo=function(t){return new pc},t.prototype.terminate=function(){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}}))}))},t}(),Jh=function(e){function n(t,n,r){var i=this;return(i=e.call(this)||this).Ko=t,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return t(n,e),n.prototype.initialize=function(t){return r(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,e.prototype.initialize.call(this,t)];case 1:return n.sent(),[4,Hu(this.localStore)];case 2:return n.sent(),[4,this.Ko.initialize(this,t)];case 3:return n.sent(),[4,Xh(this.Ko.syncEngine)];case 4:return n.sent(),[4,zc(this.Ko.remoteStore)];case 5:return n.sent(),[2]}}))}))},n.prototype.Qo=function(t){return Mu(this.persistence,new Pu,t.initialUser,this.R)},n.prototype.Uo=function(t){var e=this.persistence.referenceDelegate.garbageCollector;return new pu(e,t.asyncQueue)},n.prototype.qo=function(t){var e=xu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Ja.withCacheSize(this.cacheSizeBytes):Ja.DEFAULT;return new Au(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,wc(),Ic(),this.R,this.sharedClientState,!!this.forceOwnership)},n.prototype.Bo=function(t){return new pc},n}($h),Zh=function(e){function n(t,n){var r=this;return(r=e.call(this,t,n,!1)||this).Ko=t,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return t(n,e),n.prototype.initialize=function(t){return r(this,void 0,void 0,(function(){var n,o=this;return i(this,(function(s){switch(s.label){case 0:return[4,e.prototype.initialize.call(this,t)];case 1:return s.sent(),n=this.Ko.syncEngine,this.sharedClientState instanceof dc?(this.sharedClientState.syncEngine={ui:jh.bind(null,n),ai:Hh.bind(null,n),hi:Wh.bind(null,n),fn:Qh.bind(null,n),ci:Bh.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:s.sent(),s.label=3;case 3:return[4,this.persistence.He((function(t){return r(o,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,Kh(this.Ko.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}}))}))}))];case 4:return s.sent(),[2]}}))}))},n.prototype.Bo=function(t){var e=wc();if(!dc.yt(e))throw new Dr(Sr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=xu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new dc(e,t.asyncQueue,n,t.clientId,t.initialUser)},n}(Jh),tl=function(){function t(){}return t.prototype.initialize=function(t,e){return r(this,void 0,void 0,(function(){var n=this;return i(this,(function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return Sh(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Vh.bind(null,this.syncEngine),[4,Jc(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.createEventManager=function(t){return new ah},t.prototype.createDatastore=function(t){var e,n,r=Tc(t.databaseInfo.databaseId),i=(e=t.databaseInfo,new bc(e));return n=t.credentials,new Nc(n,i,r)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return Sh(s.syncEngine,t,0)},o=vc.yt()?new vc:new yc,new kc(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return n=this.localStore,r=this.remoteStore,i=this.eventManager,o=this.sharedClientState,s=t.initialUser,a=t.maxConcurrentLimboResolutions,u=e,c=new bh(n,r,i,o,s,a),u&&(c.$o=!0),c;var n,r,i,o,s,a,u,c},t.prototype.terminate=function(){return function(t){return r(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return e=Lr(t),kr("RemoteStore","RemoteStore shutting down."),e.Or.add(5),[4,xc(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}}))}))}(this.remoteStore)},t}(),el=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}(),nl=function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return r(this,void 0,void 0,(function(){var e,n=this;return i(this,(function(o){switch(o.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new Dr(Sr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return r(this,void 0,void 0,(function(){var n,r,o,s,a,u;return i(this,(function(i){switch(i.label){case 0:return n=Lr(t),r=ks(n.R)+"/documents",o={documents:e.map((function(t){return Ss(n.R,t)}))},[4,n.$i("BatchGetDocuments",r,o)];case 1:return s=i.sent(),a=new Map,s.forEach((function(t){var e,r,i=(e=n.R,"found"in(r=t)?function(t,e){Pr(!!e.found),e.found.name,e.found.updateTime;var n=Ds(t,e.found.name),r=Ts(e.found.updateTime),i=new Ei({mapValue:{fields:e.found.fields}});return Si.newFoundDocument(n,r,i)}(e,r):"missing"in r?function(t,e){Pr(!!e.missing),Pr(!!e.readTime);var n=Ds(t,e.missing),r=Ts(e.readTime);return Si.newNoDocument(n,r)}(e,r):Or());a.set(i.key.toString(),i)})),u=[],[2,(e.forEach((function(t){var e=a.get(t.toString());Pr(!!e),u.push(e)})),u)]}}))}))}(this.datastore,t)];case 1:return[2,((e=o.sent()).forEach((function(t){return n.recordVersion(t)})),e)]}}))}))},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(n){this.lastWriteError=n}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new jo(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return r(this,void 0,void 0,(function(){var t,e=this;return i(this,(function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,n){var r=ui.fromPath(n);e.mutations.push(new Ko(r,e.precondition(r)))})),[4,function(t,e){return r(this,void 0,void 0,(function(){var n,r,o;return i(this,(function(i){switch(i.label){case 0:return n=Lr(t),r=ks(n.R)+"/documents",o={writes:e.map((function(t){return Rs(n.R,t)}))},[4,n.Ni("Commit",r,o)];case 1:return i.sent(),[2]}}))}))}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}}))}))},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw Or();e=jr.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Dr(Sr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?No.updateTime(e):No.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(jr.min()))throw new Dr(Sr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return No.updateTime(e)}return No.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}(),rl=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new Ec(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji((function(){return r(t,void 0,void 0,(function(){var t,e,n=this;return i(this,(function(r){return t=new nl(this.datastore),(e=this.sc(t))&&e.then((function(e){n.asyncQueue.enqueueAndForget((function(){return t.commit().then((function(){n.deferred.resolve(e)})).catch((function(t){n.ic(t)}))}))})).catch((function(t){n.ic(t)})),[2]}))}))}))},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!oi(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(n){return this.deferred.reject(n),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget((function(){return e.nc(),Promise.resolve()}))):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!zo(e)}return!1},t}(),il=function(){function t(t,e,n){var o=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=ic.UNAUTHENTICATED,this.clientId=Fr.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(e,(function(t){return r(o,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return kr("FirestoreClient","Received user=",t.uid),[4,this.credentialListener(t)];case 1:return e.sent(),this.user=t,[2]}}))}))}))}return t.prototype.getConfiguration=function(){return r(this,void 0,void 0,(function(){return i(this,(function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]}))}))},t.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Dr(Sr.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new ga;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((function(){return r(t,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=nh(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}}))}))})),e.promise},t}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function ol(t,e){return r(this,void 0,void 0,(function(){var n,o,s=this;return i(this,(function(a){switch(a.label){case 0:return t.asyncQueue.verifyOperationInProgress(),kr("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=a.sent(),[4,e.initialize(n)];case 2:return a.sent(),o=n.initialUser,t.setCredentialChangeListener((function(t){return r(s,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return o.isEqual(t)?[3,2]:[4,Fu(e.localStore,t)];case 1:n.sent(),o=t,n.label=2;case 2:return[2]}}))}))})),e.persistence.setDatabaseDeletedListener((function(){return t.terminate()})),t.offlineComponents=e,[2]}}))}))}function sl(t,e){return r(this,void 0,void 0,(function(){var n,o;return i(this,(function(s){switch(s.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,al(t)];case 1:return n=s.sent(),kr("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return o=s.sent(),[4,e.initialize(n,o)];case 3:return s.sent(),t.setCredentialChangeListener((function(t){return function(t,e){return r(this,void 0,void 0,(function(){var n,r;return i(this,(function(i){switch(i.label){case 0:return(n=Lr(t)).asyncQueue.verifyOperationInProgress(),kr("RemoteStore","RemoteStore received new credentials"),r=Vc(n),n.Or.add(3),[4,xc(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.Or.delete(3),[4,Cc(n)];case 3:return i.sent(),[2]}}))}))}(e.remoteStore,t)})),t.onlineComponents=e,[2]}}))}))}function al(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(kr("FirestoreClient","Using default OfflineComponentProvider"),[4,ol(t,new $h)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}}))}))}function ul(t){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(kr("FirestoreClient","Using default OnlineComponentProvider"),[4,sl(t,new tl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}}))}))}function cl(t){return al(t).then((function(t){return t.persistence}))}function hl(t){return al(t).then((function(t){return t.localStore}))}function ll(t){return ul(t).then((function(t){return t.remoteStore}))}function fl(t){return ul(t).then((function(t){return t.syncEngine}))}function dl(t){return r(this,void 0,void 0,(function(){var e,n;return i(this,(function(r){switch(r.label){case 0:return[4,ul(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=wh.bind(null,e.syncEngine),n.onUnlisten=Th.bind(null,e.syncEngine),n)]}}))}))}function pl(t,e,n){var o=this;void 0===n&&(n={});var s=new ga;return t.asyncQueue.enqueueAndForget((function(){return r(o,void 0,void 0,(function(){var r;return i(this,(function(i){switch(i.label){case 0:return r=function(t,e,n,r,i){var o=new el({next:function(o){e.enqueueAndForget((function(){return ch(t,s)}));var a=o.docs.has(n);!a&&o.fromCache?i.reject(new Dr(Sr.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new Dr(Sr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new dh(Wi(n.path),o,{includeMetadataChanges:!0,so:!0});return uh(t,s)},[4,dl(t)];case 1:return[2,r.apply(void 0,[i.sent(),t.asyncQueue,e,n,s])]}}))}))})),s.promise}function yl(t,e,n){var o=this;void 0===n&&(n={});var s=new ga;return t.asyncQueue.enqueueAndForget((function(){return r(o,void 0,void 0,(function(){var r;return i(this,(function(i){switch(i.label){case 0:return r=function(t,e,n,r,i){var o=new el({next:function(n){e.enqueueAndForget((function(){return ch(t,s)})),n.fromCache&&"server"===r.source?i.reject(new Dr(Sr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new dh(n,o,{includeMetadataChanges:!0,so:!0});return uh(t,s)},[4,dl(t)];case 1:return[2,r.apply(void 0,[i.sent(),t.asyncQueue,e,n,s])]}}))}))})),s.promise}var vl=function(t,e,n,r,i,o,s){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s},gl=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),ml=new Map,bl=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},wl=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){this.changeListener=e,t.enqueueRetryable((function(){return e(ic.UNAUTHENTICATED)}))},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Il=function(){function t(t){this.token=t,this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(this.token)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){var n=this;this.changeListener=e,t.enqueueRetryable((function(){return e(n.token.user)}))},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Tl=function(){function t(t){var e=this;this.currentUser=ic.UNAUTHENTICATED,this.oc=new ga,this.cc=0,this.changeListener=function(){return Promise.resolve()},this.uc=!1,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.ac=function(){e.cc++,e.currentUser=e.hc(),e.oc.resolve(),e.uc&&e.asyncQueue.enqueueRetryable((function(){return e.changeListener(e.currentUser)}))};var n=function(t){kr("FirebaseCredentialsProvider","Auth detected"),e.auth=t,e.lc(),e.auth.addAuthTokenListener(e.ac)};t.onInit((function(t){return n(t)})),setTimeout((function(){if(!e.auth){var r=t.getImmediate({optional:!0});r?n(r):e.uc&&(kr("FirebaseCredentialsProvider","Auth not yet detected"),e.asyncQueue.enqueueRetryable((function(){return e.changeListener(e.currentUser)})))}}),0)}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.cc!==e?(kr("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(Pr("string"==typeof n.accessToken),new bl(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t,e){this.uc=!0,this.asyncQueue=t,this.changeListener=e},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.ac),this.changeListener=function(){return Promise.resolve()}},t.prototype.hc=function(){var t=this.auth&&this.auth.getUid();return Pr(null===t||"string"==typeof t),new ic(t)},t.prototype.lc=function(){var t=this;this.uc&&(this.uc=!1,this.asyncQueue.enqueueRetryable((function(){return r(t,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.oc.promise];case 1:return t.sent(),[4,this.changeListener(this.currentUser)];case 2:return t.sent(),this.uc=!0,[2]}}))}))})))},t}(),El=function(){function t(t,e,n){this.fc=t,this.dc=e,this.wc=n,this.type="FirstParty",this.user=ic.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.dc},e=this.fc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.wc&&(t["X-Goog-Iam-Authorization-Token"]=this.wc),t},enumerable:!1,configurable:!0}),t}(),_l=function(){function t(t,e,n){this.fc=t,this.dc=e,this.wc=n}return t.prototype.getToken=function(){return Promise.resolve(new El(this.fc,this.dc,this.wc))},t.prototype.setChangeListener=function(t,e){t.enqueueRetryable((function(){return e(ic.FIRST_PARTY)}))},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sl(t,e,n){if(!n)throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function Dl(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Nl(t,e,n,r){if(!0===e&&!0===r)throw new Dr(Sr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function Al(t){if(!ui.isDocumentKey(t))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function kl(t){if(ui.isDocumentKey(t))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function Cl(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":Or()}function xl(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Dr(Sr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=Cl(t);throw new Dr(Sr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function Rl(t,e){if(e<=0)throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ol=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Dr(Sr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Dr(Sr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,Nl("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},t}(),Pl=function(){function t(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ol({}),this._settingsFrozen=!1,t instanceof gl?(this._databaseId=t,this._credentials=new wl):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Dr(Sr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new gl(t.options.projectId)}(t),this._credentials=new Tl(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new Dr(Sr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new Dr(Sr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ol(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new wl;switch(t.type){case"gapi":var e=t.client;return Pr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new _l(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new Dr(Sr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return this,(t=ml.get(this))&&(kr("ComponentProvider","Removing Datastore"),ml.delete(this),t.terminate()),Promise.resolve();var t},t}(),Ll=function(){function t(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Fl(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),Ml=function(){function t(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),Fl=function(e){function n(t,n,r){var i=this;return(i=e.call(this,t,n,Wi(r))||this)._path=r,i.type="collection",i}return t(n,e),Object.defineProperty(n.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new Ll(this.firestore,null,new ui(t))},enumerable:!1,configurable:!0}),n.prototype.withConverter=function(t){return new n(this.firestore,t,this._path)},n}(Ml);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vl(t,n){for(var r,i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];if(t=l(t),Sl("collection","path",n),t instanceof Pl)return kl(r=Hr.fromString.apply(Hr,e([n],i))),new Fl(t,null,r);if(!(t instanceof Ll||t instanceof Fl))throw new Dr(Sr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return kl(r=Hr.fromString.apply(Hr,e([t.path],i)).child(Hr.fromString(n))),new Fl(t.firestore,null,r)}function Ul(t,n){for(var r,i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];if(t=l(t),1===arguments.length&&(n=Fr.u()),Sl("doc","path",n),t instanceof Pl)return Al(r=Hr.fromString.apply(Hr,e([n],i))),new Ll(t,null,new ui(r));if(!(t instanceof Ll||t instanceof Fl))throw new Dr(Sr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Al(r=t._path.child(Hr.fromString.apply(Hr,e([n],i)))),new Ll(t.firestore,t instanceof Fl?t.converter:null,new ui(r))}function ql(t,e){return t=l(t),e=l(e),(t instanceof Ll||t instanceof Fl)&&(e instanceof Ll||e instanceof Fl)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function Bl(t,e){return t=l(t),e=l(e),t instanceof Ml&&e instanceof Ml&&t.firestore===e.firestore&&ro(t._query,e._query)&&t.converter===e.converter}var jl=function(){function t(){var t=this;this._c=Promise.resolve(),this.mc=[],this.yc=!1,this.gc=[],this.Ec=null,this.Tc=!1,this.Ic=[],this.Zi=new Ec(this,"async_queue_retry"),this.Ac=function(){var e=Ic();e&&kr("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=Ic();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ac)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this.yc},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Rc(),this.bc(t)},t.prototype.enterRestrictedMode=function(){if(!this.yc){this.yc=!0;var t=Ic();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ac)}},t.prototype.enqueue=function(t){return this.Rc(),this.yc?new Promise((function(t){})):this.bc(t)},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget((function(){return e.mc.push(t),e.vc()}))},t.prototype.vc=function(){return r(this,void 0,void 0,(function(){var t,e=this;return i(this,(function(n){switch(n.label){case 0:if(0===this.mc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.mc[0]()];case 2:return n.sent(),this.mc.shift(),this.Zi.reset(),[3,4];case 3:if(!Ea(t=n.sent()))throw t;return kr("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.mc.length>0&&this.Zi.ji((function(){return e.vc()})),n.label=5;case 5:return[2]}}))}))},t.prototype.bc=function(t){var e=this,n=this._c.then((function(){return e.Tc=!0,t().catch((function(t){throw e.Ec=t,e.Tc=!1,Cr("INTERNAL UNHANDLED ERROR: ",(r=(n=t).message||"",n.stack&&(r=n.stack.includes(n.message)?n.stack:n.message+"\n"+n.stack),r)),t;var n,r})).then((function(t){return e.Tc=!1,t}))}));return this._c=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Rc(),this.Ic.indexOf(t)>-1&&(e=0);var i=eh.createAndSchedule(this,t,e,n,(function(t){return r.Pc(t)}));return this.gc.push(i),i},t.prototype.Rc=function(){this.Ec&&Or()},t.prototype.verifyOperationInProgress=function(){},t.prototype.Vc=function(){return r(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return[4,t=this._c];case 1:e.sent(),e.label=2;case 2:if(t!==this._c)return[3,0];e.label=3;case 3:return[2]}}))}))},t.prototype.Sc=function(t){for(var e=0,n=this.gc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Dc=function(t){var e=this;return this.Vc().then((function(){e.gc.sort((function(t,e){return t.targetTimeMs-e.targetTimeMs}));for(var n=0,r=e.gc;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.Vc()}))},t.prototype.Cc=function(t){this.Ic.push(t)},t.prototype.Pc=function(t){var e=this.gc.indexOf(t);this.gc.splice(e,1)},t}();function Kl(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}var Gl=function(e){function n(t,n){var r=this;return(r=e.call(this,t,n)||this).type="firestore",r._queue=new jl,r._persistenceKey="name"in t?t.name:"[DEFAULT]",r}return t(n,e),n.prototype._terminate=function(){return this._firestoreClient||Ql(this),this._firestoreClient.terminate()},n}(Pl);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zl(t){return t._firestoreClient||Ql(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Ql(t){var e,n,r,i,o,s=t._freezeSettings(),a=(n=t._databaseId,r=(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",i=t._persistenceKey,new vl(n,r,i,(o=s).host,o.ssl,o.experimentalForceLongPolling,o.experimentalAutoDetectLongPolling));t._firestoreClient=new il(t._credentials,t._queue,a)}function Hl(t,e,n){var o=this,s=new ga;return t.asyncQueue.enqueue((function(){return r(o,void 0,void 0,(function(){var r;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),[4,ol(t,n)];case 1:return i.sent(),[4,sl(t,e)];case 2:return i.sent(),s.resolve(),[3,4];case 3:if(!("FirebaseError"===(o=r=i.sent()).name?o.code===Sr.FAILED_PRECONDITION||o.code===Sr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&o instanceof DOMException)||22===o.code||20===o.code||11===o.code))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),s.reject(r),[3,4];case 4:return[2]}var o}))}))})).then((function(){return s.promise}))}function Wl(t){if(t._initialized||t._terminated)throw new Dr(Sr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Yl=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Yr(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),Xl=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t($r.fromBase64String(e))}catch(n){throw new Dr(Sr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}},t.fromUint8Array=function(e){return new t($r.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),$l=function(t){this._methodName=t},Jl=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new Dr(Sr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Dr(Sr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return Vr(this._lat,t._lat)||Vr(this._long,t._long)},t}(),Zl=/^__.*__$/,tf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new Mo(t,this.data,this.fieldMask,e,this.fieldTransforms):new Lo(t,this.data,e,this.fieldTransforms)},t}(),ef=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new Mo(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nf(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Or()}}var rf=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Nc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xc",{get:function(){return this.settings.xc},enumerable:!1,configurable:!0}),t.prototype.Fc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.kc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Fc({path:n,$c:!1});return r.Oc(t),r},t.prototype.Mc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Fc({path:n,$c:!1});return r.Nc(),r},t.prototype.Lc=function(t){return this.Fc({path:void 0,$c:!0})},t.prototype.Bc=function(t){return _f(t,this.settings.methodName,this.settings.qc||!1,this.path,this.settings.Uc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find((function(e){return t.isPrefixOf(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.isPrefixOf(e.field)}))},t.prototype.Nc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.Oc(this.path.get(t))},t.prototype.Oc=function(t){if(0===t.length)throw this.Bc("Document fields must not be empty");if(nf(this.xc)&&Zl.test(t))throw this.Bc('Document fields cannot begin and end with "__"')},t}(),of=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||Tc(t)}return t.prototype.Qc=function(t,e,n,r){return void 0===r&&(r=!1),new rf({xc:t,methodName:e,Uc:n,path:Yr.emptyPath(),$c:!1,qc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function sf(t){var e=t._freezeSettings(),n=Tc(t._databaseId);return new of(t._databaseId,!!e.ignoreUndefinedProperties,n)}function af(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Qc(o.merge||o.mergeFields?2:0,e,n,i);wf("Data must be an object, but it was:",s,r);var a,u,c=mf(r,s);if(o.merge)a=new Xr(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var d=If(e,f[l],n);if(!s.contains(d))throw new Dr(Sr.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");Sf(h,d)||h.push(d)}a=new Xr(h),u=s.fieldTransforms.filter((function(t){return a.covers(t.field)}))}else a=null,u=s.fieldTransforms;return new tf(new Ei(c),a,u)}var uf=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype._toFieldTransform=function(t){if(2!==t.xc)throw 1===t.xc?t.Bc(this._methodName+"() can only appear at the top level of your update data"):t.Bc(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},n.prototype.isEqual=function(t){return t instanceof n},n}($l);function cf(t,e,n){return new rf({xc:3,Uc:e.settings.Uc,methodName:t._methodName,$c:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var hf=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype._toFieldTransform=function(t){return new So(t.path,new go)},n.prototype.isEqual=function(t){return t instanceof n},n}($l),lf=function(e){function n(t,n){var r=this;return(r=e.call(this,t)||this).Kc=n,r}return t(n,e),n.prototype._toFieldTransform=function(t){var e=cf(this,t,!0),n=this.Kc.map((function(t){return gf(t,e)})),r=new mo(n);return new So(t.path,r)},n.prototype.isEqual=function(t){return this===t},n}($l),ff=function(e){function n(t,n){var r=this;return(r=e.call(this,t)||this).Kc=n,r}return t(n,e),n.prototype._toFieldTransform=function(t){var e=cf(this,t,!0),n=this.Kc.map((function(t){return gf(t,e)})),r=new wo(n);return new So(t.path,r)},n.prototype.isEqual=function(t){return this===t},n}($l),df=function(e){function n(t,n){var r=this;return(r=e.call(this,t)||this).jc=n,r}return t(n,e),n.prototype._toFieldTransform=function(t){var e=new To(t.R,lo(t.R,this.jc));return new So(t.path,e)},n.prototype.isEqual=function(t){return this===t},n}($l);function pf(t,e,n,r){var i=t.Qc(1,e,n);wf("Data must be an object, but it was:",i,r);var o=[],s=Ei.empty();Gr(r,(function(t,r){var a=Ef(e,t,n);r=l(r);var u=i.Mc(a);if(r instanceof uf)o.push(a);else{var c=gf(r,u);null!=c&&(o.push(a),s.set(a,c))}}));var a=new Xr(o);return new ef(s,a,i.fieldTransforms)}function yf(t,e,n,r,i,o){var s=t.Qc(1,e,n),a=[If(e,r,n)],u=[i];if(o.length%2!=0)throw new Dr(Sr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(If(e,o[c])),u.push(o[c+1]);for(var h=[],f=Ei.empty(),d=a.length-1;d>=0;--d)if(!Sf(h,a[d])){var p=a[d],y=u[d];y=l(y);var v=s.Mc(p);if(y instanceof uf)h.push(p);else{var g=gf(y,v);null!=g&&(h.push(p),f.set(p,g))}}var m=new Xr(h);return new ef(f,m,s.fieldTransforms)}function vf(t,e,n,r){return void 0===r&&(r=!1),gf(n,t.Qc(r?4:3,e))}function gf(t,e){if(bf(t=l(t)))return wf("Unsupported field value:",e,t),mf(t,e);if(t instanceof $l)return function(t,e){if(!nf(e.xc))throw e.Bc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Bc(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.$c&&4!==e.xc)throw e.Bc("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=gf(o[i],e.Lc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=l(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return lo(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Br.fromDate(t);return{timestampValue:bs(e.R,n)}}if(t instanceof Br)return n=new Br(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:bs(e.R,n)};if(t instanceof Jl)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Xl)return{bytesValue:ws(e.R,t._byteString)};if(t instanceof Ll){n=e.databaseId;var r=t.firestore._databaseId;if(!r.isEqual(n))throw e.Bc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:Es(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Bc("Unsupported field value: "+Cl(t))}(t,e)}function mf(t,e){var n={};return zr(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Gr(t,(function(t,r){var i=gf(r,e.kc(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function bf(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Br||t instanceof Jl||t instanceof Xl||t instanceof Ll||t instanceof $l)}function wf(t,e,n){if(!bf(n)||("object"!=typeof(i=n)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i))){var r=Cl(n);throw"an object"===r?e.Bc(t+" a custom object"):e.Bc(t+" "+r)}var i}function If(t,e,n){if((e=l(e))instanceof Yl)return e._internalPath;if("string"==typeof e)return Ef(t,e);throw _f("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var Tf=new RegExp("[~\\*/\\[\\]]");function Ef(t,n,r){if(n.search(Tf)>=0)throw _f("Invalid field path ("+n+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,r);try{return(new(Yl.bind.apply(Yl,e([void 0],n.split(".")))))._internalPath}catch(i){throw _f("Invalid field path ("+n+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,r)}}function _f(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new Dr(Sr.INVALID_ARGUMENT,(a+=". ")+t+u)}function Sf(t,e){return t.some((function(t){return t.isEqual(e)}))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Df=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Ll(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new Nf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(Af("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),Nf=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.data=function(){return e.prototype.data.call(this)},n}(Df);function Af(t,e){return"string"==typeof e?Ef(t,e):e instanceof Yl?e._internalPath:e._delegate._internalPath}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var kf=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Cf=function(e){function n(t,n,r,i,o,s){var a=this;return(a=e.call(this,t,n,r,i,s)||this)._firestore=t,a._firestoreImpl=t,a.metadata=o,a}return t(n,e),n.prototype.exists=function(){return e.prototype.exists.call(this)},n.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new xf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}},n.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(Af("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},n}(Df),xf=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.data=function(t){return void 0===t&&(t={}),e.prototype.data.call(this,t)},n}(Cf),Rf=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new kf(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach((function(r){t.call(e,new xf(n._firestore,n._userDataWriter,r.key,r,new kf(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))}))},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Dr(Sr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map((function(e){var r=new xf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new kf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);return e.doc,{type:"added",doc:r,oldIndex:-1,newIndex:n++}}))}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var n=new xf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new kf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:Of(e.type),doc:n,oldIndex:i,newIndex:o}}))}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function Of(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Or()}}function Pf(t,e){return t instanceof Cf&&e instanceof Cf?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Rf&&e instanceof Rf&&t._firestore===e._firestore&&Bl(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lf(t){if(Xi(t)&&0===t.explicitOrderBy.length)throw new Dr(Sr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Mf=function(){};function Ff(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o._apply(t)}return t}var Vf=function(e){function n(t,n,r){var i=this;return(i=e.call(this)||this).Wc=t,i.Gc=n,i.zc=r,i.type="where",i}return t(n,e),n.prototype._apply=function(t){var e,n,r,i=sf(t.firestore),o=function(t,e,n,r,i,o,s){var a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){zf(s,o);for(var u=[],c=0,h=s;c<h.length;c++){var l=h[c];u.push(Gf(r,t,l))}a={arrayValue:{values:u}}}else a=Gf(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||zf(s,o),a=vf(n,"where",s,"in"===o||"not-in"===o);var f=xi.create(i,o,a);return function(t,e){if(e.g()){var n=Ji(t);if(null!==n&&!n.isEqual(e.field))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=$i(t);null!==r&&Qf(t,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw i===e.op?new Dr(Sr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new Dr(Sr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,f),f}(t._query,0,i,t.firestore._databaseId,this.Wc,this.Gc,this.zc);return new Ml(t.firestore,t.converter,(e=t._query,n=o,r=e.filters.concat([n]),new Qi(e.path,e.collectionGroup,e.explicitOrderBy.slice(),r,e.limit,e.limitType,e.startAt,e.endAt)))},n}(Mf),Uf=function(e){function n(t,n){var r=this;return(r=e.call(this)||this).Wc=t,r.Hc=n,r.type="orderBy",r}return t(n,e),n.prototype._apply=function(t){var e,n,r,i=function(t,e,n){if(null!==t.startAt)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new ji(e,n);return function(t,e){if(null===$i(t)){var n=Ji(t);null!==n&&Qf(t,n,e.field)}}(t,r),r}(t._query,this.Wc,this.Hc);return new Ml(t.firestore,t.converter,(e=t._query,n=i,r=e.explicitOrderBy.concat([n]),new Qi(e.path,e.collectionGroup,r,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)))},n}(Mf),qf=function(e){function n(t,n,r){var i=this;return(i=e.call(this)||this).type=t,i.Jc=n,i.Yc=r,i}return t(n,e),n.prototype._apply=function(t){return new Ml(t.firestore,t.converter,no(t._query,this.Jc,this.Yc))},n}(Mf),Bf=function(e){function n(t,n,r){var i=this;return(i=e.call(this)||this).type=t,i.Xc=n,i.Zc=r,i}return t(n,e),n.prototype._apply=function(t){var e,n,r=Kf(t,this.type,this.Xc,this.Zc);return new Ml(t.firestore,t.converter,(e=t._query,n=r,new Qi(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,n,e.endAt)))},n}(Mf),jf=function(e){function n(t,n,r){var i=this;return(i=e.call(this)||this).type=t,i.Xc=n,i.Zc=r,i}return t(n,e),n.prototype._apply=function(t){var e,n,r=Kf(t,this.type,this.Xc,this.Zc);return new Ml(t.firestore,t.converter,(e=t._query,n=r,new Qi(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,n)))},n}(Mf);function Kf(t,e,n,r){if(n[0]=l(n[0]),n[0]instanceof Df)return function(t,e,n,r,i){if(!r)throw new Dr(Sr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=to(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push(vi(e,r.key));else{var c=r.data.field(u.field);if(ni(c))throw new Dr(Sr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=u.field.canonicalString();throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new qi(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var i=sf(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new Dr(Sr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!Zi(t)&&-1!==c.indexOf("/"))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Hr.fromString(c));if(!ui.isDocumentKey(h))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var l=new ui(h);a.push(vi(e,l))}else{var f=vf(n,r,c);a.push(f)}}return new qi(a,o)}(t._query,t.firestore._databaseId,i,e,n,r)}function Gf(t,e,n){if("string"==typeof(n=l(n))){if(""===n)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Zi(e)&&-1!==n.indexOf("/"))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(Hr.fromString(n));if(!ui.isDocumentKey(r))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return vi(t,new ui(r))}if(n instanceof Ll)return vi(t,n._key);throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Cl(n)+".")}function zf(t,e){if(!Array.isArray(t)||0===t.length)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function Qf(t,e,n){if(!n.isEqual(e))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Hf=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),ci(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ti(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(ei(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Or()}},t.prototype.convertObject=function(t,e){var n=this,r={};return Gr(t.fields,(function(t,i){r[t]=n.convertValue(i,e)})),r},t.prototype.convertGeoPoint=function(t){return new Jl(ti(t.latitude),ti(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map((function(t){return n.convertValue(t,e)}))},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=ri(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(ii(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=Zr(t);return new Br(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=Hr.fromString(t);Pr(Hs(n));var r=new gl(n.get(1),n.get(3)),i=new ui(n.popFirst(5));return r.isEqual(e)||Cr("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wf(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Yf=function(e){function n(t){var n=this;return(n=e.call(this)||this).firestore=t,n}return t(n,e),n.prototype.convertBytes=function(t){return new Xl(t)},n.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Ll(this.firestore,null,e)},n}(Hf),Xf=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=sf(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=$f(t,this._firestore),i=Wf(r.converter,e,n),o=af(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,No.none())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();var o,s=$f(t,this._firestore);return o="string"==typeof(e=l(e))||e instanceof Yl?yf(this._dataReader,"WriteBatch.update",s._key,e,n,r):pf(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,No.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=$f(t,this._firestore);return this._mutations=this._mutations.concat(new jo(e._key,No.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new Dr(Sr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $f(t,e){if((t=l(t)).firestore!==e)throw new Dr(Sr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Jf=function(e){function n(t){var n=this;return(n=e.call(this)||this).firestore=t,n}return t(n,e),n.prototype.convertBytes=function(t){return new Xl(t)},n.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Ll(this.firestore,null,e)},n}(Hf);function Zf(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=xl(t,Ll);var o=xl(t.firestore,Gl),s=sf(o);return ed(o,[("string"==typeof(e=l(e))||e instanceof Yl?yf(s,"updateDoc",t._key,e,n,r):pf(s,"updateDoc",t._key,e)).toMutation(t._key,No.exists(!0))])}function td(t){for(var e,n,o,s=[],a=1;a<arguments.length;a++)s[a-1]=arguments[a];t=l(t);var u={includeMetadataChanges:!1},c=0;"object"!=typeof s[c]||Kl(s[c])||(u=s[c],c++);var h,f,d,p={includeMetadataChanges:u.includeMetadataChanges};if(Kl(s[c])){var y=s[c];s[c]=null===(e=y.next)||void 0===e?void 0:e.bind(y),s[c+1]=null===(n=y.error)||void 0===n?void 0:n.bind(y),s[c+2]=null===(o=y.complete)||void 0===o?void 0:o.bind(y)}if(t instanceof Ll)f=xl(t.firestore,Gl),d=Wi(t._key.path),h={next:function(e){s[c]&&s[c](nd(f,t,e))},error:s[c+1],complete:s[c+2]};else{var v=xl(t,Ml);f=xl(v.firestore,Gl),d=v._query;var g=new Jf(f);h={next:function(t){s[c]&&s[c](new Rf(f,g,v,t))},error:s[c+1],complete:s[c+2]},Lf(t._query)}return function(t,e,n,o){var s=this,a=new el(o),u=new dh(e,a,n);return t.asyncQueue.enqueueAndForget((function(){return r(s,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return e=uh,[4,dl(t)];case 1:return[2,e.apply(void 0,[n.sent(),u])]}}))}))})),function(){a.Wo(),t.asyncQueue.enqueueAndForget((function(){return r(s,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return e=ch,[4,dl(t)];case 1:return[2,e.apply(void 0,[n.sent(),u])]}}))}))}))}}(zl(f),d,p,h)}function ed(t,e){return function(t,e){var n=this,o=new ga;return t.asyncQueue.enqueueAndForget((function(){return r(n,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return n=Eh,[4,fl(t)];case 1:return[2,n.apply(void 0,[r.sent(),e,o])]}}))}))})),o.promise}(zl(t),e)}function nd(t,e,n){var r=n.docs.get(e._key),i=new Jf(t);return new Cf(t,i,e._key,r,new kf(n.hasPendingWrites,n.fromCache),e.converter)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var rd=function(e){function n(t,n){var r=this;return(r=e.call(this,t,n)||this)._firestore=t,r}return t(n,e),n.prototype.get=function(t){var n=this,r=$f(t,this._firestore),i=new Jf(this._firestore);return e.prototype.get.call(this,t).then((function(t){return new Cf(n._firestore,i,r._key,t._document,new kf(!1,!1),r.converter)}))},n}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=sf(t)}return t.prototype.get=function(t){var e=this,n=$f(t,this._firestore),r=new Yf(this._firestore);return this._transaction.lookup([n._key]).then((function(t){if(!t||1!==t.length)return Or();var i=t[0];if(i.isFoundDocument())return new Df(e._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new Df(e._firestore,r,n._key,null,n.converter);throw Or()}))},t.prototype.set=function(t,e,n){var r=$f(t,this._firestore),i=Wf(r.converter,e,n),o=af(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,s=$f(t,this._firestore);return o="string"==typeof(e=l(e))||e instanceof Yl?yf(this._dataReader,"Transaction.update",s._key,e,n,r):pf(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,o),this},t.prototype.delete=function(t){var e=$f(t,this._firestore);return this._transaction.delete(e._key),this},t}());
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function id(){if("undefined"==typeof Uint8Array)throw new Dr(Sr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function od(){if("undefined"==typeof atob)throw new Dr(Sr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var sd=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return od(),new t(Xl.fromBase64String(e))},t.fromUint8Array=function(e){return id(),new t(Xl.fromUint8Array(e))},t.prototype.toBase64=function(){return od(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return id(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),ad=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){Wl(t=xl(t,Gl));var n=zl(t),r=t._freezeSettings(),i=new tl;return Hl(n,i,new Jh(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){Wl(t=xl(t,Gl));var e=zl(t),n=t._freezeSettings(),r=new tl;return Hl(e,r,new Zh(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new Dr(Sr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new ga;return t._queue.enqueueAndForgetEvenWhileRestricted((function(){return r(e,void 0,void 0,(function(){var e;return i(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t){return r(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return wa.yt()?(e=t+"main",[4,wa.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}}))}))}(xu(t._databaseId,t._persistenceKey))];case 1:return o.sent(),n.resolve(),[3,3];case 2:return e=o.sent(),n.reject(e),[3,3];case 3:return[2]}}))}))})),n.promise}(t._delegate)},t}(),ud=function(){function t(t,e,n){var r=this;this._delegate=e,this.tu=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof gl||(this.eu=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){var e=this._delegate._getSettings();t.merge||e.host===t.host||xr("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e,n){void 0===n&&(n={}),function(t,e,n,r){void 0===r&&(r={});var i=(t=xl(t,Pl))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&xr("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},i),{host:e+":"+n,ssl:!1})),r.mockUserToken){var o=f(r.mockUserToken),s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new Dr(Sr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t._credentials=new Il(new bl(o,new ic(s)))}}(this._delegate,t,e,n)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return r(e,void 0,void 0,(function(){var e,n;return i(this,(function(r){switch(r.label){case 0:return[4,cl(t)];case 1:return e=r.sent(),[4,ll(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),i=n,o=Lr(i),o.Or.delete(0),Cc(o))]}var i,o}))}))}))}(zl(xl(this._delegate,Gl)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return r(e,void 0,void 0,(function(){var e,n;return i(this,(function(o){switch(o.label){case 0:return[4,cl(t)];case 1:return e=o.sent(),[4,ll(t)];case 2:return n=o.sent(),[2,(e.setNetworkEnabled(!1),function(t){return r(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return(e=Lr(t)).Or.add(0),[4,xc(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}}))}))}(n))]}}))}))}))}(zl(xl(this._delegate,Gl)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&Nl("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.tu.enableMultiTabIndexedDbPersistence(this):this.tu.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.tu.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.eu&&(this.eu._removeServiceInstance("firestore"),this.eu._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new ga;return t.asyncQueue.enqueueAndForget((function(){return r(e,void 0,void 0,(function(){var e;return i(this,(function(r){switch(r.label){case 0:return e=kh,[4,fl(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}}))}))})),n.promise}(zl(xl(this._delegate,Gl)))},t.prototype.onSnapshotsInSync=function(t){return e=this._delegate,n=t,function(t,e){var n=this,o=new el(e);return t.asyncQueue.enqueueAndForget((function(){return r(n,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return e=function(t,e){Lr(t).Gr.add(e),e.next()},[4,dl(t)];case 1:return[2,e.apply(void 0,[n.sent(),o])]}}))}))})),function(){o.Wo(),t.asyncQueue.enqueueAndForget((function(){return r(n,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return e=function(t,e){Lr(t).Gr.delete(e)},[4,dl(t)];case 1:return[2,e.apply(void 0,[n.sent(),o])]}}))}))}))}}(zl(e=xl(e,Gl)),Kl(n)?n:{next:n});var e,n},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.eu)throw new Dr(Sr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.eu},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Td(this,Vl(this._delegate,t))}catch(e){throw pd(e,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new dd(this,Ul(this._delegate,t))}catch(e){throw pd(e,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new bd(this,function(t,e){if(t=xl(t,Pl),Sl("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new Ml(t,null,(n=e,new Qi(Hr.emptyPath(),n)));var n}(this._delegate,t))}catch(e){throw pd(e,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e,n=this;return function(t,e){var n=this,o=new ga;return t.asyncQueue.enqueueAndForget((function(){return r(n,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return[4,(i=t,ul(i).then((function(t){return t.datastore})))];case 1:return n=r.sent(),new rl(t.asyncQueue,n,e,o).run(),[2]}var i}))}))})),o.promise}(zl(e=this._delegate),(function(r){return function(e){return t(new hd(n,e))}(new rd(e,r))}))},t.prototype.batch=function(){var t=this;return zl(this._delegate),new ld(new Xf(this._delegate,(function(e){return ed(t._delegate,e)})))},t.prototype.loadBundle=function(t){throw new Dr(Sr.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new Dr(Sr.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),cd=function(e){function n(t){var n=this;return(n=e.call(this)||this).firestore=t,n}return t(n,e),n.prototype.convertBytes=function(t){return new sd(new Xl(t))},n.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return dd.nu(e,this.firestore,null)},n}(Hf);var hd=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new cd(t)}return t.prototype.get=function(t){var e=this,n=Ed(t);return this._delegate.get(n).then((function(t){return new gd(e._firestore,new Cf(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))}))},t.prototype.set=function(t,e,n){var r=Ed(t);return n?(Dl("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,n,r){for(var i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];var a=Ed(t);return 2===arguments.length?this._delegate.update(a,n):(i=this._delegate).update.apply(i,e([a,n,r],o)),this},t.prototype.delete=function(t){var e=Ed(t);return this._delegate.delete(e),this},t}(),ld=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=Ed(t);return n?(Dl("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,n,r){for(var i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];var a=Ed(t);return 2===arguments.length?this._delegate.update(a,n):(i=this._delegate).update.apply(i,e([a,n,r],o)),this},t.prototype.delete=function(t){var e=Ed(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),fd=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new xf(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new md(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.su=function(e,n){var r=t.iu,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new cd(e),n),i.set(n,o)),o},t}();fd.iu=new WeakMap;var dd=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new cd(t)}return t.ru=function(e,n,r){if(e.length%2!=0)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new Ll(n._delegate,r,new ui(e)))},t.nu=function(e,n,r){return new t(n,new Ll(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Td(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Td(this.firestore,Vl(this._delegate,t))}catch(e){throw pd(e,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=l(t))instanceof Ll&&ql(this._delegate,t)},t.prototype.set=function(t,e){e=Dl("DocumentReference.set",e);try{return function(t,e,n){t=xl(t,Ll);var r=xl(t.firestore,Gl),i=Wf(t.converter,e,n);return ed(r,[af(sf(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,No.none())])}(this._delegate,t,e)}catch(n){throw pd(n,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];try{return 1===arguments.length?Zf(this._delegate,t):Zf.apply(void 0,e([this._delegate,t,n],r))}catch(o){throw pd(o,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return ed(xl((t=this._delegate).firestore,Gl),[new jo(t._key,No.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=yd(e),i=vd(e,(function(e){return new gd(t.firestore,new Cf(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))}));return td(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=xl(t,Ll);var e=xl(t.firestore,Gl),n=zl(e),o=new Jf(e);return function(t,e){var n=this,o=new ga;return t.asyncQueue.enqueueAndForget((function(){return r(n,void 0,void 0,(function(){var n;return i(this,(function(s){switch(s.label){case 0:return n=function(t,e,n){return r(this,void 0,void 0,(function(){var r,o;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,(s=t,a=e,u=Lr(s),u.persistence.runTransaction("read document","readonly",(function(t){return u.Mn.mn(t,a)})))];case 1:return(o=i.sent()).isFoundDocument()?n.resolve(o):o.isNoDocument()?n.resolve(null):n.reject(new Dr(Sr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=i.sent(),o=nh(r,"Failed to get document '"+e+" from cache"),n.reject(o),[3,3];case 3:return[2]}var s,a,u}))}))},[4,hl(t)];case 1:return[2,n.apply(void 0,[s.sent(),e,o])]}}))}))})),o.promise}(n,t._key).then((function(n){return new Cf(e,o,t._key,n,new kf(null!==n&&n.hasLocalMutations,!0),t.converter)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=xl(t,Ll);var e=xl(t.firestore,Gl);return pl(zl(e),t._key,{source:"server"}).then((function(n){return nd(e,t,n)}))}(this._delegate):function(t){t=xl(t,Ll);var e=xl(t.firestore,Gl);return pl(zl(e),t._key).then((function(n){return nd(e,t,n)}))}(this._delegate)).then((function(t){return new gd(e.firestore,new Cf(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))}))},t.prototype.withConverter=function(e){return new t(this.firestore,e?this._delegate.withConverter(fd.su(this.firestore,e)):this._delegate.withConverter(null))},t}();function pd(t,e,n){return t.message=t.message.replace(e,n),t}function yd(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!Kl(r))return r}return{}}function vd(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=Kl(t[0])?t[0]:Kl(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var gd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new dd(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return Pf(this._delegate,t._delegate)},t}(),md=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.data=function(t){return this._delegate.data(t)},n}(gd),bd=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new cd(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,Ff(this._delegate,(o=r,s=i=n,a=Af("where",e),new Vf(a,s,o))))}catch(i){throw pd(i,/(orderBy|where)\(\)/,"Query.$1()")}var i,o,s,a},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,Ff(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=Af("orderBy",t);return new Uf(r,n)}(e,n)))}catch(r){throw pd(r,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,Ff(this._delegate,(Rl("limit",n=e),new qf("limit",n,"F"))))}catch(r){throw pd(r,"limit()","Query.limit()")}var n},t.prototype.limitToLast=function(e){try{return new t(this.firestore,Ff(this._delegate,(Rl("limitToLast",n=e),new qf("limitToLast",n,"L"))))}catch(r){throw pd(r,"limitToLast()","Query.limitToLast()")}var n},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Ff(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Bf("startAt",t,!0)}.apply(void 0,e)))}catch(r){throw pd(r,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Ff(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Bf("startAfter",t,!1)}.apply(void 0,e)))}catch(r){throw pd(r,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Ff(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new jf("endBefore",t,!0)}.apply(void 0,e)))}catch(r){throw pd(r,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Ff(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new jf("endAt",t,!1)}.apply(void 0,e)))}catch(r){throw pd(r,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return Bl(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=xl(t,Ml);var e=xl(t.firestore,Gl),n=zl(e),o=new Jf(e);return function(t,e){var n=this,o=new ga;return t.asyncQueue.enqueueAndForget((function(){return r(n,void 0,void 0,(function(){var n;return i(this,(function(s){switch(s.label){case 0:return n=function(t,e,n){return r(this,void 0,void 0,(function(){var r,o,s,a,u;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,Gu(t,e,!0)];case 1:return u=i.sent(),r=new vh(e,u.Bn),o=r._o(u.documents),s=r.applyChanges(o,!1),n.resolve(s.snapshot),[3,3];case 2:return a=i.sent(),u=nh(a,"Failed to execute query '"+e+" against cache"),n.reject(u),[3,3];case 3:return[2]}}))}))},[4,hl(t)];case 1:return[2,n.apply(void 0,[s.sent(),e,o])]}}))}))})),o.promise}(n,t._query).then((function(n){return new Rf(e,o,t,n)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=xl(t,Ml);var e=xl(t.firestore,Gl),n=zl(e),r=new Jf(e);return yl(n,t._query,{source:"server"}).then((function(n){return new Rf(e,r,t,n)}))}(this._delegate):function(t){t=xl(t,Ml);var e=xl(t.firestore,Gl),n=zl(e),r=new Jf(e);return Lf(t._query),yl(n,t._query).then((function(n){return new Rf(e,r,t,n)}))}(this._delegate)).then((function(t){return new Id(e.firestore,new Rf(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))}))},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=yd(e),i=vd(e,(function(e){return new Id(t.firestore,new Rf(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))}));return td(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,e?this._delegate.withConverter(fd.su(this.firestore,e)):this._delegate.withConverter(null))},t}(),wd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new md(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),Id=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new bd(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map((function(e){return new md(t._firestore,e)}))},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map((function(t){return new wd(e._firestore,t)}))},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach((function(r){t.call(e,new md(n._firestore,r))}))},t.prototype.isEqual=function(t){return Pf(this._delegate,t._delegate)},t}(),Td=function(e){function n(t,n){var r=this;return(r=e.call(this,t,n)||this).firestore=t,r._delegate=n,r}return t(n,e),Object.defineProperty(n.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new dd(this.firestore,t):null},enumerable:!1,configurable:!0}),n.prototype.doc=function(t){try{return new dd(this.firestore,void 0===t?Ul(this._delegate):Ul(this._delegate,t))}catch(e){throw pd(e,"doc()","CollectionReference.doc()")}},n.prototype.add=function(t){var e,n,r,i,o,s=this;return(e=this._delegate,n=t,r=xl(e.firestore,Gl),i=Ul(e),o=Wf(e.converter,n),ed(r,[af(sf(e.firestore),"addDoc",i._key,o,null!==e.converter,{}).toMutation(i._key,No.exists(!1))]).then((function(){return i}))).then((function(t){return new dd(s.firestore,t)}))},n.prototype.isEqual=function(t){return ql(this._delegate,t._delegate)},n.prototype.withConverter=function(t){return new n(this.firestore,t?this._delegate.withConverter(fd.su(this.firestore,t)):this._delegate.withConverter(null))},n}(bd);function Ed(t){return xl(t,Ll)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var _d,Sd=function(){function t(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._delegate=new(Yl.bind.apply(Yl,e([void 0],t)))}return t.documentId=function(){return new t(Yr.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=l(t))instanceof Yl&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),Dd=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new hf("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new uf("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new lf("arrayUnion",t)}.apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new ff("arrayRemove",t)}.apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=new df("increment",e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}(),Nd={Firestore:ud,GeoPoint:Jl,Timestamp:Br,Blob:sd,Transaction:hd,WriteBatch:ld,DocumentReference:dd,DocumentSnapshot:gd,Query:bd,QueryDocumentSnapshot:md,QuerySnapshot:Id,CollectionReference:Td,FieldPath:Sd,FieldValue:Dd,setLogLevel:function(t){var e;e=t,Nr.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};(_d=v).INTERNAL.registerComponent(new y("firestore",(function(t){return function(t,e){return new ud(t,new Gl(t,e),new ad)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))}),"PUBLIC").setServiceProps(Object.assign({},Nd))),_d.registerVersion("@firebase/firestore","2.3.2");
