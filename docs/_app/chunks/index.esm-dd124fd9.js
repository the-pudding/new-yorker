import{_ as t,a as e,b as n,c as r,g as i,i as o,d as s,e as a,h as u,j as c,k as h,l,m as f,L as d,n as p,C as y,f as v}from"./index.esm-ea9ec1de.js";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var g=function(t,e){return(g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function m(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var w,b="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},I=I||{},T=b||self;function E(){}function _(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function S(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var D="closure_uid_"+(1e9*Math.random()>>>0),N=0;function A(t,e,n){return t.call.apply(t.bind,arguments)}function k(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function C(t,e,n){return(C=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?A:k).apply(null,arguments)}function x(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function R(){return Date.now()}function O(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Kb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function P(){this.j=this.j,this.i=this.i}P.prototype.j=!1,P.prototype.ja=function(){var t;!this.j&&(this.j=!0,this.G(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,D)&&t[D]||(t[D]=++N))},P.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var L=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},M=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function F(t){return Array.prototype.concat.apply([],arguments)}function V(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function U(t){return/^[\s\xa0]*$/.test(t)}var q,B=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function j(t,e){return-1!=t.indexOf(e)}function K(t,e){return t<e?-1:t>e?1:0}t:{var G=T.navigator;if(G){var z=G.userAgent;if(z){q=z;break t}}q=""}function Q(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function H(t){var e={};for(var n in t)e[n]=t[n];return e}var W="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Y(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<W.length;o++)n=W[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function X(t){return X[" "](t),t}X[" "]=E;var J,$,Z=j(q,"Opera"),tt=j(q,"Trident")||j(q,"MSIE"),et=j(q,"Edge"),nt=et||tt,rt=j(q,"Gecko")&&!(j(q.toLowerCase(),"webkit")&&!j(q,"Edge"))&&!(j(q,"Trident")||j(q,"MSIE"))&&!j(q,"Edge"),it=j(q.toLowerCase(),"webkit")&&!j(q,"Edge");function ot(){var t=T.document;return t?t.documentMode:void 0}t:{var st="",at=($=q,rt?/rv:([^\);]+)(\)|;)/.exec($):et?/Edge\/([\d\.]+)/.exec($):tt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec($):it?/WebKit\/(\S+)/.exec($):Z?/(?:Version)[ \/]?(\S+)/.exec($):void 0);if(at&&(st=at?at[1]:""),tt){var ut=ot();if(null!=ut&&ut>parseFloat(st)){J=String(ut);break t}}J=st}var ct,ht={};function lt(t){return function(t,e){var n=ht;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,(function(){for(var e=0,n=B(String(J)).split("."),r=B(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var s=n[o]||"",a=r[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==s[0].length&&0==a[0].length)break;e=K(0==s[1].length?0:parseInt(s[1],10),0==a[1].length?0:parseInt(a[1],10))||K(0==s[2].length,0==a[2].length)||K(s[2],a[2]),s=s[3],a=a[3]}while(0==e)}return 0<=e}))}if(T.document&&tt){var ft=ot();ct=ft||(parseInt(J,10)||void 0)}else ct=void 0;var dt=ct,pt=!tt||9<=Number(dt),yt=tt&&!lt("9"),vt=function(){if(!T.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{T.addEventListener("test",E,e),T.removeEventListener("test",E,e)}catch(n){}return t}();function gt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function mt(t,e){if(gt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(rt){t:{try{X(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:wt[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}gt.prototype.b=function(){this.defaultPrevented=!0},O(mt,gt);var wt={2:"touch",3:"pen",4:"mouse"};mt.prototype.b=function(){mt.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,yt)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(e){}};var bt="closure_listenable_"+(1e6*Math.random()|0),It=0;function Tt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++It,this.Y=this.Z=!1}function Et(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function _t(t){this.src=t,this.a={},this.b=0}function St(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=L(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(Et(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function Dt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}_t.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Dt(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new Tt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Nt="closure_lm_"+(1e6*Math.random()|0),At={};function kt(t,e,n,r,i){if(r&&r.once)return xt(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)kt(t,e[o],n,r,i);return null}return n=Ut(n),t&&t[bt]?t.va(e,n,S(r)?!!r.capture:!!r,i):Ct(t,e,n,!1,r,i)}function Ct(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=S(i)?!!i.capture:!!i;if(s&&!pt)return null;var a=Ft(t);if(a||(t[Nt]=a=new _t(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=Mt,e=pt?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)vt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Pt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function xt(t,e,n,r,i){if(Array.isArray(e)){for(var o=0;o<e.length;o++)xt(t,e[o],n,r,i);return null}return n=Ut(n),t&&t[bt]?t.wa(e,n,S(r)?!!r.capture:!!r,i):Ct(t,e,n,!0,r,i)}function Rt(t,e,n,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)Rt(t,e[o],n,r,i);else r=S(r)?!!r.capture:!!r,n=Ut(n),t&&t[bt]?(t=t.c,(e=String(e).toString())in t.a&&(-1<(n=Dt(o=t.a[e],n,r,i))&&(Et(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--)))):t&&(t=Ft(t))&&(e=t.a[e.toString()],t=-1,e&&(t=Dt(e,n,r,i)),(n=-1<t?e[t]:null)&&Ot(n))}function Ot(t){if("number"!=typeof t&&t&&!t.Y){var e=t.src;if(e&&e[bt])St(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Pt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ft(e))?(St(n,t),0==n.b&&(n.src=null,e[Nt]=null)):Et(t)}}}function Pt(t){return t in At?At[t]:At[t]="on"+t}function Lt(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&Ot(t),n.call(r,e)}function Mt(t,e){if(t.Y)return!0;if(!pt){if(!e)t:{e=["window","event"];for(var n=T,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Lt(t,e=new mt(e,this))}return Lt(t,new mt(e,this))}function Ft(t){return(t=t[Nt])instanceof _t?t:null}var Vt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ut(t){return"function"==typeof t?t:(t[Vt]||(t[Vt]=function(e){return t.handleEvent(e)}),t[Vt])}function qt(){P.call(this),this.c=new _t(this),this.J=this,this.C=null}function Bt(t,e){var n,r=t.C;if(r)for(n=[];r;r=r.C)n.push(r);if(t=t.J,r=e.type||e,"string"==typeof e)e=new gt(e,t);else if(e instanceof gt)e.target=e.target||t;else{var i=e;Y(e=new gt(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.a=n[o];i=jt(s,r,!0,e)&&i}if(i=jt(s=e.a=t,r,!0,e)&&i,i=jt(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=jt(s=e.a=n[o],r,!1,e)&&i}function jt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.Y&&s.capture==n){var a=s.listener,u=s.ca||s.src;s.Z&&St(t.c,s),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}O(qt,P),qt.prototype[bt]=!0,(w=qt.prototype).addEventListener=function(t,e,n,r){kt(this,t,e,n,r)},w.removeEventListener=function(t,e,n,r){Rt(this,t,e,n,r)},w.G=function(){if(qt.X.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Et(n[r]);delete e.a[t],e.b--}}this.C=null},w.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},w.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Kt=T.JSON.stringify;function Gt(){this.b=this.a=null}var zt,Qt=new(function(){function t(t,e){this.c=t,this.f=e,this.b=0,this.a=null}return t.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},t}())((function(){return new Wt}),(function(t){t.reset()}));function Ht(){var t=$t,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function Wt(){this.next=this.b=this.a=null}function Yt(t){T.setTimeout((function(){throw t}),0)}function Xt(t,e){zt||function(){var t=T.Promise.resolve(void 0);zt=function(){t.then(Zt)}}(),Jt||(zt(),Jt=!0),$t.add(t,e)}Gt.prototype.add=function(t,e){var n=Qt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Wt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},Wt.prototype.reset=function(){this.next=this.b=this.a=null};var Jt=!1,$t=new Gt;function Zt(){for(var t;t=Ht();){try{t.a.call(t.b)}catch(n){Yt(n)}var e=Qt;e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}Jt=!1}function te(t,e){qt.call(this),this.b=t||1,this.a=e||T,this.f=C(this.Za,this),this.g=R()}function ee(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function ne(t,e,n){if("function"==typeof t)n&&(t=C(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=C(t.handleEvent,t)}return 2147483647<Number(e)?-1:T.setTimeout(t,e||0)}function re(t){t.a=ne((function(){t.a=null,t.c&&(t.c=!1,re(t))}),t.h);var e=t.b;t.b=null,t.g.apply(null,e)}O(te,qt),(w=te.prototype).aa=!1,w.M=null,w.Za=function(){if(this.aa){var t=R()-this.g;0<t&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),Bt(this,"tick"),this.aa&&(ee(this),this.start()))}},w.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=R())},w.G=function(){te.X.G.call(this),ee(this),delete this.a};var ie=function(t){function e(e,n){var r=t.call(this)||this;return r.g=e,r.h=n,r.b=null,r.c=!1,r.a=null,r}return function(t,e){function n(){this.constructor=t}g(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:re(this)},e.prototype.G=function(){t.prototype.G.call(this),this.a&&(T.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},e}(P);function oe(t){P.call(this),this.b=t,this.a={}}O(oe,P);var se=[];function ae(t,e,n,r){Array.isArray(n)||(n&&(se[0]=n.toString()),n=se);for(var i=0;i<n.length;i++){var o=kt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function ue(t){Q(t.a,(function(t,e){this.a.hasOwnProperty(e)&&Ot(t)}),t),t.a={}}function ce(){this.a=!0}function he(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return Kt(n)}catch(a){return e}}(t,n)+(r?" "+r:"")}))}oe.prototype.G=function(){oe.X.G.call(this),ue(this)},oe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ce.prototype.info=function(){};var le={},fe=null;function de(){return fe=fe||new qt}function pe(t){gt.call(this,le.Fa,t)}function ye(t){var e=de();Bt(e,new pe(e,t))}function ve(t,e){gt.call(this,le.STAT_EVENT,t),this.stat=e}function ge(t){var e=de();Bt(e,new ve(e,t))}function me(t){gt.call(this,le.Ga,t)}function we(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return T.setTimeout((function(){t()}),e)}le.Fa="serverreachability",O(pe,gt),le.STAT_EVENT="statevent",O(ve,gt),le.Ga="timingevent",O(me,gt);var be={NO_ERROR:0,$a:1,nb:2,mb:3,hb:4,lb:5,ob:6,Da:7,TIMEOUT:8,rb:9},Ie={fb:"complete",Bb:"success",Ea:"error",Da:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",ib:"downloadprogress",Jb:"uploadprogress"};function Te(){}function Ee(t){var e;return(e=t.a)||(e=t.a={}),e}function _e(){}Te.prototype.a=null;var Se,De={OPEN:"a",eb:"b",Ea:"c",qb:"d"};function Ne(){gt.call(this,"d")}function Ae(){gt.call(this,"c")}function ke(){}function Ce(t,e,n,r){this.g=t,this.c=e,this.f=n,this.S=r||1,this.J=new oe(this),this.P=xe,t=nt?125:void 0,this.R=new te(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}O(Ne,gt),O(Ae,gt),O(ke,Te),Se=new ke;var xe=45e3,Re={},Oe={};function Pe(t,e,n){t.H=1,t.i=nn(Xe(e)),t.j=n,t.I=!0,Le(t,null)}function Le(t,e){t.u=R(),Ve(t),t.l=Xe(t.i);var n=t.l,r=t.S;Array.isArray(r)||(r=[String(r)]),vn(n.b,"t",r),t.D=0,t.a=hr(t.g,t.g.C?e:null),0<t.O&&(t.F=new ie(C(t.Ca,t,t.a),t.O)),ae(t.J,t.a,"readystatechange",t.Xa),e=t.B?H(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),ye(1),function(t,e,n,r,i,o){t.info((function(){if(t.a)if(o)for(var s="",a=o.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&"type"==l[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s}))}(t.c,t.m,t.l,t.f,t.S,t.j)}function Me(t,e,n){for(var r=!0;!t.A&&t.D<n.length;){var i=Fe(t,n);if(i==Oe){4==e&&(t.h=4,ge(14),r=!1),he(t.c,t.f,null,"[Incomplete Response]");break}if(i==Re){t.h=4,ge(15),he(t.c,t.f,n,"[Invalid Chunk]"),r=!1;break}he(t.c,t.f,i,null),Ke(t,i)}4==e&&0==n.length&&(t.h=1,ge(16),r=!1),t.b=t.b&&r,r?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),nr(e),e.F=!0,ge(11))):(he(t.c,t.f,n,"[Invalid Chunked Response]"),je(t),Be(t))}function Fe(t,e){var n=t.D,r=e.indexOf("\n",n);return-1==r?Oe:(n=Number(e.substring(n,r)),isNaN(n)?Re:(r+=1)+n>e.length?Oe:(e=e.substr(r,n),t.D=r+n,e))}function Ve(t){t.T=R()+t.P,Ue(t,t.P)}function Ue(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=we(C(t.Va,t),e)}function qe(t){t.o&&(T.clearTimeout(t.o),t.o=null)}function Be(t){0==t.g.v||t.A||or(t.g,t)}function je(t){qe(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,ee(t.R),ue(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function Ke(t,e){try{var n=t.g;if(0!=n.v&&(n.a==t||En(n.b,t)))if(n.I=t.N,!t.C&&En(n.b,t)&&3==n.v){try{var r=n.ka.a.parse(e)}catch(v){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.j){if(n.a){if(!(n.a.u+3e3<t.u))break t;ir(n),Hn(n)}er(n),ge(18)}}else n.oa=i[1],0<n.oa-n.P&&37500>i[2]&&n.H&&0==n.o&&!n.m&&(n.m=we(C(n.Sa,n),6e3));if(1>=Tn(n.b)&&n.ea){try{n.ea()}catch(v){}n.ea=void 0}}else ar(n,11)}else if((t.C||n.a==t)&&ir(n),!U(e))for(e=r=n.ka.a.parse(e),r=0;r<e.length;r++)if(i=e[r],n.P=i[0],i=i[1],2==n.v)if("c"==i[0]){n.J=i[1],n.ga=i[2];var o=i[3];null!=o&&(n.ha=o,n.c.info("VER="+n.ha));var s=i[4];null!=s&&(n.pa=s,n.c.info("SVER="+n.pa));var a=i[5];if(null!=a&&"number"==typeof a&&0<a){var u=1.5*a;n.D=u,n.c.info("backChannelRequestTimeoutMs_="+u)}u=n;var c=t.a;if(c){var h=c.a?c.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=u.b;!l.a&&(j(h,"spdy")||j(h,"quic")||j(h,"h2"))&&(l.f=l.g,l.a=new Set,l.b&&(_n(l,l.b),l.b=null))}if(u.A){var f=c.a?c.a.getResponseHeader("X-HTTP-Session-Id"):null;f&&(u.na=f,en(u.B,u.A,f))}}n.v=3,n.f&&n.f.ta(),n.U&&(n.N=R()-t.u,n.c.info("Handshake RTT: "+n.N+"ms"));var d=t;if((u=n).la=cr(u,u.C?u.ga:null,u.fa),d.C){Sn(u.b,d);var p=d,y=u.D;y&&p.setTimeout(y),p.o&&(qe(p),Ve(p)),u.a=d}else tr(u);0<n.g.length&&Xn(n)}else"stop"!=i[0]&&"close"!=i[0]||ar(n,7);else 3==n.v&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?ar(n,7):Qn(n):"noop"!=i[0]&&n.f&&n.f.sa(i),n.o=0);ye(4)}catch(v){}}function Ge(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(_(t)||"string"==typeof t)M(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(_(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(_(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function ze(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof ze)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Qe(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];He(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)He(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function He(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(w=Ce.prototype).setTimeout=function(t){this.P=t},w.Xa=function(t){t=t.target;var e=this.F;e&&3==jn(t)?e.f():this.Ca(t)},w.Ca=function(t){try{if(t==this.a)t:{var e=jn(this.a),n=this.a.ua(),r=this.a.W();if(!(3>e||3==e&&!nt&&!this.a.$())){this.A||4!=e||7==n||ye(8==n||0>=r?3:2),qe(this);var i=this.a.W();this.N=i;var o=this.a.$();if(this.b=200==i,function(t,e,n,r,i,o,s){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s}))}(this.c,this.m,this.l,this.f,this.S,e,i),this.b){if(this.U&&!this.C){e:{if(this.a){var s,a=this.a;if((s=a.a?a.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!U(s)){var u=s;break e}}u=null}if(!u){this.b=!1,this.h=3,ge(12),je(this),Be(this);break t}he(this.c,this.f,u,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Ke(this,u)}this.I?(Me(this,e,o),nt&&this.b&&3==e&&(ae(this.J,this.R,"tick",this.Wa),this.R.start())):(he(this.c,this.f,o,null),Ke(this,o)),4==e&&je(this),this.b&&!this.A&&(4==e?or(this.g,this):(this.b=!1,Ve(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.h=3,ge(12)):(this.h=0,ge(13)),je(this),Be(this)}}}catch(c){}},w.Wa=function(){if(this.a){var t=jn(this.a),e=this.a.$();this.D<e.length&&(qe(this),Me(this,t,e),this.b&&4!=t&&Ve(this))}},w.cancel=function(){this.A=!0,je(this)},w.Va=function(){this.o=null;var t=R();0<=t-this.T?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.c,this.l),2!=this.H&&(ye(3),ge(17)),je(this),this.h=2,Be(this)):Ue(this,this.T-t)},(w=ze.prototype).K=function(){Qe(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},w.L=function(){return Qe(this),this.a.concat()},w.get=function(t,e){return He(this.b,t)?this.b[t]:e},w.set=function(t,e){He(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},w.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var We=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ye(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Ye){this.a=void 0!==e?e:t.a,Je(this,t.f),this.j=t.j,$e(this,t.c),Ze(this,t.h),this.g=t.g,e=t.b;var n=new fn;n.c=e.c,e.a&&(n.a=new ze(e.a),n.b=e.b),tn(this,n),this.i=t.i}else t&&(n=String(t).match(We))?(this.a=!!e,Je(this,n[1]||"",!0),this.j=rn(n[2]||""),$e(this,n[3]||"",!0),Ze(this,n[4]),this.g=rn(n[5]||"",!0),tn(this,n[6]||"",!0),this.i=rn(n[7]||"")):(this.a=!!e,this.b=new fn(null,this.a))}function Xe(t){return new Ye(t)}function Je(t,e,n){t.f=n?rn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function $e(t,e,n){t.c=n?rn(e,!0):e}function Ze(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.h=e}else t.h=null}function tn(t,e,n){e instanceof fn?(t.b=e,function(t,e){e&&!t.f&&(dn(t),t.c=null,t.a.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(pn(this,e),vn(this,n,t))}),t)),t.f=e}(t.b,t.a)):(n||(e=on(e,hn)),t.b=new fn(e,t.a))}function en(t,e,n){t.b.set(e,n)}function nn(t){return en(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^R()).toString(36)),t}function rn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function on(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,sn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function sn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ye.prototype.toString=function(){var t=[],e=this.f;e&&t.push(on(e,an,!0),":");var n=this.c;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(on(e,an,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(on(n,"/"==n.charAt(0)?cn:un,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",on(n,ln)),t.join("")};var an=/[#\/\?@]/g,un=/[#\?:]/g,cn=/[#\?]/g,hn=/[#\?@]/g,ln=/#/g;function fn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function dn(t){t.a||(t.a=new ze,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function pn(t,e){dn(t),e=gn(t,e),He(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,He((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Qe(t)))}function yn(t,e){return dn(t),e=gn(t,e),He(t.a.b,e)}function vn(t,e,n){pn(t,e),0<n.length&&(t.c=null,t.a.set(gn(t,e),V(n)),t.b+=n.length)}function gn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(w=fn.prototype).add=function(t,e){dn(this),this.c=null,t=gn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},w.forEach=function(t,e){dn(this),this.a.forEach((function(n,r){M(n,(function(n){t.call(e,n,r,this)}),this)}),this)},w.L=function(){dn(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},w.K=function(t){dn(this);var e=[];if("string"==typeof t)yn(this,t)&&(e=F(e,this.a.get(gn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=F(e,t[n])}return e},w.set=function(t,e){return dn(this),this.c=null,yn(this,t=gn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},w.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},w.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.K(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")};var mn=function(t,e){this.b=t,this.a=e};function wn(t){this.g=t||bn,T.PerformanceNavigationTiming?t=0<(t=T.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(T.ia&&T.ia.ya&&T.ia.ya()&&T.ia.ya().Lb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var bn=10;function In(t){return!!t.b||!!t.a&&t.a.size>=t.f}function Tn(t){return t.b?1:t.a?t.a.size:0}function En(t,e){return t.b?t.b==e:!!t.a&&t.a.has(e)}function _n(t,e){t.a?t.a.add(e):t.b=e}function Sn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function Dn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null!=t.a&&0!==t.a.size){var r=t.c;try{for(var i=m(t.a.values()),o=i.next();!o.done;o=i.next()){var s=o.value;r=r.concat(s.s)}}catch(a){e={error:a}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return V(t.c)}function Nn(){}function An(){this.a=new Nn}function kn(t,e,n){var r=n||"";try{Ge(t,(function(t,n){var i=t;S(t)&&(i=Kt(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(Ed){throw e.push(r+"type="+encodeURIComponent("_badmap")),Ed}}function Cn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}wn.prototype.cancel=function(){var t,e;if(this.c=Dn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=m(this.a.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(i){t={error:i}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},Nn.prototype.stringify=function(t){return T.JSON.stringify(t,void 0)},Nn.prototype.parse=function(t){return T.JSON.parse(t,void 0)};var xn=T.JSON.parse;function Rn(t){qt.call(this),this.headers=new ze,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=On,this.D=this.F=!1}O(Rn,qt);var On="",Pn=/^https?$/i,Ln=["POST","PUT"];function Mn(t){return"content-type"==t.toLowerCase()}function Fn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Vn(t),qn(t)}function Vn(t){t.u||(t.u=!0,Bt(t,"complete"),Bt(t,"error"))}function Un(t){if(t.b&&void 0!==I&&(!t.s[1]||4!=jn(t)||2!=t.W()))if(t.l&&4==jn(t))ne(t.za,0,t);else if(Bt(t,"readystatechange"),4==jn(t)){t.b=!1;try{var e,n=t.W();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.B).match(We)[1]||null;if(!o&&T.self&&T.self.location){var s=T.self.location.protocol;o=s.substr(0,s.length-1)}i=!Pn.test(o?o.toLowerCase():"")}e=i}if(e)Bt(t,"complete"),Bt(t,"success");else{t.h=6;try{var a=2<jn(t)?t.a.statusText:""}catch(u){a=""}t.f=a+" ["+t.W()+"]",Vn(t)}}finally{qn(t)}}}function qn(t,e){if(t.a){Bn(t);var n=t.a,r=t.s[0]?E:null;t.a=null,t.s=null,e||Bt(t,"ready");try{n.onreadystatechange=r}catch(Ed){}}}function Bn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(T.clearTimeout(t.m),t.m=null)}function jn(t){return t.a?t.a.readyState:0}function Kn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return Q(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):en(t,e,n))}function Gn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function zn(t){this.pa=0,this.g=[],this.c=new ce,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Oa=this.R=0,this.La=Gn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Ha=Gn("baseRetryDelayMs",5e3,t),this.Ra=Gn("retryDelaySeedMs",1e4,t),this.Ma=Gn("forwardChannelMaxRetries",2,t),this.ma=Gn("forwardChannelRequestTimeoutMs",2e4,t),this.Na=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new wn(t&&t.concurrentRequestLimit),this.ka=new An,this.da=t&&t.fastHandshake||!1,this.Ia=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&t&&t.detectBufferingProxy||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ka=t&&t.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function Qn(t){if(Wn(t),3==t.v){var e=t.R++,n=Xe(t.B);en(n,"SID",t.J),en(n,"RID",e),en(n,"TYPE","terminate"),$n(t,n),(e=new Ce(t,t.c,e,void 0)).H=2,e.i=nn(Xe(n)),n=!1,T.navigator&&T.navigator.sendBeacon&&(n=T.navigator.sendBeacon(e.i.toString(),"")),!n&&T.Image&&((new Image).src=e.i,n=!0),n||(e.a=hr(e.g,null),e.a.ba(e.i)),e.u=R(),Ve(e)}ur(t)}function Hn(t){t.a&&(nr(t),t.a.cancel(),t.a=null)}function Wn(t){Hn(t),t.j&&(T.clearTimeout(t.j),t.j=null),ir(t),t.b.cancel(),t.h&&("number"==typeof t.h&&T.clearTimeout(t.h),t.h=null)}function Yn(t,e){t.g.push(new mn(t.Oa++,e)),3==t.v&&Xn(t)}function Xn(t){In(t.b)||t.h||(t.h=!0,Xt(t.Ba,t),t.u=0)}function Jn(t,e){var n;n=e?e.f:t.R++;var r=Xe(t.B);en(r,"SID",t.J),en(r,"RID",n),en(r,"AID",t.P),$n(t,r),t.i&&t.l&&Kn(r,t.i,t.l),n=new Ce(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=Zn(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),_n(t.b,n),Pe(n,r,e)}function $n(t,e){t.f&&Ge({},(function(t,n){en(e,n,t)}))}function Zn(t,e,n){n=Math.min(t.g.length,n);var r=t.f?C(t.f.Ja,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if(0>(c-=o))o=Math.max(0,i[u].b-100),a=!1;else try{kn(h,s,"req"+c+"_")}catch(l){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function tr(t){t.a||t.j||(t.T=1,Xt(t.Aa,t),t.o=0)}function er(t){return!(t.a||t.j||3<=t.o)&&(t.T++,t.j=we(C(t.Aa,t),sr(t,t.o)),t.o++,!0)}function nr(t){null!=t.s&&(T.clearTimeout(t.s),t.s=null)}function rr(t){t.a=new Ce(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=Xe(t.la);en(e,"RID","rpc"),en(e,"SID",t.J),en(e,"CI",t.H?"0":"1"),en(e,"AID",t.P),$n(t,e),en(e,"TYPE","xmlhttp"),t.i&&t.l&&Kn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=nn(Xe(e)),n.j=null,n.I=!0,Le(n,t)}function ir(t){null!=t.m&&(T.clearTimeout(t.m),t.m=null)}function or(t,e){var n=null;if(t.a==e){ir(t),nr(t),t.a=null;var r=2}else{if(!En(t.b,e))return;n=e.s,Sn(t.b,e),r=1}if(t.I=e.N,0!=t.v)if(e.b)if(1==r){n=e.j?e.j.length:0,e=R()-e.u;var i=t.u;Bt(r=de(),new me(r,n,e,i)),Xn(t)}else tr(t);else if(3==(i=e.h)||0==i&&0<t.I||!(1==r&&function(t,e){return!(Tn(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.g=e.s.concat(t.g),0):1==t.v||2==t.v||t.u>=(t.La?0:t.Ma)||(t.h=we(C(t.Ba,t,e),sr(t,t.u)),t.u++,0)))}(t,e)||2==r&&er(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:ar(t,5);break;case 4:ar(t,10);break;case 3:ar(t,6);break;default:ar(t,2)}}function sr(t,e){var n=t.Ha+Math.floor(Math.random()*t.Ra);return t.f||(n*=2),n*e}function ar(t,e){if(t.c.info("Error code "+e),2==e){var n=null;t.f&&(n=null);var r=C(t.Ya,t);n||(n=new Ye("//www.google.com/images/cleardot.gif"),T.location&&"http"==T.location.protocol||Je(n,"https"),nn(n)),function(t,e){var n=new ce;if(T.Image){var r=new Image;r.onload=x(Cn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=x(Cn,n,r,"TestLoadImage: error",!1,e),r.onabort=x(Cn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=x(Cn,n,r,"TestLoadImage: timeout",!1,e),T.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else ge(2);t.v=0,t.f&&t.f.ra(e),ur(t),Wn(t)}function ur(t){t.v=0,t.I=-1,t.f&&(0==Dn(t.b).length&&0==t.g.length||(t.b.c.length=0,V(t.g),t.g.length=0),t.f.qa())}function cr(t,e,n){var r=function(t){return t instanceof Ye?Xe(t):new Ye(t,void 0)}(n);if(""!=r.c)e&&$e(r,e+"."+r.c),Ze(r,r.h);else{var i=T.location;r=function(t,e,n,r){var i=new Ye(null,void 0);return t&&Je(i,t),e&&$e(i,e),n&&Ze(i,n),r&&(i.g=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.V&&Q(t.V,(function(t,e){en(r,e,t)})),e=t.A,n=t.na,e&&n&&en(r,e,n),en(r,"VER",t.ha),$n(t,r),r}function hr(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Rn(t.Na)).F=t.C,e}function lr(){}function fr(){if(tt&&!(10<=Number(dt)))throw Error("Environmental error: no available transport.")}function dr(t,e){qt.call(this),this.a=new zn(e),this.o=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!U(t)&&(this.a.i=t),this.m=e&&e.supportsCrossDomainXhr||!1,this.l=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!U(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new vr(this)}function pr(t){Ne.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function yr(){Ae.call(this),this.status=1}function vr(t){this.a=t}(w=Rn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?Ee(this.H):Ee(Se),this.a.onreadystatechange=C(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(o){return void Fn(this,o)}t=n||"";var i=new ze(this.headers);r&&Ge(r,(function(t,e){i.set(e,t)})),r=function(t){t:{for(var e=Mn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.L()),n=T.FormData&&t instanceof T.FormData,!(0<=L(Ln,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(t,e){this.a.setRequestHeader(e,t)}),this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Bn(this),0<this.o&&((this.D=function(t){return tt&&lt(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=C(this.xa,this)):this.m=ne(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(o){Fn(this,o)}},w.xa=function(){void 0!==I&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,Bt(this,"timeout"),this.abort(8))},w.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,Bt(this,"complete"),Bt(this,"abort"),qn(this))},w.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),qn(this,!0)),Rn.X.G.call(this)},w.za=function(){this.j||(this.A||this.l||this.g?Un(this):this.Ua())},w.Ua=function(){Un(this)},w.W=function(){try{return 2<jn(this)?this.a.status:-1}catch($){return-1}},w.$=function(){try{return this.a?this.a.responseText:""}catch($){return""}},w.Pa=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),xn(e)}},w.ua=function(){return this.h},w.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(w=zn.prototype).ha=8,w.v=1,w.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new Ce(this,this.c,t,void 0),r=this.l;if(this.O&&(r?Y(r=H(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if(void 0===(o="__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Zn(this,n,e),en(i=Xe(this.B),"RID",t),en(i,"CVER",22),this.A&&en(i,"X-HTTP-Session-Id",this.A),$n(this,i),this.i&&r&&Kn(i,this.i,r),_n(this.b,n),this.Ia&&en(i,"TYPE","init"),this.da?(en(i,"$req",e),en(i,"SID","null"),n.U=!0,Pe(n,i,null)):Pe(n,i,e),this.v=2}}else 3==this.v&&(t?Jn(this,t):0==this.g.length||In(this.b)||Jn(this))},w.Aa=function(){if(this.j=null,rr(this),this.U&&!(this.F||null==this.a||0>=this.N)){var t=2*this.N;this.c.info("BP detection timer enabled: "+t),this.s=we(C(this.Ta,this),t)}},w.Ta=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,ge(10),Hn(this),rr(this))},w.Sa=function(){null!=this.m&&(this.m=null,Hn(this),er(this),ge(19))},w.Ya=function(t){t?(this.c.info("Successfully pinged google.com"),ge(2)):(this.c.info("Failed to ping google.com"),ge(1))},(w=lr.prototype).ta=function(){},w.sa=function(){},w.ra=function(){},w.qa=function(){},w.Ja=function(){},fr.prototype.a=function(t,e){return new dr(t,e)},O(dr,qt),dr.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var t=this.a,e=this.o,n=this.b||void 0;ge(0),t.fa=e,t.V=n||{},t.H=t.S,t.B=cr(t,null,t.fa),Xn(t)},dr.prototype.close=function(){Qn(this.a)},dr.prototype.h=function(t){if("string"==typeof t){var e={};e.__data__=t,Yn(this.a,e)}else this.l?((e={}).__data__=Kt(t),Yn(this.a,e)):Yn(this.a,t)},dr.prototype.G=function(){this.a.f=null,delete this.f,Qn(this.a),delete this.a,dr.X.G.call(this)},O(pr,Ne),O(yr,Ae),O(vr,lr),vr.prototype.ta=function(){Bt(this.a,"a")},vr.prototype.sa=function(t){Bt(this.a,new pr(t))},vr.prototype.ra=function(t){Bt(this.a,new yr(t))},vr.prototype.qa=function(){Bt(this.a,"b")},fr.prototype.createWebChannel=fr.prototype.a,dr.prototype.send=dr.prototype.h,dr.prototype.open=dr.prototype.g,dr.prototype.close=dr.prototype.close,be.NO_ERROR=0,be.TIMEOUT=8,be.HTTP_ERROR=6,Ie.COMPLETE="complete",_e.EventType=De,De.OPEN="a",De.CLOSE="b",De.ERROR="c",De.MESSAGE="d",qt.prototype.listen=qt.prototype.va,Rn.prototype.listenOnce=Rn.prototype.wa,Rn.prototype.getLastError=Rn.prototype.Qa,Rn.prototype.getLastErrorCode=Rn.prototype.ua,Rn.prototype.getStatus=Rn.prototype.W,Rn.prototype.getResponseJson=Rn.prototype.Pa,Rn.prototype.getResponseText=Rn.prototype.$,Rn.prototype.send=Rn.prototype.ba;var gr=be,mr=Ie,wr=le,br=10,Ir=11,Tr=_e,Er=Rn,_r=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();_r.o=-1;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Sr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Dr=function(e){function n(t,n){var r=this;return(r=e.call(this,n)||this).code=t,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return t(n,e),n}(Error),Nr=new p("@firebase/firestore");function Ar(){return Nr.logLevel}function kr(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(Nr.logLevel<=d.DEBUG){var i=n.map(Rr);Nr.debug.apply(Nr,e(["Firestore (8.5.0): "+t],i))}}function Cr(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(Nr.logLevel<=d.ERROR){var i=n.map(Rr);Nr.error.apply(Nr,e(["Firestore (8.5.0): "+t],i))}}function xr(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(Nr.logLevel<=d.WARN){var i=n.map(Rr);Nr.warn.apply(Nr,e(["Firestore (8.5.0): "+t],i))}}function Rr(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(n){return t}var e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Or(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.5.0) INTERNAL ASSERTION FAILED: "+t;throw Cr(e),new Error(e)}function Pr(t,e){t||Or()}function Lr(t,e){return t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mr(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Fr=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=Mr(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function Vr(t,e){return t<e?-1:t>e?1:0}function Ur(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function qr(t){return t+"\0"}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Br=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Dr(Sr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Dr(Sr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Dr(Sr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Dr(Sr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?Vr(this.nanoseconds,t.nanoseconds):Vr(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),jr=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new Br(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kr(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Gr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function zr(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Qr=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&Or(),void 0===n?n=t.length-e:n>t.length-e&&Or(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),Hr=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.construct=function(t,e,r){return new n(t,e,r)},n.prototype.canonicalString=function(){return this.toArray().join("/")},n.prototype.toString=function(){return this.canonicalString()},n.fromString=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter((function(t){return t.length>0})))}return new n(r)},n.emptyPath=function(){return new n([])},n}(Qr),Wr=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Yr=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.construct=function(t,e,r){return new n(t,e,r)},n.isValidIdentifier=function(t){return Wr.test(t)},n.prototype.canonicalString=function(){return this.toArray().map((function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(t)||(t="`"+t+"`"),t})).join(".")},n.prototype.toString=function(){return this.canonicalString()},n.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},n.keyField=function(){return new n(["__name__"])},n.fromServerFormat=function(t){for(var e=[],r="",i=0,o=function(){if(0===r.length)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new Dr(Sr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Dr(Sr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new Dr(Sr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new n(e)},n.emptyPath=function(){return new n([])},n}(Qr),Xr=function(){function t(t){this.fields=t,t.sort(Yr.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return Ur(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},t}(),Jr=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return t=this.binaryString,btoa(t);var t},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return Vr(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();Jr.EMPTY_BYTE_STRING=new Jr("");var $r=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Zr(t){if(Pr(!!t),"string"==typeof t){var e=0,n=$r.exec(t);if(Pr(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:ti(t.seconds),nanos:ti(t.nanos)}}function ti(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function ei(t){return"string"==typeof t?Jr.fromBase64String(t):Jr.fromUint8Array(t)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ni(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ri(t){var e=t.mapValue.fields.__previous_value__;return ni(e)?ri(e):e}function ii(t){var e=Zr(t.mapValue.fields.__local_write_time__.timestampValue);return new Br(e.seconds,e.nanos)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oi(t){return null==t}function si(t){return 0===t&&1/t==-1/0}function ai(t){return"number"==typeof t&&Number.isInteger(t)&&!si(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ui=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(Hr.fromString(e))},t.fromName=function(e){return new t(Hr.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===Hr.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return Hr.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new Hr(e.slice()))},t}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ci(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?ni(t)?4:10:Or()}function hi(t,e){var n,r=ci(t);if(r!==ci(e))return!1;switch(r){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return ii(t).isEqual(ii(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=Zr(t.timestampValue),r=Zr(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return n=e,ei(t.bytesValue).isEqual(ei(n.bytesValue));case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return ti(t.geoPointValue.latitude)===ti(e.geoPointValue.latitude)&&ti(t.geoPointValue.longitude)===ti(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return ti(t.integerValue)===ti(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=ti(t.doubleValue),r=ti(e.doubleValue);return n===r?si(n)===si(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Ur(t.arrayValue.values||[],e.arrayValue.values||[],hi);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Kr(n)!==Kr(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!hi(n[i],r[i])))return!1;return!0}(t,e);default:return Or()}}function li(t,e){return void 0!==(t.values||[]).find((function(t){return hi(t,e)}))}function fi(t,e){var n,r,i,o,s=ci(t),a=ci(e);if(s!==a)return Vr(s,a);switch(s){case 0:return 0;case 1:return Vr(t.booleanValue,e.booleanValue);case 2:return r=e,i=ti((n=t).integerValue||n.doubleValue),o=ti(r.integerValue||r.doubleValue),i<o?-1:i>o?1:i===o?0:isNaN(i)?isNaN(o)?0:-1:1;case 3:return di(t.timestampValue,e.timestampValue);case 4:return di(ii(t),ii(e));case 5:return Vr(t.stringValue,e.stringValue);case 6:return function(t,e){var n=ei(t),r=ei(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Vr(n[i],r[i]);if(0!==o)return o}return Vr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=Vr(ti(t.latitude),ti(e.latitude));return 0!==n?n:Vr(ti(t.longitude),ti(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=fi(n[i],r[i]);if(o)return o}return Vr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=Vr(r[s],o[s]);if(0!==a)return a;var u=fi(n[r[s]],i[o[s]]);if(0!==u)return u}return Vr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Or()}}function di(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Vr(t,e);var n=Zr(t),r=Zr(e),i=Vr(n.seconds,r.seconds);return 0!==i?i:Vr(n.nanos,r.nanos)}function pi(t){return yi(t)}function yi(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?(e=t.timestampValue,"time("+(n=Zr(e)).seconds+","+n.nanos+")"):"stringValue"in t?t.stringValue:"bytesValue"in t?ei(t.bytesValue).toBase64():"referenceValue"in t?(i=t.referenceValue,ui.fromName(i).toString()):"geoPointValue"in t?"geo("+(r=t.geoPointValue).latitude+","+r.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=yi(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+yi(t.fields[o])}return e+"}"}(t.mapValue):Or();var e,n,r,i}function vi(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function gi(t){return!!t&&"integerValue"in t}function mi(t){return!!t&&"arrayValue"in t}function wi(t){return!!t&&"nullValue"in t}function bi(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ii(t){return!!t&&"mapValue"in t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ti=function(){function t(t){this.overlayMap=new Map,this.partialValue=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(e){return t.extractNestedValue(this.buildProto(),e)},t.prototype.toProto=function(){return this.field(Yr.emptyPath())},t.prototype.set=function(t,e){this.setOverlay(t,e)},t.prototype.setAll=function(t){var e=this;t.forEach((function(t,n){t?e.set(n,t):e.delete(n)}))},t.prototype.delete=function(t){this.setOverlay(t,null)},t.prototype.isEqual=function(t){return hi(this.buildProto(),t.buildProto())},t.prototype.setOverlay=function(t,e){for(var n=this.overlayMap,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map?n=o:o&&10===ci(o)?(o=new Map(Object.entries(o.mapValue.fields||{})),n.set(i,o),n=o):(o=new Map,n.set(i,o),n=o)}n.set(t.lastSegment(),e)},t.prototype.applyOverlay=function(e,n){var r=this,i=!1,o=t.extractNestedValue(this.partialValue,e),s=Ii(o)?Object.assign({},o.mapValue.fields):{};return n.forEach((function(t,n){if(t instanceof Map){var o=r.applyOverlay(e.child(n),t);null!=o&&(s[n]=o,i=!0)}else null!==t?(s[n]=t,i=!0):s.hasOwnProperty(n)&&(delete s[n],i=!0)})),i?{mapValue:{fields:s}}:null},t.prototype.buildProto=function(){var t=this.applyOverlay(Yr.emptyPath(),this.overlayMap);return null!=t&&(this.partialValue=t,this.overlayMap.clear()),this.partialValue},t.extractNestedValue=function(t,e){if(e.isEmpty())return t;for(var n=t,r=0;r<e.length-1;++r){if(!n.mapValue.fields)return null;if(!Ii(n=n.mapValue.fields[e.get(r)]))return null}return(n=(n.mapValue.fields||{})[e.lastSegment()])||null},t.prototype.clone=function(){return new t(this.buildProto())},t}();function Ei(t){var e=[];return Gr(t.fields||{},(function(t,n){var r=new Yr([t]);if(Ii(n)){var i=Ei(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++){var a=s[o];e.push(r.child(a))}}else e.push(r)})),new Xr(e)}var _i=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,jr.min(),Ti.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,Ti.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,Ti.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=Ti.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=Ti.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.toProto())+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),Si=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Di(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new Si(t,e,n,r,i,o,s)}function Ni(t){var e=Lr(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((function(t){return(e=t).field.canonicalString()+e.op.toString()+pi(e.value);var e})).join(","),n+="|ob:",n+=e.orderBy.map((function(t){return(e=t).field.canonicalString()+e.dir;var e})).join(","),oi(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=qi(e.startAt)),e.endAt&&(n+="|ub:",n+=qi(e.endAt)),e.h=n}return e.h}function Ai(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!ji(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if(i=t.filters[r],o=e.filters[r],i.op!==o.op||!i.field.isEqual(o.field)||!hi(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Gi(t.startAt,e.startAt)&&Gi(t.endAt,e.endAt)}function ki(t){return ui.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var Ci=function(e){function n(t,n,r){var i=this;return(i=e.call(this)||this).field=t,i.op=n,i.value=r,i}return t(n,e),n.create=function(t,e,r){return t.isKeyField()?"in"===e||"not-in"===e?this.l(t,e,r):new xi(t,e,r):"array-contains"===e?new Li(t,r):"in"===e?new Mi(t,r):"not-in"===e?new Fi(t,r):"array-contains-any"===e?new Vi(t,r):new n(t,e,r)},n.l=function(t,e,n){return"in"===e?new Ri(t,n):new Oi(t,n)},n.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(fi(e,this.value)):null!==e&&ci(this.value)===ci(e)&&this.m(fi(e,this.value))},n.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Or()}},n.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},n}((function(){})),xi=function(e){function n(t,n,r){var i=this;return(i=e.call(this,t,n,r)||this).key=ui.fromName(r.referenceValue),i}return t(n,e),n.prototype.matches=function(t){var e=ui.comparator(t.key,this.key);return this.m(e)},n}(Ci),Ri=function(e){function n(t,n){var r=this;return(r=e.call(this,t,"in",n)||this).keys=Pi("in",n),r}return t(n,e),n.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},n}(Ci),Oi=function(e){function n(t,n){var r=this;return(r=e.call(this,t,"not-in",n)||this).keys=Pi("not-in",n),r}return t(n,e),n.prototype.matches=function(t){return!this.keys.some((function(e){return e.isEqual(t.key)}))},n}(Ci);function Pi(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(t){return ui.fromName(t.referenceValue)}))}var Li=function(e){function n(t,n){return e.call(this,t,"array-contains",n)||this}return t(n,e),n.prototype.matches=function(t){var e=t.data.field(this.field);return mi(e)&&li(e.arrayValue,this.value)},n}(Ci),Mi=function(e){function n(t,n){return e.call(this,t,"in",n)||this}return t(n,e),n.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&li(this.value.arrayValue,e)},n}(Ci),Fi=function(e){function n(t,n){return e.call(this,t,"not-in",n)||this}return t(n,e),n.prototype.matches=function(t){if(li(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!li(this.value.arrayValue,e)},n}(Ci),Vi=function(e){function n(t,n){return e.call(this,t,"array-contains-any",n)||this}return t(n,e),n.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!mi(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return li(e.value.arrayValue,t)}))},n}(Ci),Ui=function(t,e){this.position=t,this.before=e};function qi(t){return(t.before?"b":"a")+":"+t.position.map((function(t){return pi(t)})).join(",")}var Bi=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function ji(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Ki(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?ui.comparator(ui.fromName(s.referenceValue),n.key):fi(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Gi(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!hi(t.position[n],e.position[n]))return!1;return!0}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var zi=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null,this.startAt,this.endAt};function Qi(t,e,n,r,i,o,s,a){return new zi(t,e,n,r,i,o,s,a)}function Hi(t){return new zi(t)}function Wi(t){return!oi(t.limit)&&"F"===t.limitType}function Yi(t){return!oi(t.limit)&&"L"===t.limitType}function Xi(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function Ji(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function $i(t){return null!==t.collectionGroup}function Zi(t){var e=Lr(t);if(null===e.p){e.p=[];var n=Ji(e),r=Xi(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new Bi(n)),e.p.push(new Bi(Yr.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new Bi(Yr.keyField(),u))}}}return e.p}function to(t){var e=Lr(t);if(!e.T)if("F"===e.limitType)e.T=Di(e.path,e.collectionGroup,Zi(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Zi(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new Bi(o.field,s))}var a=e.endAt?new Ui(e.endAt.position,!e.endAt.before):null,u=e.startAt?new Ui(e.startAt.position,!e.startAt.before):null;e.T=Di(e.path,e.collectionGroup,n,e.filters,e.limit,a,u)}return e.T}function eo(t,e,n){return new zi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function no(t,e){return Ai(to(t),to(e))&&t.limitType===e.limitType}function ro(t){return Ni(to(t))+"|lt:"+t.limitType}function io(t){return"Query(target="+(e=to(t),n=e.path.canonicalString(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=", filters: ["+e.filters.map((function(t){return(e=t).field.canonicalString()+" "+e.op+" "+pi(e.value);var e})).join(", ")+"]"),oi(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=", orderBy: ["+e.orderBy.map((function(t){return(e=t).field.canonicalString()+" ("+e.dir+")";var e})).join(", ")+"]"),e.startAt&&(n+=", startAt: "+qi(e.startAt)),e.endAt&&(n+=", endAt: "+qi(e.endAt)),"Target("+n+"); limitType=")+t.limitType+")";var e,n}function oo(t,e){return e.isFoundDocument()&&(n=t,i=(r=e).key.path,null!==n.collectionGroup?r.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):ui.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i))&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Ki(t.startAt,Zi(t),e)||t.endAt&&Ki(t.endAt,Zi(t),e))}(t,e);var n,r,i}function so(t){return function(e,n){for(var r=!1,i=0,o=Zi(t);i<o.length;i++){var s=o[i],a=ao(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function ao(t,e,n){var r,i,o,s,a=t.field.isKeyField()?ui.comparator(e.key,n.key):(r=t.field,i=n,o=e.data.field(r),s=i.data.field(r),null!==o&&null!==s?fi(o,s):Or());switch(t.dir){case"asc":return a;case"desc":return-1*a;default:return Or()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uo(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:si(e)?"-0":e}}function co(t){return{integerValue:""+t}}function ho(t,e){return ai(e)?co(e):uo(t,e)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var lo=function(){this._=void 0};function fo(t,e,n){return t instanceof vo?(i=e,o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:(r=n).seconds,nanos:r.nanoseconds}}}},i&&(o.fields.__previous_value__=i),{mapValue:o}):t instanceof go?mo(t,e):t instanceof wo?bo(t,e):function(t,e){var n=yo(t,e),r=To(n)+To(t.A);return gi(n)&&gi(t.A)?co(r):uo(t.R,r)}(t,e);var r,i,o}function po(t,e,n){return t instanceof go?mo(t,e):t instanceof wo?bo(t,e):n}function yo(t,e){return t instanceof Io?gi(r=e)||(n=r)&&"doubleValue"in n?e:{integerValue:0}:null;var n,r}var vo=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n}(lo),go=function(e){function n(t){var n=this;return(n=e.call(this)||this).elements=t,n}return t(n,e),n}(lo);function mo(t,e){for(var n=Eo(e),r=function(t){n.some((function(e){return hi(e,t)}))||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var wo=function(e){function n(t){var n=this;return(n=e.call(this)||this).elements=t,n}return t(n,e),n}(lo);function bo(t,e){for(var n=Eo(e),r=function(t){n=n.filter((function(e){return!hi(e,t)}))},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Io=function(e){function n(t,n){var r=this;return(r=e.call(this)||this).R=t,r.A=n,r}return t(n,e),n}(lo);function To(t){return ti(t.integerValue||t.doubleValue)}function Eo(t){return mi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var _o=function(t,e){this.field=t,this.transform=e},So=function(t,e){this.version=t,this.transformResults=e},Do=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function No(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var Ao=function(){};function ko(t,e,n){var r,i,o,s,a;t instanceof Po?(i=e,o=n,s=(r=t).value.clone(),a=Fo(r.fieldTransforms,i,o.transformResults),s.setAll(a),i.convertToFoundDocument(o.version,s).setHasCommittedMutations()):t instanceof Lo?function(t,e,n){if(No(t.precondition,e)){var r=Fo(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(Mo(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Co(t,e,n){var r;t instanceof Po?function(t,e,n){if(No(t.precondition,e)){var r=t.value.clone(),i=Vo(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(Oo(e),r).setHasLocalMutations()}}(t,e,n):t instanceof Lo?function(t,e,n){if(No(t.precondition,e)){var r=Vo(t.fieldTransforms,n,e),i=e.data;i.setAll(Mo(t)),i.setAll(r),e.convertToFoundDocument(Oo(e),i).setHasLocalMutations()}}(t,e,n):(r=e,No(t.precondition,r)&&r.convertToNoDocument(jr.min()))}function xo(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=yo(o.transform,s||null);null!=a&&(null==n&&(n=Ti.empty()),n.set(o.field,a))}return n||null}function Ro(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&(n=t.fieldTransforms,r=e.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&Ur(n,r,(function(t,e){return r=e,(n=t).field.isEqual(r.field)&&(i=n.transform,o=r.transform,i instanceof go&&o instanceof go||i instanceof wo&&o instanceof wo?Ur(i.elements,o.elements,hi):i instanceof Io&&o instanceof Io?hi(i.A,o.A):i instanceof vo&&o instanceof vo);var n,r,i,o}))))&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask));var n,r}function Oo(t){return t.isFoundDocument()?t.version:jr.min()}var Po=function(e){function n(t,n,r,i){void 0===i&&(i=[]);var o=this;return(o=e.call(this)||this).key=t,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return t(n,e),n}(Ao),Lo=function(e){function n(t,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=e.call(this)||this).key=t,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return t(n,e),n}(Ao);function Mo(t){var e=new Map;return t.fieldMask.fields.forEach((function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}})),e}function Fo(t,e,n){var r=new Map;Pr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,po(s,a,n[i]))}return r}function Vo(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,fo(a,u,e))}return r}var Uo,qo,Bo=function(e){function n(t,n){var r=this;return(r=e.call(this)||this).key=t,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return t(n,e),n}(Ao),jo=function(e){function n(t,n){var r=this;return(r=e.call(this)||this).key=t,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return t(n,e),n}(Ao),Ko=function(t){this.count=t};function Go(t){switch(t){case Sr.OK:return Or();case Sr.CANCELLED:case Sr.UNKNOWN:case Sr.DEADLINE_EXCEEDED:case Sr.RESOURCE_EXHAUSTED:case Sr.INTERNAL:case Sr.UNAVAILABLE:case Sr.UNAUTHENTICATED:return!1;case Sr.INVALID_ARGUMENT:case Sr.NOT_FOUND:case Sr.ALREADY_EXISTS:case Sr.PERMISSION_DENIED:case Sr.FAILED_PRECONDITION:case Sr.ABORTED:case Sr.OUT_OF_RANGE:case Sr.UNIMPLEMENTED:case Sr.DATA_LOSS:return!0;default:return Or()}}function zo(t){if(void 0===t)return Cr("GRPC error has no .code"),Sr.UNKNOWN;switch(t){case Uo.OK:return Sr.OK;case Uo.CANCELLED:return Sr.CANCELLED;case Uo.UNKNOWN:return Sr.UNKNOWN;case Uo.DEADLINE_EXCEEDED:return Sr.DEADLINE_EXCEEDED;case Uo.RESOURCE_EXHAUSTED:return Sr.RESOURCE_EXHAUSTED;case Uo.INTERNAL:return Sr.INTERNAL;case Uo.UNAVAILABLE:return Sr.UNAVAILABLE;case Uo.UNAUTHENTICATED:return Sr.UNAUTHENTICATED;case Uo.INVALID_ARGUMENT:return Sr.INVALID_ARGUMENT;case Uo.NOT_FOUND:return Sr.NOT_FOUND;case Uo.ALREADY_EXISTS:return Sr.ALREADY_EXISTS;case Uo.PERMISSION_DENIED:return Sr.PERMISSION_DENIED;case Uo.FAILED_PRECONDITION:return Sr.FAILED_PRECONDITION;case Uo.ABORTED:return Sr.ABORTED;case Uo.OUT_OF_RANGE:return Sr.OUT_OF_RANGE;case Uo.UNIMPLEMENTED:return Sr.UNIMPLEMENTED;case Uo.DATA_LOSS:return Sr.DATA_LOSS;default:return Or()}}(qo=Uo||(Uo={}))[qo.OK=0]="OK",qo[qo.CANCELLED=1]="CANCELLED",qo[qo.UNKNOWN=2]="UNKNOWN",qo[qo.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",qo[qo.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",qo[qo.NOT_FOUND=5]="NOT_FOUND",qo[qo.ALREADY_EXISTS=6]="ALREADY_EXISTS",qo[qo.PERMISSION_DENIED=7]="PERMISSION_DENIED",qo[qo.UNAUTHENTICATED=16]="UNAUTHENTICATED",qo[qo.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",qo[qo.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",qo[qo.ABORTED=10]="ABORTED",qo[qo.OUT_OF_RANGE=11]="OUT_OF_RANGE",qo[qo.UNIMPLEMENTED=12]="UNIMPLEMENTED",qo[qo.INTERNAL=13]="INTERNAL",qo[qo.UNAVAILABLE=14]="UNAVAILABLE",qo[qo.DATA_LOSS=15]="DATA_LOSS";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Qo=function(){function t(t,e){this.comparator=t,this.root=e||Wo.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Wo.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Wo.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.inorderTraversal((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new Ho(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new Ho(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new Ho(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new Ho(this.root,t,this.comparator,!0)},t}(),Ho=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),Wo=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Or();if(this.right.isRed())throw Or();var t=this.left.check();if(t!==this.right.check())throw Or();return t+(this.isRed()?0:1)},t}();Wo.EMPTY=null,Wo.RED=!0,Wo.BLACK=!1,Wo.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw Or()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw Or()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw Or()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw Or()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw Or()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new Wo(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Yo=function(){function t(t){this.comparator=t,this.data=new Qo(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new Xo(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new Xo(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),Xo=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),Jo=new Qo(ui.comparator);function $o(){return Jo}var Zo=new Qo(ui.comparator);function ts(){return Zo}var es=new Qo(ui.comparator);var ns=new Yo(ui.comparator);function rs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=ns,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var is=new Yo(Vr);function os(){return is}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ss=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,as.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(jr.min(),r,os(),$o(),rs())},t}(),as=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(Jr.EMPTY_BYTE_STRING,n,rs(),rs(),rs())},t}(),us=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},cs=function(t,e){this.targetId=t,this.V=e},hs=function(t,e,n,r){void 0===n&&(n=Jr.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},ls=function(){function t(){this.S=0,this.D=ps(),this.C=Jr.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"k",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"O",{get:function(){return this.F},enumerable:!1,configurable:!0}),t.prototype.$=function(t){t.approximateByteSize()>0&&(this.F=!0,this.C=t)},t.prototype.M=function(){var t=rs(),e=rs(),n=rs();return this.D.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Or()}})),new as(this.C,this.N,t,e,n)},t.prototype.L=function(){this.F=!1,this.D=ps()},t.prototype.B=function(t,e){this.F=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.F=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.F=!0,this.N=!0},t}(),fs=function(){function t(t){this.W=t,this.G=new Map,this.H=$o(),this.J=ds(),this.Y=new Yo(Vr)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.tt(r,t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,(function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.$(t.resumeToken);break;case 1:r.K(),r.k||r.L(),r.$(t.resumeToken);break;case 2:r.K(),r.k||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.$(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.$(t.resumeToken));break;default:Or()}}))},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach((function(t,r){n.st(r)&&e(r)}))},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(ki(i))if(0===n){var o=new ui(i.path);this.tt(e,o,_i.newNoDocument(o,jr.min()))}else Pr(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach((function(r,i){var o=e.ot(i);if(o){if(r.current&&ki(o.target)){var s=new ui(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,_i.newNoDocument(s,t))}r.O&&(n.set(i,r.M()),r.L())}}));var r=rs();this.J.forEach((function(t,n){var i=!0;n.forEachWhile((function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new ss(t,n,this.Y,this.H,r);return this.H=$o(),this.J=ds(),this.Y=new Yo(Vr),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new ls,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new Yo(Vr),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||kr("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.k?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new ls),this.W.getRemoteKeysForTarget(t).forEach((function(n){e.tt(t,n,null)}))},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function ds(){return new Qo(ui.comparator)}function ps(){return new Qo(ui.comparator)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ys={asc:"ASCENDING",desc:"DESCENDING"},vs={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},gs=function(t,e){this.databaseId=t,this.I=e};function ms(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function ws(t,e){return t.I?e.toBase64():e.toUint8Array()}function bs(t,e){return ms(t,e.toTimestamp())}function Is(t){return Pr(!!t),jr.fromTimestamp((e=Zr(t),new Br(e.seconds,e.nanos)));var e}function Ts(t,e){return(n=t,new Hr(["projects",n.projectId,"databases",n.database])).child("documents").child(e).canonicalString();var n}function Es(t){var e=Hr.fromString(t);return Pr(Qs(e)),e}function _s(t,e){return Ts(t.databaseId,e.path)}function Ss(t,e){var n=Es(e);if(n.get(1)!==t.databaseId.projectId)throw new Dr(Sr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Dr(Sr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new ui(ks(n))}function Ds(t,e){return Ts(t.databaseId,e)}function Ns(t){var e=Es(t);return 4===e.length?Hr.emptyPath():ks(e)}function As(t){return new Hr(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function ks(t){return Pr(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Cs(t,e,n){return{name:_s(t,e),fields:n.toProto().mapValue.fields}}function xs(t,e){var n,r,i;if(e instanceof Po)n={update:Cs(t,e.key,e.value)};else if(e instanceof Bo)n={delete:_s(t,e.key)};else if(e instanceof Lo)n={update:Cs(t,e.key,e.data),updateMask:zs(e.fieldMask)};else{if(!(e instanceof jo))return Or();n={verify:_s(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((function(t){return function(t,e){var n=e.transform;if(n instanceof vo)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof go)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof wo)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Io)return{fieldPath:e.field.canonicalString(),increment:n.A};throw Or()}(0,t)}))),e.precondition.isNone||(n.currentDocument=(r=t,void 0!==(i=e.precondition).updateTime?{updateTime:bs(r,i.updateTime)}:void 0!==i.exists?{exists:i.exists}:Or())),n}function Rs(t,e){var n,r=e.currentDocument?void 0!==(n=e.currentDocument).updateTime?Do.updateTime(Is(n.updateTime)):void 0!==n.exists?Do.exists(n.exists):Do.none():Do.none(),i=e.updateTransforms?e.updateTransforms.map((function(e){return function(t,e){var n=null;if("setToServerValue"in e)Pr("REQUEST_TIME"===e.setToServerValue),n=new vo;else if("appendMissingElements"in e){var r=e.appendMissingElements.values||[];n=new go(r)}else if("removeAllFromArray"in e){var i=e.removeAllFromArray.values||[];n=new wo(i)}else"increment"in e?n=new Io(t,e.increment):Or();var o=Yr.fromServerFormat(e.fieldPath);return new _o(o,n)}(t,e)})):[];if(e.update){e.update.name;var o=Ss(t,e.update.name),s=new Ti({mapValue:{fields:e.update.fields}});if(e.updateMask){var a=function(t){var e=t.fieldPaths||[];return new Xr(e.map((function(t){return Yr.fromServerFormat(t)})))}(e.updateMask);return new Lo(o,s,a,r,i)}return new Po(o,s,r,i)}if(e.delete){var u=Ss(t,e.delete);return new Bo(u,r)}if(e.verify){var c=Ss(t,e.verify);return new jo(c,r)}return Or()}function Os(t,e){return{documents:[Ds(t,e.path)]}}function Ps(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Ds(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Ds(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map((function(t){return function(t){if("=="===t.op){if(bi(t.value))return{unaryFilter:{field:Bs(t.field),op:"IS_NAN"}};if(wi(t.value))return{unaryFilter:{field:Bs(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(bi(t.value))return{unaryFilter:{field:Bs(t.field),op:"IS_NOT_NAN"}};if(wi(t.value))return{unaryFilter:{field:Bs(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Bs(t.field),op:qs(t.op),value:t.value}}}(t)}));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map((function(t){return{field:Bs((e=t).field),direction:Us(e.dir)};var e}))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s,a,u=(s=t,a=e.limit,s.I||oi(a)?a:{value:a});return null!==u&&(n.structuredQuery.limit=u),e.startAt&&(n.structuredQuery.startAt=Fs(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Fs(e.endAt)),n}function Ls(t){var e=Ns(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){Pr(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=Ms(n.where));var a=[];n.orderBy&&(a=n.orderBy.map((function(t){return new Bi(js((e=t).field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction));var e})));var u,c,h=null;n.limit&&(u=n.limit,h=oi(c="object"==typeof u?u.value:u)?null:c);var l=null;n.startAt&&(l=Vs(n.startAt));var f=null;return n.endAt&&(f=Vs(n.endAt)),Qi(e,i,a,s,h,"F",l,f)}function Ms(t){return t?void 0!==t.unaryFilter?[Gs(t)]:void 0!==t.fieldFilter?[Ks(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((function(t){return Ms(t)})).reduce((function(t,e){return t.concat(e)})):Or():[]}function Fs(t){return{before:t.before,values:t.position}}function Vs(t){var e=!!t.before,n=t.values||[];return new Ui(n,e)}function Us(t){return ys[t]}function qs(t){return vs[t]}function Bs(t){return{fieldPath:t.canonicalString()}}function js(t){return Yr.fromServerFormat(t.fieldPath)}function Ks(t){return Ci.create(js(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Or()}}(t.fieldFilter.op),t.fieldFilter.value)}function Gs(t){switch(t.unaryFilter.op){case"IS_NAN":var e=js(t.unaryFilter.field);return Ci.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=js(t.unaryFilter.field);return Ci.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=js(t.unaryFilter.field);return Ci.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=js(t.unaryFilter.field);return Ci.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Or()}}function zs(t){var e=[];return t.fields.forEach((function(t){return e.push(t.canonicalString())})),{fieldPaths:e}}function Qs(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hs(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=Ys(e)),e=Ws(t.get(n),e);return Ys(e)}function Ws(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function Ys(t){return t+""}function Xs(t){var e=t.length;if(Pr(e>=2),2===e)return Pr(""===t.charAt(0)&&""===t.charAt(1)),Hr.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||s>n)&&Or(),t.charAt(s+1)){case"":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:Or()}o=s+2}return new Hr(r)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Js=function(t,e){this.seconds=t,this.nanoseconds=e},$s=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};$s.store="owner",$s.key="owner";var Zs=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Zs.store="mutationQueues",Zs.keyPath="userId";var ta=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};ta.store="mutations",ta.keyPath="batchId",ta.userMutationsIndex="userMutationsIndex",ta.userMutationsKeyPath=["userId","batchId"];var ea=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,Hs(e)]},t.key=function(t,e,n){return[t,Hs(e),n]},t}();ea.store="documentMutations",ea.PLACEHOLDER=new ea;var na=function(t,e){this.path=t,this.readTime=e},ra=function(t,e){this.path=t,this.version=e},ia=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};ia.store="remoteDocuments",ia.readTimeIndex="readTimeIndex",ia.readTimeIndexPath="readTime",ia.collectionReadTimeIndex="collectionReadTimeIndex",ia.collectionReadTimeIndexPath=["parentPath","readTime"];var oa=function(t){this.byteSize=t};oa.store="remoteDocumentGlobal",oa.key="remoteDocumentGlobalKey";var sa=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};sa.store="targets",sa.keyPath="targetId",sa.queryTargetsIndexName="queryTargetsIndex",sa.queryTargetsKeyPath=["canonicalId","targetId"];var aa=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};aa.store="targetDocuments",aa.keyPath=["targetId","path"],aa.documentTargetsIndex="documentTargetsIndex",aa.documentTargetsKeyPath=["path","targetId"];var ua=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};ua.key="targetGlobalKey",ua.store="targetGlobal";var ca=function(t,e){this.collectionId=t,this.parent=e};ca.store="collectionParents",ca.keyPath=["collectionId","parent"];var ha=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};ha.store="clientMetadata",ha.keyPath="clientId";var la=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};la.store="bundles",la.keyPath="bundleId";var fa=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};fa.store="namedQueries",fa.keyPath="name";var da=e(e([],e(e([],e(e([],e(e([],[Zs.store,ta.store,ea.store,ia.store,sa.store,$s.store,ua.store,aa.store]),[ha.store])),[oa.store])),[ca.store])),[la.store,fa.store]),pa="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ya=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach((function(t){return t()}))},t}(),va=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},ga=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)}),(function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&Or(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t((function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}}))},t.prototype.toPromise=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(r){return t.reject(r)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.waitFor=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t()}),(function(t){return n(t)}))})),o=!0,i===r&&t()}))},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.waitFor(r)},t}(),ma=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new va,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new Ia(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=Da(e.target.error);n.ft.reject(new Ia(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(o){throw new Ia(n,o)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(kr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Ea(e)},t}(),wa=function(){function t(e,n,r){this.name=e,this.version=n,this.wt=r,12.2===t._t(i())&&Cr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return kr("SimpleDb","Removing database:",t),_a(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=i(),n=t._t(e),r=0<n&&n<10,o=t.Et(e),s=0<o&&o<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)},t.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.At=function(t){return n(this,void 0,void 0,(function(){var e,n=this;return r(this,(function(r){switch(r.label){case 0:return this.db?[3,2]:(kr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise((function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){r(new Ia(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;"VersionError"===n.name?r(new Dr(Sr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(new Ia(t,n))},i.onupgradeneeded=function(t){kr("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;n.wt.Rt(e,i.transaction,t.oldVersion,n.version).next((function(){kr("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}))]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}}))}))},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,i,o){return n(this,void 0,void 0,(function(){var n,s,a,u,c;return r(this,(function(h){switch(h.label){case 0:n="readonly"===e,s=0,a=function(){var e,a,c,h,l;return r(this,(function(r){switch(r.label){case 0:++s,r.label=1;case 1:return r.trys.push([1,4,,5]),[4,u.At(t)];case 2:return u.db=r.sent(),e=ma.open(u.db,t,n?"readonly":"readwrite",i),a=o(e).catch((function(t){return e.abort(t),ga.reject(t)})).toPromise(),c={},a.catch((function(){})),[4,e.dt];case 3:return[2,(c.value=(r.sent(),a),c)];case 4:return h=r.sent(),l="FirebaseError"!==h.name&&s<3,kr("SimpleDb","Transaction failed with error:",h.message,"Retrying:",l),u.close(),l?[3,5]:[2,{value:Promise.reject(h)}];case 5:return[2]}}))},u=this,h.label=1;case 1:return[5,a()];case 2:if("object"==typeof(c=h.sent()))return[2,c.value];h.label=3;case 3:return[3,1];case 4:return[2]}}))}))},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),ba=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return _a(this.Pt.delete())},t}(),Ia=function(e){function n(t,n){var r=this;return(r=e.call(this,Sr.UNAVAILABLE,"IndexedDB transaction '"+t+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return t(n,e),n}(Dr);function Ta(t){return"IndexedDbTransactionError"===t.name}var Ea=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(kr("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(kr("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),_a(n)},t.prototype.add=function(t){return kr("SimpleDb","ADD",this.store.name,t,t),_a(this.store.add(t))},t.prototype.get=function(t){var e=this;return _a(this.store.get(t)).next((function(n){return void 0===n&&(n=null),kr("SimpleDb","GET",e.store.name,t,n),n}))},t.prototype.delete=function(t){return kr("SimpleDb","DELETE",this.store.name,t),_a(this.store.delete(t))},t.prototype.count=function(){return kr("SimpleDb","COUNT",this.store.name),_a(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.Ft=function(t,e){kr("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.kt=!1;var r=this.cursor(n);return this.xt(r,(function(t,e,n){return n.delete()}))},t.prototype.Ot=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.$t=function(t){var e=this.cursor({});return new ga((function(n,r){e.onerror=function(t){var e=Da(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.xt=function(t,e){var n=[];return new ga((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new ba(i),s=e(i.primaryKey,i.value,o);if(s instanceof ga){var a=s.catch((function(t){return o.done(),ga.reject(t)}));n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}})).next((function(){return ga.waitFor(n)}))},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.kt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function _a(t){return new ga((function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=Da(t.target.error);n(e)}}))}var Sa=!1;function Da(t){var e=wa._t(i());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new Dr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Sa||(Sa=!0,setTimeout((function(){throw r}),0)),r}}return t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Na=function(e){function n(t,n){var r=this;return(r=e.call(this)||this).Mt=t,r.currentSequenceNumber=n,r}return t(n,e),n}(ya);function Aa(t,e){var n=Lr(t);return wa.It(n.Mt,e)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ka=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&ko(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&Co(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&Co(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach((function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(jr.min())}))},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),rs())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&Ur(this.mutations,t.mutations,(function(t,e){return Ro(t,e)}))&&Ur(this.baseMutations,t.baseMutations,(function(t,e){return Ro(t,e)}))},t}(),Ca=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){Pr(e.mutations.length===r.length);for(var i=es,o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),xa=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=jr.min()),void 0===o&&(o=jr.min()),void 0===s&&(s=Jr.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),Ra=function(t){this.Lt=t};function Oa(t,e){if(e.document)return function(t,e,n){var r=Ss(t,e.name),i=Is(e.updateTime),o=new Ti({mapValue:{fields:e.fields}}),s=_i.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=ui.fromSegments(e.noDocument.path),r=Va(e.noDocument.readTime),i=_i.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=ui.fromSegments(e.unknownDocument.path);return r=Va(e.unknownDocument.version),_i.newUnknownDocument(o,r)}return Or()}function Pa(t,e,n){var r,i,o=La(n),s=e.key.path.popLast().toArray();if(e.isFoundDocument()){var a={name:_s(r=t.Lt,(i=e).key),fields:i.data.toProto().mapValue.fields,updateTime:ms(r,i.version.toTimestamp())},u=e.hasCommittedMutations;return new ia(null,null,a,u,o,s)}if(e.isNoDocument()){var c=e.key.path.toArray(),h=Fa(e.version);return u=e.hasCommittedMutations,new ia(null,new na(c,h),null,u,o,s)}if(e.isUnknownDocument()){var l=e.key.path.toArray(),f=Fa(e.version);return new ia(new ra(l,f),null,null,!0,o,s)}return Or()}function La(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Ma(t){var e=new Br(t[0],t[1]);return jr.fromTimestamp(e)}function Fa(t){var e=t.toTimestamp();return new Js(e.seconds,e.nanoseconds)}function Va(t){var e=new Br(t.seconds,t.nanoseconds);return jr.fromTimestamp(e)}function Ua(t,e){for(var n=(e.baseMutations||[]).map((function(e){return Rs(t.Lt,e)})),r=0;r<e.mutations.length-1;++r){var i=e.mutations[r];if(r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform){var o=e.mutations[r+1];i.updateTransforms=o.transform.fieldTransforms,e.mutations.splice(r+1,1),++r}}var s=e.mutations.map((function(e){return Rs(t.Lt,e)})),a=Br.fromMillis(e.localWriteTimeMs);return new ka(e.batchId,a,n,s)}function qa(t){var e,n,r=Va(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?Va(t.lastLimboFreeSnapshotVersion):jr.min();return void 0!==t.query.documents?(Pr(1===(n=t.query).documents.length),e=to(Hi(Ns(n.documents[0])))):e=to(Ls(t.query)),new xa(e,t.targetId,0,t.lastListenSequenceNumber,r,i,Jr.fromBase64String(t.resumeToken))}function Ba(t,e){var n,r=Fa(e.snapshotVersion),i=Fa(e.lastLimboFreeSnapshotVersion);n=ki(e.target)?Os(t.Lt,e.target):Ps(t.Lt,e.target);var o=e.resumeToken.toBase64();return new sa(e.targetId,Ni(e.target),r,o,e.sequenceNumber,i,n)}function ja(t){var e=Ls({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?eo(e,e.limit,"L"):e}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ka=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return Ga(t).get(e).next((function(t){if(t)return{id:(e=t).bundleId,createTime:Va(e.createTime),version:e.version};var e}))},t.prototype.saveBundleMetadata=function(t,e){return Ga(t).put({bundleId:(n=e).id,createTime:Fa(Is(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return za(t).get(e).next((function(t){if(t)return{name:(e=t).name,query:ja(e.bundledQuery),readTime:Va(e.readTime)};var e}))},t.prototype.saveNamedQuery=function(t,e){return za(t).put({name:(n=e).name,readTime:Fa(Is(n.readTime)),bundledQuery:n.bundledQuery});var n},t}();function Ga(t){return Aa(t,la.store)}function za(t){return Aa(t,fa.store)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Qa=function(){function t(){this.Bt=new Ha}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),ga.resolve()},t.prototype.getCollectionParents=function(t,e){return ga.resolve(this.Bt.getEntries(e))},t}(),Ha=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Yo(Hr.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new Yo(Hr.comparator)).toArray()},t}(),Wa=function(){function t(){this.qt=new Ha}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener((function(){n.qt.add(e)}));var o={collectionId:r,parent:Hs(i)};return Ya(t).put(o)}return ga.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[qr(e),""],!1,!0);return Ya(t).Nt(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Xs(o.parent))}return n}))},t}();function Ya(t){return Aa(t,ca.store)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Xa={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ja=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $a(t,e,n){var r=t.store(ta.store),i=t.store(ea.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.Ot({range:s},(function(t,e,n){return a++,n.delete()}));o.push(u.next((function(){Pr(1===a)})));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],d=ea.key(e,f.key.path,n.batchId);o.push(i.delete(d)),c.push(f.key)}return ga.waitFor(o).next((function(){return c}))}function Za(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Or();e=t.noDocument}return JSON.stringify(e).length}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ja.DEFAULT_COLLECTION_PERCENTILE=10,Ja.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ja.DEFAULT=new Ja(41943040,Ja.DEFAULT_COLLECTION_PERCENTILE,Ja.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ja.DISABLED=new Ja(-1,0,0);var tu=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Qt={}}return t.Kt=function(e,n,r,i){return Pr(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return nu(t).Ot({index:ta.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=ru(t),s=nu(t);return s.add({}).next((function(a){Pr("number"==typeof a);for(var u=new ka(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map((function(e){return xs(t.Lt,e)})),i=n.mutations.map((function(e){return xs(t.Lt,e)}));return new ta(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),h=[],l=new Yo((function(t,e){return Vr(t.canonicalString(),e.canonicalString())})),f=0,d=r;f<d.length;f++){var p=d[f],y=ea.key(i.userId,p.key.path,a);l=l.add(p.key.path.popLast()),h.push(s.put(c)),h.push(o.put(y,ea.PLACEHOLDER))}return l.forEach((function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((function(){i.Qt[a]=u.keys()})),ga.waitFor(h).next((function(){return u}))}))},t.prototype.lookupMutationBatch=function(t,e){var n=this;return nu(t).get(e).next((function(t){return t?(Pr(t.userId===n.userId),Ua(n.R,t)):null}))},t.prototype.jt=function(t,e){var n=this;return this.Qt[e]?ga.resolve(this.Qt[e]):this.lookupMutationBatch(t,e).next((function(t){if(t){var r=t.keys();return n.Qt[e]=r,r}return null}))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return nu(t).Ot({index:ta.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(Pr(e.batchId>=r),o=Ua(n.R,e)),i.done()})).next((function(){return o}))},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return nu(t).Ot({index:ta.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return nu(t).Nt(ta.userMutationsIndex,n).next((function(t){return t.map((function(t){return Ua(e.R,t)}))}))},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=ea.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return ru(t).Ot({range:i},(function(r,i,s){var a=r[0],u=r[1],c=r[2],h=Xs(u);if(a===n.userId&&e.path.isEqual(h))return nu(t).get(c).next((function(t){if(!t)throw Or();Pr(t.userId===n.userId),o.push(Ua(n.R,t))}));s.done()})).next((function(){return o}))},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Yo(Vr),i=[];return e.forEach((function(e){var o=ea.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=ru(t).Ot({range:s},(function(t,i,o){var s=t[0],a=t[1],u=t[2],c=Xs(a);s===n.userId&&e.path.isEqual(c)?r=r.add(u):o.done()}));i.push(a)})),ga.waitFor(i).next((function(){return n.Wt(t,r)}))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=ea.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new Yo(Vr);return ru(t).Ot({range:s},(function(t,e,o){var s=t[0],u=t[1],c=t[2],h=Xs(u);s===n.userId&&r.isPrefixOf(h)?h.length===i&&(a=a.add(c)):o.done()})).next((function(){return n.Wt(t,a)}))},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(nu(t).get(e).next((function(t){if(null===t)throw Or();Pr(t.userId===n.userId),r.push(Ua(n.R,t))})))})),ga.waitFor(i).next((function(){return r}))},t.prototype.removeMutationBatch=function(t,e){var n=this;return $a(t.Mt,this.userId,e).next((function(r){return t.addOnCommittedListener((function(){n.Gt(e.batchId)})),ga.forEach(r,(function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)}))}))},t.prototype.Gt=function(t){delete this.Qt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next((function(n){if(!n)return ga.resolve();var r=IDBKeyRange.lowerBound(ea.prefixForUser(e.userId)),i=[];return ru(t).Ot({range:r},(function(t,n,r){if(t[0]===e.userId){var o=Xs(t[1]);i.push(o)}else r.done()})).next((function(){Pr(0===i.length)}))}))},t.prototype.containsKey=function(t,e){return eu(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return iu(t).get(this.userId).next((function(t){return t||new Zs(e.userId,-1,"")}))},t}();function eu(t,e,n){var r=ea.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return ru(t).Ot({range:o,kt:!0},(function(t,n,r){var o=t[0],a=t[1];t[2],o===e&&a===i&&(s=!0),r.done()})).next((function(){return s}))}function nu(t){return Aa(t,ta.store)}function ru(t){return Aa(t,ea.store)}function iu(t){return Aa(t,Zs.store)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ou=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),su=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next((function(n){var r=new ou(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next((function(t){return jr.fromTimestamp(new Br(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next((function(t){return t.highestListenSequenceNumber}))},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)}))},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next((function(){return n.Xt(t).next((function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)}))}))},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next((function(){return au(t).delete(e.targetId)})).next((function(){return n.Xt(t)})).next((function(e){return Pr(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)}))},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return au(t).Ot((function(s,a){var u=qa(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))})).next((function(){return ga.waitFor(o)})).next((function(){return i}))},t.prototype.forEachTarget=function(t,e){return au(t).Ot((function(t,n){var r=qa(n);e(r)}))},t.prototype.Xt=function(t){return uu(t).get(ua.key).next((function(t){return Pr(null!==t),t}))},t.prototype.Zt=function(t,e){return uu(t).put(ua.key,e)},t.prototype.te=function(t,e){return au(t).put(Ba(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next((function(t){return t.targetCount}))},t.prototype.getTargetData=function(t,e){var n=Ni(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return au(t).Ot({range:r,index:sa.queryTargetsIndexName},(function(t,n,r){var o=qa(n);Ai(e,o.target)&&(i=o,r.done())})).next((function(){return i}))},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=cu(t);return e.forEach((function(e){var s=Hs(e.path);i.push(o.put(new aa(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))})),ga.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=cu(t);return ga.forEach(e,(function(e){var o=Hs(e.path);return ga.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])}))},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=cu(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=cu(t),i=rs();return r.Ot({range:n,kt:!0},(function(t,e,n){var r=Xs(t[1]),o=new ui(r);i=i.add(o)})).next((function(){return i}))},t.prototype.containsKey=function(t,e){var n=Hs(e.path),r=IDBKeyRange.bound([n],[qr(n)],!1,!0),i=0;return cu(t).Ot({index:aa.documentTargetsIndex,kt:!0,range:r},(function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.lt=function(t,e){return au(t).get(e).next((function(t){return t?qa(t):null}))},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function au(t){return Aa(t,sa.store)}function uu(t){return Aa(t,ua.store)}function cu(t){return Aa(t,aa.store)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hu(t){return n(this,void 0,void 0,(function(){return r(this,(function(e){if(t.code!==Sr.FAILED_PRECONDITION||t.message!==pa)throw t;return kr("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lu(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=Vr(n,i);return 0===s?Vr(r,o):s}var fu=function(){function t(t){this.ne=t,this.buffer=new Yo(lu),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();lu(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),du=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,i=this.oe?3e5:6e4;kr("LruGarbageCollector","Garbage collection scheduled in "+i+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",i,(function(){return n(e,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return Ta(e=n.sent())?(kr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,hu(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}}))}))}))},t}(),pu=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return ga.resolve(_r.o);var r=new fu(e);return this.ae.forEachTarget(t,(function(t){return r.re(t.sequenceNumber)})).next((function(){return n.ae.le(t,(function(t){return r.re(t)}))})).next((function(){return r.maxValue}))},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(kr("LruGarbageCollector","Garbage collection skipped; disabled"),ga.resolve(Xa)):this.getCacheSize(t).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(kr("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),Xa):n.fe(t,e)}))},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,i,o,s,a,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((function(e){return e>c.params.maximumSequenceNumbersToCollect?(kr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),r=c.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),c.nthSequenceNumber(t,r)})).next((function(r){return n=r,s=Date.now(),c.removeTargets(t,n,e)})).next((function(e){return i=e,a=Date.now(),c.removeOrphanedDocuments(t,n)})).next((function(t){return u=Date.now(),Ar()<=d.DEBUG&&kr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(a-s)+"ms\n\tRemoved "+t+" documents in "+(u-a)+"ms\nTotal Duration: "+(u-h)+"ms"),ga.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})}))},t}(),yu=function(){function t(t,e){this.db=t,this.garbageCollector=new pu(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.de=function(t){var e=0;return this.le(t,(function(t){e++})).next((function(){return e}))},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,(function(t,n){return e(n)}))},t.prototype.addReference=function(t,e,n){return vu(t,n)},t.prototype.removeReference=function(t,e,n){return vu(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return vu(t,e)},t.prototype._e=function(t,e){return r=e,i=!1,iu(n=t).$t((function(t){return eu(n,t,r).next((function(t){return t&&(i=!0),ga.resolve(!t)}))})).next((function(){return i}));var n,r,i},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,(function(s,a){if(a<=e){var u=n._e(t,s).next((function(e){if(!e)return o++,r.getEntry(t,s).next((function(){return r.removeEntry(s),cu(t).delete([0,Hs(s.path)])}))}));i.push(u)}})).next((function(){return ga.waitFor(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return vu(t,e)},t.prototype.we=function(t,e){var n,r=cu(t),i=_r.o;return r.Ot({index:aa.documentTargetsIndex},(function(t,r){var o=t[0],s=(t[1],r.path),a=r.sequenceNumber;0===o?(i!==_r.o&&e(new ui(Xs(n)),i),i=a,n=s):i=_r.o})).next((function(){i!==_r.o&&e(new ui(Xs(n)),i)}))},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function vu(t,e){return cu(t).put((n=e,r=t.currentSequenceNumber,new aa(0,Hs(n.path),r)));var n,r}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var gu=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];if(this.equalsFn(s,t))return a}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){Gr(this.inner,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];t(s,a)}}))},t.prototype.isEmpty=function(){return zr(this.inner)},t}(),mu=function(){function t(){this.changes=new gu((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:jr.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:_i.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?ga.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),wu=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return Tu(t).put(Eu(e),n)},t.prototype.removeEntry=function(t,e){var n=Tu(t),r=Eu(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.me(t,r)}))},t.prototype.getEntry=function(t,e){var n=this;return Tu(t).get(Eu(e)).next((function(t){return n.ye(e,t)}))},t.prototype.ge=function(t,e){var n=this;return Tu(t).get(Eu(e)).next((function(t){return{document:n.ye(e,t),size:Za(t)}}))},t.prototype.getEntries=function(t,e){var n=this,r=$o();return this.pe(t,e,(function(t,e){var i=n.ye(t,e);r=r.insert(t,i)})).next((function(){return r}))},t.prototype.Ee=function(t,e){var n=this,r=$o(),i=new Qo(ui.comparator);return this.pe(t,e,(function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,Za(e))})).next((function(){return{documents:r,Te:i}}))},t.prototype.pe=function(t,e,n){if(e.isEmpty())return ga.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return Tu(t).Ot({range:r},(function(t,e,r){for(var s=ui.fromSegments(t);o&&ui.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()})).next((function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=$o(),o=e.path.length+1,s={};if(n.isEqual(jr.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=La(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=ia.collectionReadTimeIndex}return Tu(t).Ot(s,(function(t,n,s){if(t.length===o){var a=Oa(r.R,n);e.path.isPrefixOf(a.key.path)?oo(e,a)&&(i=i.insert(a.key,a)):s.done()}})).next((function(){return i}))},t.prototype.newChangeBuffer=function(t){return new bu(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return Iu(t).get(oa.key).next((function(t){return Pr(!!t),t}))},t.prototype.me=function(t,e){return Iu(t).put(oa.key,e)},t.prototype.ye=function(t,e){if(e){var n=Oa(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(jr.min()))return n}return _i.newInvalidDocument(t)},t}(),bu=function(e){function n(t,n){var r=this;return(r=e.call(this)||this).Ie=t,r.trackRemovals=n,r.Ae=new gu((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),r}return t(n,e),n.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new Yo((function(t,e){return Vr(t.canonicalString(),e.canonicalString())}));return this.changes.forEach((function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var u=Pa(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=Za(u);r+=c-a,n.push(e.Ie.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var h=Pa(e.Ie.R,_i.newNoDocument(o,jr.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))})),i.forEach((function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))})),n.push(this.Ie.updateMetadata(t,r)),ga.waitFor(n)},n.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next((function(t){return n.Ae.set(e,t.size),t.document}))},n.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next((function(t){var e=t.documents;return t.Te.forEach((function(t,e){n.Ae.set(t,e)})),e}))},n}(mu);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Iu(t){return Aa(t,oa.store)}function Tu(t){return Aa(t,ia.store)}function Eu(t){return t.path.toArray()}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var _u=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;Pr(n<r&&n>=0&&r<=11);var o=new ma("createOrUpgrade",e);n<1&&r>=1&&(t.createObjectStore($s.store),function(t){t.createObjectStore(Zs.store,{keyPath:Zs.keyPath}),t.createObjectStore(ta.store,{keyPath:ta.keyPath,autoIncrement:!0}).createIndex(ta.userMutationsIndex,ta.userMutationsKeyPath,{unique:!0}),t.createObjectStore(ea.store)}(t),Su(t),function(t){t.createObjectStore(ia.store)}(t));var s=ga.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(aa.store),t.deleteObjectStore(sa.store),t.deleteObjectStore(ua.store)}(t),Su(t)),s=s.next((function(){return function(t){var e=t.store(ua.store),n=new ua(0,0,jr.min().toTimestamp(),0);return e.put(ua.key,n)}(o)}))),n<4&&r>=4&&(0!==n&&(s=s.next((function(){return function(t,e){return e.store(ta.store).Nt().next((function(n){t.deleteObjectStore(ta.store),t.createObjectStore(ta.store,{keyPath:ta.keyPath,autoIncrement:!0}).createIndex(ta.userMutationsIndex,ta.userMutationsKeyPath,{unique:!0});var r=e.store(ta.store),i=n.map((function(t){return r.put(t)}));return ga.waitFor(i)}))}(t,o)}))),s=s.next((function(){!function(t){t.createObjectStore(ha.store,{keyPath:ha.keyPath})}(t)}))),n<5&&r>=5&&(s=s.next((function(){return i.Re(o)}))),n<6&&r>=6&&(s=s.next((function(){return function(t){t.createObjectStore(oa.store)}(t),i.be(o)}))),n<7&&r>=7&&(s=s.next((function(){return i.ve(o)}))),n<8&&r>=8&&(s=s.next((function(){return i.Pe(t,o)}))),n<9&&r>=9&&(s=s.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(ia.store);e.createIndex(ia.readTimeIndex,ia.readTimeIndexPath,{unique:!1}),e.createIndex(ia.collectionReadTimeIndex,ia.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(s=s.next((function(){return i.Ve(o)}))),n<11&&r>=11&&(s=s.next((function(){!function(t){t.createObjectStore(la.store,{keyPath:la.keyPath})}(t),function(t){t.createObjectStore(fa.store,{keyPath:fa.keyPath})}(t)}))),s},t.prototype.be=function(t){var e=0;return t.store(ia.store).Ot((function(t,n){e+=Za(n)})).next((function(){var n=new oa(e);return t.store(oa.store).put(oa.key,n)}))},t.prototype.Re=function(t){var e=this,n=t.store(Zs.store),r=t.store(ta.store);return n.Nt().next((function(n){return ga.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(ta.userMutationsIndex,i).next((function(r){return ga.forEach(r,(function(r){Pr(r.userId===n.userId);var i=Ua(e.R,r);return $a(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.ve=function(t){var e=t.store(aa.store),n=t.store(ia.store);return t.store(ua.store).get(ua.key).next((function(t){var r=[];return n.Ot((function(n,i){var o=new Hr(n),s=[0,Hs(o)];r.push(e.get(s).next((function(n){return n?ga.resolve():(r=o,e.put(new aa(0,Hs(r),t.highestListenSequenceNumber)));var r})))})).next((function(){return ga.waitFor(r)}))}))},t.prototype.Pe=function(t,e){t.createObjectStore(ca.store,{keyPath:ca.keyPath});var n=e.store(ca.store),r=new Ha,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:Hs(i)})}};return e.store(ia.store).Ot({kt:!0},(function(t,e){var n=new Hr(t);return i(n.popLast())})).next((function(){return e.store(ea.store).Ot({kt:!0},(function(t,e){t[0];var n=t[1],r=(t[2],Xs(n));return i(r.popLast())}))}))},t.prototype.Ve=function(t){var e=this,n=t.store(sa.store);return n.Ot((function(t,r){var i=qa(r),o=Ba(e.R,i);return n.put(o)}))},t}();function Su(t){t.createObjectStore(aa.store,{keyPath:aa.keyPath}).createIndex(aa.documentTargetsIndex,aa.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(sa.store,{keyPath:sa.keyPath}).createIndex(sa.queryTargetsIndexName,sa.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(ua.store)}var Du="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Nu=function(){function t(e,n,r,i,o,s,a,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fe=null,this.inForeground=!1,this.ke=null,this.Oe=null,this.$e=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new Dr(Sr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");var l,f;this.referenceDelegate=new yu(this,i),this.Le=n+"main",this.R=new Ra(u),this.Be=new wa(this.Le,11,new _u(this.R)),this.qe=new su(this.referenceDelegate,this.R),this.Ut=new Wa,this.Ue=(l=this.R,f=this.Ut,new wu(l,f)),this.Qe=new Ka,this.window&&this.window.localStorage?this.Ke=this.window.localStorage:(this.Ke=null,!1===h&&Cr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new Dr(Sr.FAILED_PRECONDITION,Du);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t.qe.getHighestSequenceNumber(e)}))})).then((function(e){t.Ne=new _r(e,t.De)})).then((function(){t.xe=!0})).catch((function(e){return t.Be&&t.Be.close(),Promise.reject(e)}))},t.prototype.He=function(t){var e=this;return this.Me=function(i){return n(e,void 0,void 0,(function(){return r(this,(function(e){return this.started?[2,t(i)]:[2]}))}))},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt((function(i){return n(e,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return null===i.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget((function(){return n(e,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return ku(e).put(new ha(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.Je(e).next((function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable((function(){return t.Me(!1)})))}))})).next((function(){return t.Ye(e)})).next((function(n){return t.isPrimary&&!n?t.Xe(e).next((function(){return!1})):!!n&&t.Ze(e).next((function(){return!0}))}))})).catch((function(e){if(Ta(e))return kr("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return kr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.Se.enqueueRetryable((function(){return t.Me(e)})),t.isPrimary=e}))},t.prototype.Je=function(t){var e=this;return Au(t).get($s.key).next((function(t){return ga.resolve(e.tn(t))}))},t.prototype.en=function(t){return ku(t).delete(this.clientId)},t.prototype.nn=function(){return n(this,void 0,void 0,(function(){var t,e,n,i,o=this;return r(this,(function(r){switch(r.label){case 0:return!this.isPrimary||this.sn(this.$e,18e5)?[3,2]:(this.$e=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(t){var e=Aa(t,ha.store);return e.Nt().next((function(t){var n=o.rn(t,18e5),r=t.filter((function(t){return-1===n.indexOf(t)}));return ga.forEach(r,(function(t){return e.delete(t.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}))]);case 1:if(t=r.sent(),this.Ke)for(e=0,n=t;e<n.length;e++)i=n[e],this.Ke.removeItem(this.on(i.clientId));r.label=2;case 2:return[2]}}))}))},t.prototype.ze=function(){var t=this;this.Oe=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,(function(){return t.je().then((function(){return t.nn()})).then((function(){return t.ze()}))}))},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?ga.resolve(!0):Au(t).get($s.key).next((function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new Dr(Sr.FAILED_PRECONDITION,Du);return!1}}return!(!e.networkEnabled||!e.inForeground)||ku(t).Nt().next((function(t){return void 0===e.rn(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&kr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},t.prototype.shutdown=function(){return n(this,void 0,void 0,(function(){var t=this;return r(this,(function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.Oe&&(this.Oe.cancel(),this.Oe=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[$s.store,ha.store],(function(e){var n=new Na(e,_r.o);return t.Xe(n).next((function(){return t.en(n)}))}))];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}}))}))},t.prototype.rn=function(t,e){var n=this;return t.filter((function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)}))},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return ku(e).Nt().next((function(e){return t.rn(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return tu.Kt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Qe},t.prototype.runTransaction=function(t,e,n){var r=this;kr("IndexedDbPersistence","Starting transaction:",t);var i,o="readonly"===e?"readonly":"readwrite";return this.Be.runTransaction(t,o,da,(function(o){return i=new Na(o,r.Ne?r.Ne.next():_r.o),"readwrite-primary"===e?r.Je(i).next((function(t){return!!t||r.Ye(i)})).next((function(e){if(!e)throw Cr("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.Se.enqueueRetryable((function(){return r.Me(!1)})),new Dr(Sr.FAILED_PRECONDITION,pa);return n(i)})).next((function(t){return r.Ze(i).next((function(){return t}))})):r.dn(i).next((function(){return n(i)}))})).then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.dn=function(t){var e=this;return Au(t).get($s.key).next((function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Dr(Sr.FAILED_PRECONDITION,Du)}))},t.prototype.Ze=function(t){var e=new $s(this.clientId,this.allowTabSynchronization,Date.now());return Au(t).put($s.key,e)},t.yt=function(){return wa.yt()},t.prototype.Xe=function(t){var e=this,n=Au(t);return n.get($s.key).next((function(t){return e.tn(t)?(kr("IndexedDbPersistence","Releasing primary lease."),n.delete($s.key)):ga.resolve()}))},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(Cr("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ke=function(){t.Se.enqueueAndForget((function(){return t.inForeground="visible"===t.document.visibilityState,t.je()}))},this.document.addEventListener("visibilitychange",this.ke),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.ke&&(this.document.removeEventListener("visibilitychange",this.ke),this.ke=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Fe=function(){e.un(),e.Se.enqueueAndForget((function(){return e.shutdown()}))},this.window.addEventListener("unload",this.Fe))},t.prototype.hn=function(){this.Fe&&(this.window.removeEventListener("unload",this.Fe),this.Fe=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Ke)||void 0===e?void 0:e.getItem(this.on(t)));return kr("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(r){return Cr("IndexedDbPersistence","Failed to get zombied client id.",r),!1}},t.prototype.un=function(){if(this.Ke)try{this.Ke.setItem(this.on(this.clientId),String(Date.now()))}catch(t){Cr("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Ke)try{this.Ke.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function Au(t){return Aa(t,$s.store)}function ku(t){return Aa(t,ha.store)}function Cu(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var xu=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next((function(r){return n.yn(t,e,r)}))},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next((function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t}))},t.prototype.gn=function(t,e){t.forEach((function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)}))},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next((function(e){return n.En(t,e).next((function(){return e}))}))},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next((function(t){return n.gn(e,t)}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return r=e,ui.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.Tn(t,e.path):$i(e)?this.In(t,e,n):this.An(t,e,n);var r},t.prototype.Tn=function(t,e){return this.mn(t,new ui(e)).next((function(t){var e=ts();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=ts();return this.Ut.getCollectionParents(t,i).next((function(s){return ga.forEach(s,(function(s){var a,u,c=(a=e,u=s.child(i),new zi(u,null,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt));return r.An(t,c,n).next((function(t){t.forEach((function(t,e){o=o.insert(t,e)}))}))})).next((function(){return o}))}))},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next((function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)})).next((function(e){return i=e,o.Rn(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c);null==h&&(h=_i.newInvalidDocument(c),r=r.insert(c,h)),Co(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}}))})).next((function(){return r.forEach((function(t,n){oo(e,n)||(r=r.remove(t))})),r}))},t.prototype.Rn=function(t,e,n){for(var r=rs(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof Lo&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next((function(t){return t.forEach((function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))})),c}))},t}(),Ru=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=rs(),i=rs(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),Ou=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i,o=this;return 0===(i=e).filters.length&&null===i.limit&&null==i.startAt&&null==i.endAt&&(0===i.explicitOrderBy.length||1===i.explicitOrderBy.length&&i.explicitOrderBy[0].field.isKeyField())||n.isEqual(jr.min())?this.Dn(t,e):this.Sn.pn(t,r).next((function(i){var s=o.Cn(e,i);return(Wi(e)||Yi(e))&&o.Nn(e.limitType,s,r,n)?o.Dn(t,e):(Ar()<=d.DEBUG&&kr("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),io(e)),o.Sn.getDocumentsMatchingQuery(t,e,n).next((function(t){return s.forEach((function(e){t=t.insert(e.key,e)})),t})))}))},t.prototype.Cn=function(t,e){var n=new Yo(so(t));return e.forEach((function(e,r){oo(t,r)&&(n=n.add(r))})),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return Ar()<=d.DEBUG&&kr("QueryEngine","Using full collection scan to execute query:",io(e)),this.Sn.getDocumentsMatchingQuery(t,e,jr.min())},t}(),Pu=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.Fn=new Qo(Vr),this.kn=new gu((function(t){return Ni(t)}),Ai),this.On=jr.min(),this._n=t.getMutationQueue(n),this.$n=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new xu(this.$n,this._n,this.persistence.getIndexManager()),this.Qe=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.collect(n,e.Fn)}))},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lu(t,e,n,r){return new Pu(t,e,n,r)}function Mu(t,e){return n(this,void 0,void 0,(function(){var n,i,o,s;return r(this,(function(r){switch(r.label){case 0:return n=Lr(t),i=n._n,o=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",(function(t){var r;return n._n.getAllMutationBatches(t).next((function(s){return r=s,i=n.persistence.getMutationQueue(e),o=new xu(n.$n,i,n.persistence.getIndexManager()),i.getAllMutationBatches(t)})).next((function(e){for(var n=[],i=[],s=rs(),a=0,u=r;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++){var f=l[h];s=s.add(f.key)}}for(var d=0,p=e;d<p.length;d++){var y=p[d];i.push(y.batchId);for(var v=0,g=y.mutations;v<g.length;v++){var m=g[v];s=s.add(m.key)}}return o.pn(t,s).next((function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:i}}))}))}))];case 1:return s=r.sent(),[2,(n._n=i,n.Mn=o,n.xn.Vn(n.Mn),s)]}}))}))}function Fu(t,e){var n=Lr(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(t){var r,i,o,s,a,u,c,h=e.batch.keys(),l=n.$n.newChangeBuffer({trackRemovals:!0});return(r=n,i=t,o=e,s=l,a=o.batch,u=a.keys(),c=ga.resolve(),u.forEach((function(t){c=c.next((function(){return s.getEntry(i,t)})).next((function(e){var n=o.docVersions.get(t);Pr(null!==n),e.version.compareTo(n)<0&&(a.applyToRemoteDocument(e,o),e.isValidDocument()&&s.addEntry(e,o.commitVersion))}))})),c.next((function(){return r._n.removeMutationBatch(i,a)}))).next((function(){return l.apply(t)})).next((function(){return n._n.performConsistencyCheck(t)})).next((function(){return n.Mn.pn(t,h)}))}))}function Vu(t){var e=Lr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(function(t){return e.qe.getLastRemoteSnapshotVersion(t)}))}function Uu(t,e){var n=Lr(t),r=e.snapshotVersion,i=n.Fn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(t){var o=n.$n.newChangeBuffer({trackRemovals:!0});i=n.Fn;var s=[];e.targetChanges.forEach((function(e,o){var a,u,c,h=i.get(o);if(h){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next((function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)})));var l=e.resumeToken;if(l.approximateByteSize()>0){var f=h.withResumeToken(l,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,f),a=h,c=e,Pr((u=f).resumeToken.approximateByteSize()>0),(0===a.resumeToken.approximateByteSize()||u.snapshotVersion.toMicroseconds()-a.snapshotVersion.toMicroseconds()>=3e8||c.addedDocuments.size+c.modifiedDocuments.size+c.removedDocuments.size>0)&&s.push(n.qe.updateTargetData(t,f))}}}));var a=$o();if(e.documentUpdates.forEach((function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),s.push(function(t,e,n,r,i){var o=rs();return n.forEach((function(t){return o=o.add(t)})),e.getEntries(t,o).next((function(t){var o=$o();return n.forEach((function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(jr.min())?(e.removeEntry(n,u),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):kr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)})),o}))}(t,o,e.documentUpdates,r,void 0).next((function(t){a=t}))),!r.isEqual(jr.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next((function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)}));s.push(u)}return ga.waitFor(s).next((function(){return o.apply(t)})).next((function(){return n.Mn.En(t,a)})).next((function(){return a}))})).then((function(t){return n.Fn=i,t}))}function qu(t,e){var n=Lr(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)}))}function Bu(t,e){var n=Lr(t);return n.persistence.runTransaction("Allocate target","readwrite",(function(t){var r;return n.qe.getTargetData(t,e).next((function(i){return i?(r=i,ga.resolve(r)):n.qe.allocateTargetId(t).next((function(i){return r=new xa(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next((function(){return r}))}))}))})).then((function(t){var r=n.Fn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Fn=n.Fn.insert(t.targetId,t),n.kn.set(e,t.targetId)),t}))}function ju(t,e,i){return n(this,void 0,void 0,(function(){var n,o,s,a;return r(this,(function(r){switch(r.label){case 0:n=Lr(t),o=n.Fn.get(e),s=i?"readwrite":"readwrite-primary",r.label=1;case 1:return r.trys.push([1,4,,5]),i?[3,3]:[4,n.persistence.runTransaction("Release target",s,(function(t){return n.persistence.referenceDelegate.removeTarget(t,o)}))];case 2:r.sent(),r.label=3;case 3:return[3,5];case 4:if(!Ta(a=r.sent()))throw a;return kr("LocalStore","Failed to update sequence numbers for target "+e+": "+a),[3,5];case 5:return n.Fn=n.Fn.remove(e),n.kn.delete(o.target),[2]}}))}))}function Ku(t,e,n){var r=Lr(t),i=jr.min(),o=rs();return r.persistence.runTransaction("Execute query","readonly",(function(t){return(s=r,a=t,u=to(e),c=Lr(s),h=c.kn.get(u),void 0!==h?ga.resolve(c.Fn.get(h)):c.qe.getTargetData(a,u)).next((function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next((function(t){o=t}))})).next((function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:jr.min(),n?o:rs())})).next((function(t){return{documents:t,Bn:o}}));var s,a,u,c,h}))}function Gu(t,e){var n=Lr(t),r=Lr(n.qe),i=n.Fn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(t){return r.lt(t,e).next((function(t){return t?t.target:null}))}))}function zu(t){var e=Lr(t);return e.persistence.runTransaction("Get new document changes","readonly",(function(t){return n=e.$n,r=t,i=e.On,o=Lr(n),s=$o(),a=La(i),u=Tu(r),c=IDBKeyRange.lowerBound(a,!0),u.Ot({index:ia.readTimeIndex,range:c},(function(t,e){var n=Oa(o.R,e);s=s.insert(n.key,n),a=e.readTime})).next((function(){return{wn:s,readTime:Ma(a)}}));var n,r,i,o,s,a,u,c})).then((function(t){var n=t.wn,r=t.readTime;return e.On=r,n}))}function Qu(t){return n(this,void 0,void 0,(function(){var e;return r(this,(function(n){return[2,(e=Lr(t)).persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return e=Tu(t),n=jr.min(),e.Ot({index:ia.readTimeIndex,reverse:!0},(function(t,e,r){e.readTime&&(n=Ma(e.readTime)),r.done()})).next((function(){return n}));var e,n})).then((function(t){e.On=t}))]}))}))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Hu=function(){function t(t){this.R=t,this.Kn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return ga.resolve(this.Kn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Kn.set(e.id,{id:(n=e).id,version:n.version,createTime:Is(n.createTime)}),ga.resolve()},t.prototype.getNamedQuery=function(t,e){return ga.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,{name:(n=e).name,query:ja(n.bundledQuery),readTime:Is(n.readTime)}),ga.resolve();var n},t}(),Wu=function(){function t(){this.Wn=new Yo(Yu.Gn),this.zn=new Yo(Yu.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new Yu(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach((function(t){return n.addReference(t,e)}))},t.prototype.removeReference=function(t,e){this.Yn(new Yu(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach((function(t){return n.removeReference(t,e)}))},t.prototype.Zn=function(t){var e=this,n=new ui(new Hr([])),r=new Yu(n,t),i=new Yu(n,t+1),o=[];return this.zn.forEachInRange([r,i],(function(t){e.Yn(t),o.push(t.key)})),o},t.prototype.ts=function(){var t=this;this.Wn.forEach((function(e){return t.Yn(e)}))},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new ui(new Hr([])),n=new Yu(e,t),r=new Yu(e,t+1),i=rs();return this.zn.forEachInRange([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.containsKey=function(t){var e=new Yu(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),Yu=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return ui.comparator(t.key,e.key)||Vr(t.ns,e.ns)},t.Hn=function(t,e){return Vr(t.ns,e.ns)||ui.comparator(t.key,e.key)},t}(),Xu=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new Yo(Yu.Gn)}return t.prototype.checkEmpty=function(t){return ga.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++,this._n.length>0&&this._n[this._n.length-1];var o=new ka(i,e,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.rs=this.rs.add(new Yu(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return ga.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return ga.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.cs(n),i=r<0?0:r;return ga.resolve(this._n.length>i?this._n[i]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return ga.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return ga.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new Yu(e,0),i=new Yu(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],(function(t){var e=n.os(t.ns);o.push(e)})),ga.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Yo(Vr);return e.forEach((function(t){var e=new Yu(t,0),i=new Yu(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],(function(t){r=r.add(t.ns)}))})),ga.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;ui.isDocumentKey(i)||(i=i.child(""));var o=new Yu(new ui(i),0),s=new Yo(Vr);return this.rs.forEachWhile((function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)}),o),ga.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.os(t);null!==r&&n.push(r)})),n},t.prototype.removeMutationBatch=function(t,e){var n=this;Pr(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return ga.forEach(e.mutations,(function(i){var o=new Yu(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)})).next((function(){n.rs=r}))},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new Yu(e,0),r=this.rs.firstAfterOrEqual(n);return ga.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return this._n.length,ga.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),Ju=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new Qo(ui.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return ga.resolve(n?n.document.clone():_i.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=$o();return e.forEach((function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():_i.newInvalidDocument(t))})),ga.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=$o(),i=new ui(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.key,u=s.value,c=u.document,h=u.readTime;if(!e.path.isPrefixOf(a.path))break;h.compareTo(n)<=0||oo(e,c)&&(r=r.insert(c.key,c.clone()))}return ga.resolve(r)},t.prototype.fs=function(t,e){return ga.forEach(this.docs,(function(t){return e(t)}))},t.prototype.newChangeBuffer=function(t){return new $u(this)},t.prototype.getSize=function(t){return ga.resolve(this.size)},t}(),$u=function(e){function n(t){var n=this;return(n=e.call(this)||this).Ie=t,n}return t(n,e),n.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach((function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)})),ga.waitFor(n)},n.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},n.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},n}(mu),Zu=function(){function t(t){this.persistence=t,this.ds=new gu((function(t){return Ni(t)}),Ai),this.lastRemoteSnapshotVersion=jr.min(),this.highestTargetId=0,this.ws=0,this._s=new Wu,this.targetCount=0,this.ys=ou.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach((function(t,n){return e(n)})),ga.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return ga.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return ga.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),ga.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),ga.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new ou(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,ga.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),ga.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,ga.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach((function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)})),ga.waitFor(o).next((function(){return i}))},t.prototype.getTargetCount=function(t){return ga.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return ga.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),ga.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((function(e){i.push(r.markPotentiallyOrphaned(t,e))})),ga.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),ga.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return ga.resolve(n)},t.prototype.containsKey=function(t,e){return ga.resolve(this._s.containsKey(e))},t}(),tc=function(){function t(t,e){var n,r=this;this.gs={},this.Ne=new _r(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new Zu(this),this.Ut=new Qa,this.Ue=(n=this.Ut,new Ju(n,(function(t){return r.referenceDelegate.ps(t)}))),this.R=new Ra(e),this.Qe=new Hu(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new Xu(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Qe},t.prototype.runTransaction=function(t,e,n){var r=this;kr("MemoryPersistence","Starting transaction:",t);var i=new ec(this.Ne.next());return this.referenceDelegate.Es(),n(i).next((function(t){return r.referenceDelegate.Ts(i).next((function(){return t}))})).toPromise().then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.Is=function(t,e){return ga.or(Object.values(this.gs).map((function(n){return function(){return n.containsKey(t,e)}})))},t}(),ec=function(e){function n(t){var n=this;return(n=e.call(this)||this).currentSequenceNumber=t,n}return t(n,e),n}(ya),nc=function(){function t(t){this.persistence=t,this.As=new Wu,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw Or()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),ga.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),ga.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),ga.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach((function(t){return n.vs.add(t.toString())}));var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next((function(t){t.forEach((function(t){return n.vs.add(t.toString())}))})).next((function(){return r.removeTargetData(t,e)}))},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ga.forEach(this.vs,(function(r){var i=ui.fromPath(r);return e.Ps(t,i).next((function(t){t||n.removeEntry(i)}))})).next((function(){return e.Rs=null,n.apply(t)}))},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next((function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())}))},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return ga.or([function(){return ga.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),rc=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ic(t,e){return"firestore_clients_"+t+"_"+e}function oc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function sc(t,e){return"firestore_targets_"+t+"_"+e}rc.UNAUTHENTICATED=new rc(null),rc.GOOGLE_CREDENTIALS=new rc("google-credentials-uid"),rc.FIRST_PARTY=new rc("first-party-uid");var ac=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new Dr(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(Cr("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),uc=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new Dr(i.error.code,i.error.message)),o?new t(e,i.state,r):(Cr("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),cc=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=os(),s=0;i&&s<r.activeTargetIds.length;++s)i=ai(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(Cr("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),hc=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(Cr("SharedClientState","Failed to parse online state: "+e),null)},t}(),lc=function(){function t(){this.activeTargetIds=os()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),fc=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.Fs.bind(this),this.ks=new Qo(Vr),this.started=!1,this.Os=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.$s=ic(this.persistenceKey,this.Ns),this.Ms="firestore_sequence_number_"+this.persistenceKey,this.ks=this.ks.insert(this.Ns,new lc),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Qs=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return n(this,void 0,void 0,(function(){var t,e,n,i,o,s,a,u,c,h,l,f=this;return r(this,(function(r){switch(r.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=r.sent(),e=0,n=t;e<n.length;e++)(i=n[e])!==this.Ns&&(o=this.getItem(ic(this.persistenceKey,i)))&&(s=cc.Vs(i,o))&&(this.ks=this.ks.insert(s.clientId,s));for(this.Ks(),(a=this.storage.getItem(this.Us))&&(u=this.js(a))&&this.Ws(u),c=0,h=this.Os;c<h.length;c++)l=h[c],this.Fs(l);return this.Os=[],this.window.addEventListener("unload",(function(){return f.shutdown()})),this.started=!0,[2]}}))}))},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.ks)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.ks.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(sc(this.persistenceKey,t));if(n){var r=uc.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Ks(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Ks()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(sc(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach((function(t){r.Hs(t)})),this.currentUser=t,n.forEach((function(t){r.addPendingMutation(t)}))},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.$s),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return kr("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){kr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){kr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Fs=function(t){var e=this,i=t;if(i.storageArea===this.storage){if(kr("SharedClientState","EVENT",i.key,i.newValue),i.key===this.$s)return void Cr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable((function(){return n(e,void 0,void 0,(function(){var t,e,n,o,s,a;return r(this,(function(r){if(this.started){if(null!==i.key)if(this.Ls.test(i.key)){if(null==i.newValue)return t=this.ti(i.key),[2,this.ei(t,null)];if(e=this.ni(i.key,i.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(i.key)){if(null!==i.newValue&&(n=this.si(i.key,i.newValue)))return[2,this.ii(n)]}else if(this.qs.test(i.key)){if(null!==i.newValue&&(o=this.ri(i.key,i.newValue)))return[2,this.oi(o)]}else if(i.key===this.Us){if(null!==i.newValue&&(s=this.js(i.newValue)))return[2,this.Ws(s)]}else if(i.key===this.Ms)(a=function(t){var e=_r.o;if(null!=t)try{var n=JSON.parse(t);Pr("number"==typeof n),e=n}catch(r){Cr("SharedClientState","Failed to read sequence number from WebStorage",r)}return e}(i.newValue))!==_r.o&&this.sequenceNumberHandler(a);else if(i.key===this.Qs)return[2,this.syncEngine.ci()]}else this.Os.push(i);return[2]}))}))}))}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.ks.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Ks=function(){this.setItem(this.$s,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new ac(this.currentUser,t,e,n),i=oc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=oc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){var e={clientId:this.Ns,onlineState:t};this.storage.setItem(this.Us,JSON.stringify(e))},t.prototype.Ys=function(t,e,n){var r=sc(this.persistenceKey,t),i=new uc(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Qs,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return cc.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return ac.Vs(new rc(i),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return uc.Vs(r,e)},t.prototype.js=function(t){return hc.Vs(t)},t.prototype.ii=function(t){return n(this,void 0,void 0,(function(){return r(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(kr("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.ks.insert(t,e):this.ks.remove(t),i=this.Gs(this.ks),o=this.Gs(r),s=[],a=[];return o.forEach((function(t){i.has(t)||s.push(t)})),i.forEach((function(t){o.has(t)||a.push(t)})),this.syncEngine.hi(s,a).then((function(){n.ks=r}))},t.prototype.Ws=function(t){this.ks.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=os();return t.forEach((function(t,n){e=e.unionWith(n.activeTargetIds)})),e},t}(),dc=function(){function t(){this.li=new lc,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new lc,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),pc=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),yc=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){kr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){kr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),vc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},gc=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),mc=function(e){function n(t){var n=this;return(n=e.call(this,t)||this).forceLongPolling=t.forceLongPolling,n.autoDetectLongPolling=t.autoDetectLongPolling,n}return t(n,e),n.prototype.ki=function(t,e,n,r){return new Promise((function(i,o){var s=new Er;s.listenOnce(mr.COMPLETE,(function(){try{switch(s.getLastErrorCode()){case gr.NO_ERROR:var e=s.getResponseJson();kr("Connection","XHR received:",JSON.stringify(e)),i(e);break;case gr.TIMEOUT:kr("Connection",'RPC "'+t+'" timed out'),o(new Dr(Sr.DEADLINE_EXCEEDED,"Request time out"));break;case gr.HTTP_ERROR:var n=s.getStatus();if(kr("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=(u=r.status,c=u.toLowerCase().replace(/_/g,"-"),Object.values(Sr).indexOf(c)>=0?c:Sr.UNKNOWN);o(new Dr(a,r.message))}else o(new Dr(Sr.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new Dr(Sr.UNAVAILABLE,"Connection failed."));break;default:Or()}}finally{kr("Connection",'RPC "'+t+'" completed.')}var u,c}));var a=JSON.stringify(r);s.send(e,"POST",a,n,15)}))},n.prototype.$i=function(t,e){var n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=new fr,i=de(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.Fi(l.initMessageHeaders,e),o()||s()||a()||u()||c()||h()||(l.httpHeadersOverwriteParam="$httpHeaders");var f=n.join("");kr("Connection","Creating WebChannel: "+f,l);var d=r.createWebChannel(f,l),p=!1,y=!1,v=new gc({Ei:function(t){y?kr("Connection","Not sending because WebChannel is closed:",t):(p||(kr("Connection","Opening WebChannel transport."),d.open(),p=!0),kr("Connection","WebChannel sending:",t),d.send(t))},Ti:function(){return d.close()}}),g=function(t,e,n){t.listen(e,(function(t){try{n(t)}catch(e){setTimeout((function(){throw e}),0)}}))};return g(d,Tr.EventType.OPEN,(function(){y||kr("Connection","WebChannel transport opened.")})),g(d,Tr.EventType.CLOSE,(function(){y||(y=!0,kr("Connection","WebChannel transport closed"),v.Vi())})),g(d,Tr.EventType.ERROR,(function(t){y||(y=!0,xr("Connection","WebChannel transport errored:",t),v.Vi(new Dr(Sr.UNAVAILABLE,"The operation could not be completed")))})),g(d,Tr.EventType.MESSAGE,(function(t){var e;if(!y){var n=t.data[0];Pr(!!n);var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){kr("Connection","WebChannel received error:",i);var o=i.status,s=function(t){var e=Uo[t];if(void 0!==e)return zo(e)}(o),a=i.message;void 0===s&&(s=Sr.INTERNAL,a="Unknown error status: "+o+" with message "+i.message),y=!0,v.Vi(new Dr(s,a)),d.close()}else kr("Connection","WebChannel received:",n),v.Si(n)}})),g(i,wr.STAT_EVENT,(function(t){t.stat===br?kr("Connection","Detected buffering proxy"):t.stat===Ir&&kr("Connection","Detected no buffering proxy")})),setTimeout((function(){v.Pi()}),0),v},n}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.Di=e+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);kr("RestConnection","Sending: ",i,n);var o={};return this.Fi(o,r),this.ki(t,i,o,n).then((function(t){return kr("RestConnection","Received: ",t),t}),(function(e){throw xr("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e}))},t.prototype.Oi=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.Fi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.5.0",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){var n=vc[t];return this.Di+"/v1/"+e+":"+n},t}());
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wc(){return"undefined"!=typeof window?window:null}function bc(){return"undefined"!=typeof document?document:null}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ic(t){return new gs(t,!0)}var Tc=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Qi=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Ki=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Qi),i=Math.max(0,n-r);i>0&&kr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,(function(){return e.Qi=Date.now(),t()})),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),Ec=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new Tc(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return n(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,(function(){return t.rr()})))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return n(this,void 0,void 0,(function(){return r(this,(function(t){return this.er()?[2,this.close(0)]:[2]}))}))},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return n(this,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===Sr.RESOURCE_EXHAUSTED?(Cr(e.toString()),Cr("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Ki()):e&&e.code===Sr.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}}))}))},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then((function(e){t.Yi===n&&t.lr(e)}),(function(n){e((function(){var e=new Dr(Sr.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)}))}))},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii((function(){n((function(){return e.state=2,e.listener.Ii()}))})),this.stream.Ri((function(t){n((function(){return e.dr(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji((function(){return n(t,void 0,void 0,(function(){return r(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},t.prototype.dr=function(t){return kr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget((function(){return e.Yi===t?n():(kr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},t}(),_c=function(e){function n(t,n,r,i,o){var s=this;return(s=e.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return t(n,e),n.prototype.wr=function(t){return this.Hi.$i("Listen",t)},n.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n,r;if("targetChange"in e){e.targetChange;var i="NO_CHANGE"===(r=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:Or(),o=e.targetChange.targetIds||[],s=function(t,e){return t.I?(Pr(void 0===e||"string"==typeof e),Jr.fromBase64String(e||"")):(Pr(void 0===e||e instanceof Uint8Array),Jr.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),a=(u=e.targetChange.cause)&&function(t){var e=void 0===t.code?Sr.UNKNOWN:zo(t.code);return new Dr(e,t.message||"")}(u);n=new hs(i,o,s,a||null)}else if("documentChange"in e){e.documentChange,(i=e.documentChange).document,i.document.name,i.document.updateTime,o=Ss(t,i.document.name),s=Is(i.document.updateTime);var u=new Ti({mapValue:{fields:i.document.fields}}),c=(a=_i.newFoundDocument(o,s,u),i.targetIds||[]),h=i.removedTargetIds||[];n=new us(c,h,a.key,a)}else if("documentDelete"in e)e.documentDelete,(i=e.documentDelete).document,o=Ss(t,i.document),s=i.readTime?Is(i.readTime):jr.min(),u=_i.newNoDocument(o,s),a=i.removedTargetIds||[],n=new us([],a,u.key,u);else if("documentRemove"in e)e.documentRemove,(i=e.documentRemove).document,o=Ss(t,i.document),s=i.removedTargetIds||[],n=new us([],s,o,null);else{if(!("filter"in e))return Or();e.filter;var l=e.filter;l.targetId,i=l.count||0,o=new Ko(i),s=l.targetId,n=new cs(s,o)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return jr.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?jr.min():e.readTime?Is(e.readTime):jr.min()}(t);return this.listener._r(e,n)},n.prototype.mr=function(t){var e,n,r,i,o={};o.database=As(this.R),o.addTarget=(e=this.R,i=(n=t).target,(r=ki(i)?{documents:Os(e,i)}:{query:Ps(e,i)}).targetId=n.targetId,n.resumeToken.approximateByteSize()>0?r.resumeToken=ws(e,n.resumeToken):n.snapshotVersion.compareTo(jr.min())>0&&(r.readTime=ms(e,n.snapshotVersion.toTimestamp())),r);var s=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Or()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.R,t);s&&(o.labels=s),this.cr(o)},n.prototype.yr=function(t){var e={};e.database=As(this.R),e.removeTarget=t,this.cr(e)},n}(Ec),Sc=function(e){function n(t,n,r,i,o){var s=this;return(s=e.call(this,t,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return t(n,e),Object.defineProperty(n.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),n.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,e.prototype.start.call(this)},n.prototype.ar=function(){this.gr&&this.Er([])},n.prototype.wr=function(t){return this.Hi.$i("Write",t)},n.prototype.onMessage=function(t){if(Pr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=(r=t.writeResults,i=t.commitTime,r&&r.length>0?(Pr(void 0!==i),r.map((function(t){return n=i,(r=(e=t).updateTime?Is(e.updateTime):Is(n)).isEqual(jr.min())&&(r=Is(n)),new So(r,e.transformResults||[]);var e,n,r}))):[]),n=Is(t.commitTime);return this.listener.Tr(n,e)}var r,i;return Pr(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},n.prototype.Ar=function(){var t={};t.database=As(this.R),this.cr(t)},n.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map((function(t){return xs(e.R,t)}))};this.cr(n)},n}(Ec),Dc=function(e){function n(t,n,r){var i=this;return(i=e.call(this)||this).credentials=t,i.Hi=n,i.R=r,i.Rr=!1,i}return t(n,e),n.prototype.br=function(){if(this.Rr)throw new Dr(Sr.FAILED_PRECONDITION,"The client has already been terminated.")},n.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then((function(i){return r.Hi.Ni(t,e,n,i)})).catch((function(t){throw"FirebaseError"===t.name?(t.code===Sr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new Dr(Sr.UNKNOWN,t.toString())}))},n.prototype.Oi=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then((function(i){return r.Hi.Oi(t,e,n,i)})).catch((function(t){throw"FirebaseError"===t.name?(t.code===Sr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new Dr(Sr.UNKNOWN,t.toString())}))},n.prototype.terminate=function(){this.Rr=!0},n}((function(){})),Nc=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()})))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.Fr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.Fr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(Cr(e),this.Vr=!1):kr("OnlineStateTracker",e)},t.prototype.Fr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),Ac=function(t,e,i,o,s){var a=this;this.localStore=t,this.datastore=e,this.asyncQueue=i,this.remoteSyncer={},this.kr=[],this.Or=new Map,this.$r=new Set,this.Mr=[],this.Lr=s,this.Lr.di((function(t){i.enqueueAndForget((function(){return n(a,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return Fc(this)?(kr("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return n(this,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return(e=Lr(t)).$r.add(4),[4,Cc(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.$r.delete(4),[4,kc(e)];case 2:return n.sent(),[2]}}))}))}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.Br=new Nc(i,o)};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kc(t){return n(this,void 0,void 0,(function(){var e,n;return r(this,(function(r){switch(r.label){case 0:if(!Fc(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function Cc(t){return n(this,void 0,void 0,(function(){var e,n;return r(this,(function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function xc(t,e){var n=Lr(t);n.Or.has(e.targetId)||(n.Or.set(e.targetId,e),Mc(n)?Lc(n):$c(n).er()&&Oc(n,e))}function Rc(t,e){var n=Lr(t),r=$c(n);n.Or.delete(e),r.er()&&Pc(n,e),0===n.Or.size&&(r.er()?r.ir():Fc(n)&&n.Br.set("Unknown"))}function Oc(t,e){t.qr.U(e.targetId),$c(t).mr(e)}function Pc(t,e){t.qr.U(e),$c(t).yr(e)}function Lc(t){t.qr=new fs({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.Or.get(e)||null}}),$c(t).start(),t.Br.Sr()}function Mc(t){return Fc(t)&&!$c(t).tr()&&t.Or.size>0}function Fc(t){return 0===Lr(t).$r.size}function Vc(t){t.qr=void 0}function Uc(t){return n(this,void 0,void 0,(function(){return r(this,(function(e){return t.Or.forEach((function(e,n){Oc(t,e)})),[2]}))}))}function qc(t,e){return n(this,void 0,void 0,(function(){return r(this,(function(n){return Vc(t),Mc(t)?(t.Br.Nr(e),Lc(t)):t.Br.set("Unknown"),[2]}))}))}function Bc(t,e,i){return n(this,void 0,void 0,(function(){var o,s,a;return r(this,(function(u){switch(u.label){case 0:if(t.Br.set("Online"),!(e instanceof hs&&2===e.state&&e.cause))return[3,6];u.label=1;case 1:return u.trys.push([1,3,,5]),[4,function(t,e){return n(this,void 0,void 0,(function(){var n,i,o,s;return r(this,(function(r){switch(r.label){case 0:n=e.cause,i=0,o=e.targetIds,r.label=1;case 1:return i<o.length?(s=o[i],t.Or.has(s)?[4,t.remoteSyncer.rejectListen(s,n)]:[3,3]):[3,5];case 2:r.sent(),t.Or.delete(s),t.qr.removeTarget(s),r.label=3;case 3:r.label=4;case 4:return i++,[3,1];case 5:return[2]}}))}))}(t,e)];case 2:return u.sent(),[3,5];case 3:return o=u.sent(),kr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),o),[4,jc(t,o)];case 4:return u.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof us?t.qr.X(e):e instanceof cs?t.qr.rt(e):t.qr.et(e),i.isEqual(jr.min()))return[3,13];u.label=7;case 7:return u.trys.push([7,11,,13]),[4,Vu(t.localStore)];case 8:return s=u.sent(),i.compareTo(s)>=0?[4,(c=t,h=i,l=c.qr.ut(h),l.targetChanges.forEach((function(t,e){if(t.resumeToken.approximateByteSize()>0){var n=c.Or.get(e);n&&c.Or.set(e,n.withResumeToken(t.resumeToken,h))}})),l.targetMismatches.forEach((function(t){var e=c.Or.get(t);if(e){c.Or.set(t,e.withResumeToken(Jr.EMPTY_BYTE_STRING,e.snapshotVersion)),Pc(c,t);var n=new xa(e.target,t,1,e.sequenceNumber);Oc(c,n)}})),c.remoteSyncer.applyRemoteEvent(l))]:[3,10];case 9:u.sent(),u.label=10;case 10:return[3,13];case 11:return kr("RemoteStore","Failed to raise snapshot:",a=u.sent()),[4,jc(t,a)];case 12:return u.sent(),[3,13];case 13:return[2]}var c,h,l}))}))}function jc(t,e,i){return n(this,void 0,void 0,(function(){var o=this;return r(this,(function(s){switch(s.label){case 0:if(!Ta(e))throw e;return t.$r.add(1),[4,Cc(t)];case 1:return s.sent(),t.Br.set("Offline"),i||(i=function(){return Vu(t.localStore)}),t.asyncQueue.enqueueRetryable((function(){return n(o,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return kr("RemoteStore","Retrying IndexedDB access"),[4,i()];case 1:return e.sent(),t.$r.delete(1),[4,kc(t)];case 2:return e.sent(),[2]}}))}))})),[2]}}))}))}function Kc(t,e){return e().catch((function(n){return jc(t,n,e)}))}function Gc(t){return n(this,void 0,void 0,(function(){var e,n,i,o,s;return r(this,(function(r){switch(r.label){case 0:e=Lr(t),n=Zc(e),i=e.kr.length>0?e.kr[e.kr.length-1].batchId:-1,r.label=1;case 1:if(!(Fc(a=e)&&a.kr.length<10))return[3,7];r.label=2;case 2:return r.trys.push([2,4,,6]),[4,qu(e.localStore,i)];case 3:return null===(o=r.sent())?(0===e.kr.length&&n.ir(),[3,7]):(i=o.batchId,function(t,e){t.kr.push(e);var n=Zc(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,o),[3,6]);case 4:return s=r.sent(),[4,jc(e,s)];case 5:return r.sent(),[3,6];case 6:return[3,1];case 7:return zc(e)&&Qc(e),[2]}var a}))}))}function zc(t){return Fc(t)&&!Zc(t).tr()&&t.kr.length>0}function Qc(t){Zc(t).start()}function Hc(t){return n(this,void 0,void 0,(function(){return r(this,(function(e){return Zc(t).Ar(),[2]}))}))}function Wc(t){return n(this,void 0,void 0,(function(){var e,n,i,o;return r(this,(function(r){for(e=Zc(t),n=0,i=t.kr;n<i.length;n++)o=i[n],e.Er(o.mutations);return[2]}))}))}function Yc(t,e,i){return n(this,void 0,void 0,(function(){var n,o;return r(this,(function(r){switch(r.label){case 0:return n=t.kr.shift(),o=Ca.from(n,e,i),[4,Kc(t,(function(){return t.remoteSyncer.applySuccessfulWrite(o)}))];case 1:return r.sent(),[4,Gc(t)];case 2:return r.sent(),[2]}}))}))}function Xc(t,e){return n(this,void 0,void 0,(function(){return r(this,(function(i){switch(i.label){case 0:return e&&Zc(t).pr?[4,function(t,e){return n(this,void 0,void 0,(function(){var n,i;return r(this,(function(r){switch(r.label){case 0:return Go(i=e.code)&&i!==Sr.ABORTED?(n=t.kr.shift(),Zc(t).sr(),[4,Kc(t,(function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)}))]):[3,3];case 1:return r.sent(),[4,Gc(t)];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))}(t,e)]:[3,2];case 1:i.sent(),i.label=2;case 2:return zc(t)&&Qc(t),[2]}}))}))}function Jc(t,e){return n(this,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:return n=Lr(t),e?(n.$r.delete(2),[4,kc(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.$r.add(2),[4,Cc(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}}))}))}function $c(t){var e,i,o,s,a=this;return t.Ur||(t.Ur=(e=t.datastore,i=t.asyncQueue,o={Ii:Uc.bind(null,t),Ri:qc.bind(null,t),_r:Bc.bind(null,t)},(s=Lr(e)).br(),new _c(i,s.Hi,s.credentials,s.R,o)),t.Mr.push((function(e){return n(a,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return e?(t.Ur.sr(),Mc(t)?Lc(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:n.sent(),Vc(t),n.label=3;case 3:return[2]}}))}))}))),t.Ur}function Zc(t){var e,i,o,s,a=this;return t.Qr||(t.Qr=(e=t.datastore,i=t.asyncQueue,o={Ii:Hc.bind(null,t),Ri:Xc.bind(null,t),Ir:Wc.bind(null,t),Tr:Yc.bind(null,t)},(s=Lr(e)).br(),new Sc(i,s.Hi,s.credentials,s.R,o)),t.Mr.push((function(e){return n(a,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return e?(t.Qr.sr(),[4,Gc(t)]):[3,2];case 1:return n.sent(),[3,4];case 2:return[4,t.Qr.stop()];case 3:n.sent(),t.kr.length>0&&(kr("RemoteStore","Stopping write stream with "+t.kr.length+" pending writes"),t.kr=[]),n.label=4;case 4:return[2]}}))}))}))),t.Qr}var th=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new va,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((function(t){}))}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout((function(){return e.handleDelayElapsed()}),t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Dr(Sr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget((function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then((function(e){return t.deferred.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function eh(t,e){if(Cr("AsyncQueue",e+": "+t),Ta(t))return new Dr(Sr.UNAVAILABLE,e+": "+t);throw t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nh=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||ui.comparator(e.key,n.key)}:function(t,e){return ui.comparator(t.key,e.key)},this.keyedMap=ts(),this.sortedSet=new Qo(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),rh=function(){function t(){this.Kr=new Qo(ui.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Kr.get(e);n?0!==t.type&&3===n.type?this.Kr=this.Kr.insert(e,t):3===t.type&&1!==n.type?this.Kr=this.Kr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Kr=this.Kr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Kr=this.Kr.remove(e):1===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):Or():this.Kr=this.Kr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Kr.inorderTraversal((function(e,n){t.push(n)})),t},t}(),ih=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:0,doc:t})})),new t(e,n,nh.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&no(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),oh=function(){this.Wr=void 0,this.listeners=[]},sh=function(){this.queries=new gu((function(t){return ro(t)}),no),this.onlineState="Unknown",this.Gr=new Set};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ah(t,e){return n(this,void 0,void 0,(function(){var n,i,o,s,a,u,c;return r(this,(function(r){switch(r.label){case 0:if(n=Lr(t),i=e.query,o=!1,(s=n.queries.get(i))||(o=!0,s=new oh),!o)return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),a=s,[4,n.onListen(i)];case 2:return a.Wr=r.sent(),[3,4];case 3:return u=r.sent(),c=eh(u,"Initialization of query '"+io(e.query)+"' failed"),[2,void e.onError(c)];case 4:return n.queries.set(i,s),s.listeners.push(e),e.zr(n.onlineState),s.Wr&&e.Hr(s.Wr)&&lh(n),[2]}}))}))}function uh(t,e){return n(this,void 0,void 0,(function(){var n,i,o,s,a;return r(this,(function(r){return n=Lr(t),i=e.query,o=!1,(s=n.queries.get(i))&&(a=s.listeners.indexOf(e))>=0&&(s.listeners.splice(a,1),o=0===s.listeners.length),o?[2,(n.queries.delete(i),n.onUnlisten(i))]:[2]}))}))}function ch(t,e){for(var n=Lr(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=s.query,u=n.queries.get(a);if(u){for(var c=0,h=u.listeners;c<h.length;c++)h[c].Hr(s)&&(r=!0);u.Wr=s}}r&&lh(n)}function hh(t,e,n){var r=Lr(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function lh(t){t.Gr.forEach((function(t){t.next()}))}var fh=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new ih(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.so&&n||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){if(t.docChanges.length>0)return!0;var e=this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=ih.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),dh=function(t){this.key=t},ph=function(t){this.key=t},yh=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=rs(),this.mutatedKeys=rs(),this.lo=so(t),this.fo=new nh(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new rh,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=Wi(this.query)&&i.size===this.query.limit?i.last():null,c=Yi(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((function(t,e){var h=i.get(t),l=oo(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),d=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),p=!1;h&&l?h.data.isEqual(l.data)?f!==d&&(r.track({type:3,doc:l}),p=!0):n.yo(h,l)||(r.track({type:2,doc:l}),p=!0,(u&&n.lo(l,u)>0||c&&n.lo(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),p=!0):h&&!l&&(r.track({type:1,doc:h}),p=!0,(u||c)&&(a=!0)),p&&(l?(s=s.add(l),o=d?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))})),Wi(this.query)||Yi(this.query))for(;s.size>this.query.limit;){var h=Wi(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort((function(t,e){return n=t.type,i=e.type,(o=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Or()}})(n)-o(i)||r.lo(t.doc,e.doc);var n,i,o})),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,u=a!==this.ao;return this.ao=a,0!==o.length||u?{snapshot:new ih(this.query,t.fo,i,o,t.mutatedKeys,0===a,u,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new rh,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach((function(t){return e.uo=e.uo.add(t)})),t.modifiedDocuments.forEach((function(t){})),t.removedDocuments.forEach((function(t){return e.uo=e.uo.delete(t)})),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=rs(),this.fo.forEach((function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))}));var n=[];return e.forEach((function(e){t.ho.has(e)||n.push(new ph(e))})),this.ho.forEach((function(t){e.has(t)||n.push(new dh(t))})),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=rs();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return ih.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),vh=function(t,e,n){this.query=t,this.targetId=e,this.view=n},gh=function(t){this.key=t,this.bo=!1},mh=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new gu((function(t){return ro(t)}),no),this.Vo=new Map,this.So=new Set,this.Do=new Qo(ui.comparator),this.Co=new Map,this.No=new Wu,this.xo={},this.Fo=new Map,this.ko=ou.Yt(),this.onlineState="Unknown",this.Oo=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.Oo},enumerable:!1,configurable:!0}),t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wh(t,e){return n(this,void 0,void 0,(function(){var n,i,o,s,a,u;return r(this,(function(r){switch(r.label){case 0:return n=Wh(t),(s=n.Po.get(e))?(i=s.targetId,n.sharedClientState.addLocalQueryTarget(i),o=s.view.Ro(),[3,4]):[3,1];case 1:return[4,Bu(n.localStore,to(e))];case 2:return a=r.sent(),u=n.sharedClientState.addLocalQueryTarget(a.targetId),i=a.targetId,[4,bh(n,e,i,"current"===u)];case 3:o=r.sent(),n.isPrimaryClient&&xc(n.remoteStore,a),r.label=4;case 4:return[2,o]}}))}))}function bh(t,e,i,o){return n(this,void 0,void 0,(function(){var s,a,u,c,h,l;return r(this,(function(f){switch(f.label){case 0:return t.$o=function(e,i,o){return function(t,e,i,o){return n(this,void 0,void 0,(function(){var n,s,a;return r(this,(function(r){switch(r.label){case 0:return(n=e.view._o(i)).Nn?[4,Ku(t.localStore,e.query,!1).then((function(t){var r=t.documents;return e.view._o(r,n)}))]:[3,2];case 1:n=r.sent(),r.label=2;case 2:return s=o&&o.targetChanges.get(e.targetId),a=e.view.applyChanges(n,t.isPrimaryClient,s),[2,(Oh(t,e.targetId,a.To),a.snapshot)]}}))}))}(t,e,i,o)},[4,Ku(t.localStore,e,!0)];case 1:return s=f.sent(),a=new yh(e,s.Bn),u=a._o(s.documents),c=as.createSynthesizedTargetChangeForCurrentChange(i,o&&"Offline"!==t.onlineState),h=a.applyChanges(u,t.isPrimaryClient,c),Oh(t,i,h.To),l=new vh(e,i,a),[2,(t.Po.set(e,l),t.Vo.has(i)?t.Vo.get(i).push(e):t.Vo.set(i,[e]),h.snapshot)]}}))}))}function Ih(t,e){return n(this,void 0,void 0,(function(){var n,i,o;return r(this,(function(r){switch(r.label){case 0:return n=Lr(t),i=n.Po.get(e),(o=n.Vo.get(i.targetId)).length>1?[2,(n.Vo.set(i.targetId,o.filter((function(t){return!no(t,e)}))),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)?[3,2]:[4,ju(n.localStore,i.targetId,!1).then((function(){n.sharedClientState.clearQueryState(i.targetId),Rc(n.remoteStore,i.targetId),xh(n,i.targetId)})).catch(hu)]):[3,3];case 1:r.sent(),r.label=2;case 2:return[3,5];case 3:return xh(n,i.targetId),[4,ju(n.localStore,i.targetId,!0)];case 4:r.sent(),r.label=5;case 5:return[2]}}))}))}function Th(t,e,i){return n(this,void 0,void 0,(function(){var n,o,s,a;return r(this,(function(r){switch(r.label){case 0:n=Yh(t),r.label=1;case 1:return r.trys.push([1,5,,6]),[4,(u=n.localStore,c=e,l=Lr(u),f=Br.now(),d=c.reduce((function(t,e){return t.add(e.key)}),rs()),l.persistence.runTransaction("Locally write mutations","readwrite",(function(t){return l.Mn.pn(t,d).next((function(e){h=e;for(var n=[],r=0,i=c;r<i.length;r++){var o=i[r],s=xo(o,h.get(o.key));null!=s&&n.push(new Lo(o.key,s,Ei(s.toProto().mapValue),Do.exists(!0)))}return l._n.addMutationBatch(t,f,n,c)}))})).then((function(t){return t.applyToLocalDocumentSet(h),{batchId:t.batchId,changes:h}})))];case 2:return o=r.sent(),n.sharedClientState.addPendingMutation(o.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new Qo(Vr)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(n,o.batchId,i),[4,Mh(n,o.changes)];case 3:return r.sent(),[4,Gc(n.remoteStore)];case 4:return r.sent(),[3,6];case 5:return s=r.sent(),a=eh(s,"Failed to persist write"),i.reject(a),[3,6];case 6:return[2]}var u,c,h,l,f,d}))}))}function Eh(t,e){return n(this,void 0,void 0,(function(){var n,i;return r(this,(function(r){switch(r.label){case 0:n=Lr(t),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,Uu(n.localStore,e)];case 2:return i=r.sent(),e.targetChanges.forEach((function(t,e){var r=n.Co.get(e);r&&(Pr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?Pr(r.bo):t.removedDocuments.size>0&&(Pr(r.bo),r.bo=!1))})),[4,Mh(n,i,e)];case 3:return r.sent(),[3,6];case 4:return[4,hu(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))}function _h(t,e,n){var r=Lr(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach((function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)})),function(t,e){var n=Lr(t);n.onlineState=e;var r=!1;n.queries.forEach((function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)})),r&&lh(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Sh(t,e,i){return n(this,void 0,void 0,(function(){var n,o,s,a,u,c;return r(this,(function(r){switch(r.label){case 0:return(n=Lr(t)).sharedClientState.updateQueryState(e,"rejected",i),o=n.Co.get(e),(s=o&&o.key)?(a=(a=new Qo(ui.comparator)).insert(s,_i.newNoDocument(s,jr.min())),u=rs().add(s),c=new ss(jr.min(),new Map,new Yo(Vr),a,u),[4,Eh(n,c)]):[3,2];case 1:return r.sent(),n.Do=n.Do.remove(s),n.Co.delete(e),Lh(n),[3,4];case 2:return[4,ju(n.localStore,e,!1).then((function(){return xh(n,e,i)})).catch(hu)];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))}function Dh(t,e){return n(this,void 0,void 0,(function(){var n,i,o;return r(this,(function(r){switch(r.label){case 0:n=Lr(t),i=e.batch.batchId,r.label=1;case 1:return r.trys.push([1,4,,6]),[4,Fu(n.localStore,e)];case 2:return o=r.sent(),Ch(n,i,null),kh(n,i),n.sharedClientState.updateMutationState(i,"acknowledged"),[4,Mh(n,o)];case 3:return r.sent(),[3,6];case 4:return[4,hu(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))}function Nh(t,e,i){return n(this,void 0,void 0,(function(){var n,o;return r(this,(function(r){switch(r.label){case 0:n=Lr(t),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,(s=n.localStore,a=e,u=Lr(s),u.persistence.runTransaction("Reject batch","readwrite-primary",(function(t){var e;return u._n.lookupMutationBatch(t,a).next((function(n){return Pr(null!==n),e=n.keys(),u._n.removeMutationBatch(t,n)})).next((function(){return u._n.performConsistencyCheck(t)})).next((function(){return u.Mn.pn(t,e)}))})))];case 2:return o=r.sent(),Ch(n,e,i),kh(n,e),n.sharedClientState.updateMutationState(e,"rejected",i),[4,Mh(n,o)];case 3:return r.sent(),[3,6];case 4:return[4,hu(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}var s,a,u}))}))}function Ah(t,e){return n(this,void 0,void 0,(function(){var n,i,o,s,a;return r(this,(function(r){switch(r.label){case 0:Fc((n=Lr(t)).remoteStore)||kr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,(u=n.localStore,c=Lr(u),c.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(t){return c._n.getHighestUnacknowledgedBatchId(t)})))];case 2:return-1===(i=r.sent())?[2,void e.resolve()]:((o=n.Fo.get(i)||[]).push(e),n.Fo.set(i,o),[3,4]);case 3:return s=r.sent(),a=eh(s,"Initialization of waitForPendingWrites() operation failed"),e.reject(a),[3,4];case 4:return[2]}var u,c}))}))}function kh(t,e){(t.Fo.get(e)||[]).forEach((function(t){t.resolve()})),t.Fo.delete(e)}function Ch(t,e,n){var r=Lr(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function xh(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach((function(e){t.No.containsKey(e)||Rh(t,e)}))}function Rh(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(Rc(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),Lh(t))}function Oh(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof dh?(t.No.addReference(o.key,e),Ph(t,o)):o instanceof ph?(kr("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||Rh(t,o.key)):Or()}}function Ph(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(kr("SyncEngine","New document in limbo: "+n),t.So.add(r),Lh(t))}function Lh(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new ui(Hr.fromString(e)),r=t.ko.next();t.Co.set(r,new gh(n)),t.Do=t.Do.insert(n,r),xc(t.remoteStore,new xa(to(Hi(n.path)),r,2,_r.o))}}function Mh(t,e,i){return n(this,void 0,void 0,(function(){var o,s,a,u;return r(this,(function(c){switch(c.label){case 0:return o=Lr(t),s=[],a=[],u=[],o.Po.isEmpty()?[3,3]:(o.Po.forEach((function(t,n){u.push(o.$o(n,e,i).then((function(t){if(t){o.isPrimaryClient&&o.sharedClientState.updateQueryState(n.targetId,t.fromCache?"not-current":"current"),s.push(t);var e=Ru.Pn(n.targetId,t);a.push(e)}})))})),[4,Promise.all(u)]);case 1:return c.sent(),o.vo._r(s),[4,function(t,e){return n(this,void 0,void 0,(function(){var n,i,o,s,a,u,c,h,l;return r(this,(function(r){switch(r.label){case 0:n=Lr(t),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(t){return ga.forEach(e,(function(e){return ga.forEach(e.bn,(function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)})).next((function(){return ga.forEach(e.vn,(function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)}))}))}))}))];case 2:return r.sent(),[3,4];case 3:if(!Ta(i=r.sent()))throw i;return kr("LocalStore","Failed to update sequence numbers: "+i),[3,4];case 4:for(o=0,s=e;o<s.length;o++)a=s[o],u=a.targetId,a.fromCache||(c=n.Fn.get(u),h=c.snapshotVersion,l=c.withLastLimboFreeSnapshotVersion(h),n.Fn=n.Fn.insert(u,l));return[2]}}))}))}(o.localStore,a)];case 2:c.sent(),c.label=3;case 3:return[2]}}))}))}function Fh(t,e){return n(this,void 0,void 0,(function(){var n,i;return r(this,(function(r){switch(r.label){case 0:return(n=Lr(t)).currentUser.isEqual(e)?[3,3]:(kr("SyncEngine","User change. New user:",e.toKey()),[4,Mu(n.localStore,e)]);case 1:return i=r.sent(),n.currentUser=e,(o=n).Fo.forEach((function(t){t.forEach((function(t){t.reject(new Dr(Sr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),o.Fo.clear(),n.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),[4,Mh(n,i.Ln)];case 2:r.sent(),r.label=3;case 3:return[2]}var o}))}))}function Vh(t,e){var n=Lr(t),r=n.Co.get(e);if(r&&r.bo)return rs().add(r.key);var i=rs(),o=n.Vo.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=a[s],c=n.Po.get(u);i=i.unionWith(c.view.wo)}return i}function Uh(t,e){return n(this,void 0,void 0,(function(){var n,i,o;return r(this,(function(r){switch(r.label){case 0:return[4,Ku((n=Lr(t)).localStore,e.query,!0)];case 1:return i=r.sent(),o=e.view.Ao(i),[2,(n.isPrimaryClient&&Oh(n,e.targetId,o.To),o)]}}))}))}function qh(t){return n(this,void 0,void 0,(function(){var e;return r(this,(function(n){return[2,zu((e=Lr(t)).localStore).then((function(t){return Mh(e,t)}))]}))}))}function Bh(t,e,i,o){return n(this,void 0,void 0,(function(){var n,s;return r(this,(function(r){switch(r.label){case 0:return[4,(a=(n=Lr(t)).localStore,u=e,c=Lr(a),h=Lr(c._n),c.persistence.runTransaction("Lookup mutation documents","readonly",(function(t){return h.jt(t,u).next((function(e){return e?c.Mn.pn(t,e):ga.resolve(null)}))})))];case 1:return null===(s=r.sent())?[3,6]:"pending"!==i?[3,3]:[4,Gc(n.remoteStore)];case 2:return r.sent(),[3,4];case 3:"acknowledged"===i||"rejected"===i?(Ch(n,e,o||null),kh(n,e),function(t,e){Lr(Lr(t)._n).Gt(e)}(n.localStore,e)):Or(),r.label=4;case 4:return[4,Mh(n,s)];case 5:return r.sent(),[3,7];case 6:kr("SyncEngine","Cannot apply mutation batch with id: "+e),r.label=7;case 7:return[2]}var a,u,c,h}))}))}function jh(t,e){return n(this,void 0,void 0,(function(){var n,i,o,s,a,u,c,h;return r(this,(function(r){switch(r.label){case 0:return Wh(n=Lr(t)),Yh(n),!0!==e||!0===n.Oo?[3,3]:(i=n.sharedClientState.getAllActiveQueryTargets(),[4,Kh(n,i.toArray())]);case 1:return o=r.sent(),n.Oo=!0,[4,Jc(n.remoteStore,!0)];case 2:for(r.sent(),s=0,a=o;s<a.length;s++)u=a[s],xc(n.remoteStore,u);return[3,7];case 3:return!1!==e||!1===n.Oo?[3,7]:(c=[],h=Promise.resolve(),n.Vo.forEach((function(t,e){n.sharedClientState.isLocalQueryTarget(e)?c.push(e):h=h.then((function(){return xh(n,e),ju(n.localStore,e,!0)})),Rc(n.remoteStore,e)})),[4,h]);case 4:return r.sent(),[4,Kh(n,c)];case 5:return r.sent(),(l=Lr(n)).Co.forEach((function(t,e){Rc(l.remoteStore,e)})),l.No.ts(),l.Co=new Map,l.Do=new Qo(ui.comparator),n.Oo=!1,[4,Jc(n.remoteStore,!1)];case 6:r.sent(),r.label=7;case 7:return[2]}var l}))}))}function Kh(t,e,i){return n(this,void 0,void 0,(function(){var n,i,o,s,a,u,c,h,l,f,d,p,y,v;return r(this,(function(r){switch(r.label){case 0:n=Lr(t),i=[],o=[],s=0,a=e,r.label=1;case 1:return s<a.length?(u=a[s],c=void 0,(h=n.Vo.get(u))&&0!==h.length?[4,Bu(n.localStore,to(h[0]))]:[3,7]):[3,13];case 2:c=r.sent(),l=0,f=h,r.label=3;case 3:return l<f.length?(d=f[l],p=n.Po.get(d),[4,Uh(n,p)]):[3,6];case 4:(y=r.sent()).snapshot&&o.push(y.snapshot),r.label=5;case 5:return l++,[3,3];case 6:return[3,11];case 7:return[4,Gu(n.localStore,u)];case 8:return v=r.sent(),[4,Bu(n.localStore,v)];case 9:return c=r.sent(),[4,bh(n,Gh(v),u,!1)];case 10:r.sent(),r.label=11;case 11:i.push(c),r.label=12;case 12:return s++,[3,1];case 13:return[2,(n.vo._r(o),i)]}}))}))}function Gh(t){return Qi(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function zh(t){var e=Lr(t);return Lr(Lr(e.localStore).persistence).fn()}function Qh(t,e,i,o){return n(this,void 0,void 0,(function(){var n,s,a;return r(this,(function(r){switch(r.label){case 0:return(n=Lr(t)).Oo?(kr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!n.Vo.has(e))return[3,8];switch(i){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,zu(n.localStore)];case 3:return s=r.sent(),a=ss.createSynthesizedRemoteEventForCurrentChange(e,"current"===i),[4,Mh(n,s,a)];case 4:return r.sent(),[3,8];case 5:return[4,ju(n.localStore,e,!0)];case 6:return r.sent(),xh(n,e,o),[3,8];case 7:Or(),r.label=8;case 8:return[2]}}))}))}function Hh(t,e,i){return n(this,void 0,void 0,(function(){var n,o,s,a,u,c,h,l,f,d;return r(this,(function(p){switch(p.label){case 0:if(!(n=Wh(t)).Oo)return[3,10];o=0,s=e,p.label=1;case 1:return o<s.length?(a=s[o],n.Vo.has(a)?(kr("SyncEngine","Adding an already active target "+a),[3,5]):[4,Gu(n.localStore,a)]):[3,6];case 2:return u=p.sent(),[4,Bu(n.localStore,u)];case 3:return c=p.sent(),[4,bh(n,Gh(u),c.targetId,!1)];case 4:p.sent(),xc(n.remoteStore,c),p.label=5;case 5:return o++,[3,1];case 6:h=function(t){return r(this,(function(e){switch(e.label){case 0:return n.Vo.has(t)?[4,ju(n.localStore,t,!1).then((function(){Rc(n.remoteStore,t),xh(n,t)})).catch(hu)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},l=0,f=i,p.label=7;case 7:return l<f.length?(d=f[l],[5,h(d)]):[3,10];case 8:p.sent(),p.label=9;case 9:return l++,[3,7];case 10:return[2]}}))}))}function Wh(t){var e=Lr(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Eh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Vh.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Sh.bind(null,e),e.vo._r=ch.bind(null,e.eventManager),e.vo.Mo=hh.bind(null,e.eventManager),e}function Yh(t){var e=Lr(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Dh.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Nh.bind(null,e),e}var Xh=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return n(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return this.R=Ic(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Qo(t),[2]}}))}))},t.prototype.Uo=function(t){return null},t.prototype.Qo=function(t){return Lu(this.persistence,new Ou,t.initialUser,this.R)},t.prototype.qo=function(t){return new tc(nc.bs,this.R)},t.prototype.Bo=function(t){return new dc},t.prototype.terminate=function(){return n(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}}))}))},t}(),Jh=function(e){function i(t,n,r){var i=this;return(i=e.call(this)||this).Ko=t,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return t(i,e),i.prototype.initialize=function(t){return n(this,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return[4,e.prototype.initialize.call(this,t)];case 1:return n.sent(),[4,Qu(this.localStore)];case 2:return n.sent(),[4,this.Ko.initialize(this,t)];case 3:return n.sent(),[4,Yh(this.Ko.syncEngine)];case 4:return n.sent(),[4,Gc(this.Ko.remoteStore)];case 5:return n.sent(),[2]}}))}))},i.prototype.Qo=function(t){return Lu(this.persistence,new Ou,t.initialUser,this.R)},i.prototype.Uo=function(t){var e=this.persistence.referenceDelegate.garbageCollector;return new du(e,t.asyncQueue)},i.prototype.qo=function(t){var e=Cu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Ja.withCacheSize(this.cacheSizeBytes):Ja.DEFAULT;return new Nu(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,wc(),bc(),this.R,this.sharedClientState,!!this.forceOwnership)},i.prototype.Bo=function(t){return new dc},i}(Xh),$h=function(e){function i(t,n){var r=this;return(r=e.call(this,t,n,!1)||this).Ko=t,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return t(i,e),i.prototype.initialize=function(t){return n(this,void 0,void 0,(function(){var i,o=this;return r(this,(function(s){switch(s.label){case 0:return[4,e.prototype.initialize.call(this,t)];case 1:return s.sent(),i=this.Ko.syncEngine,this.sharedClientState instanceof fc?(this.sharedClientState.syncEngine={ui:Bh.bind(null,i),ai:Qh.bind(null,i),hi:Hh.bind(null,i),fn:zh.bind(null,i),ci:qh.bind(null,i)},[4,this.sharedClientState.start()]):[3,3];case 2:s.sent(),s.label=3;case 3:return[4,this.persistence.He((function(t){return n(o,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,jh(this.Ko.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}}))}))}))];case 4:return s.sent(),[2]}}))}))},i.prototype.Bo=function(t){var e=wc();if(!fc.yt(e))throw new Dr(Sr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Cu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new fc(e,t.asyncQueue,n,t.clientId,t.initialUser)},i}(Jh),Zh=function(){function t(){}return t.prototype.initialize=function(t,e){return n(this,void 0,void 0,(function(){var n=this;return r(this,(function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return _h(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Fh.bind(null,this.syncEngine),[4,Jc(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.createEventManager=function(t){return new sh},t.prototype.createDatastore=function(t){var e,n,r=Ic(t.databaseInfo.databaseId),i=(e=t.databaseInfo,new mc(e));return n=t.credentials,new Dc(n,i,r)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return _h(s.syncEngine,t,0)},o=yc.yt()?new yc:new pc,new Ac(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return n=this.localStore,r=this.remoteStore,i=this.eventManager,o=this.sharedClientState,s=t.initialUser,a=t.maxConcurrentLimboResolutions,u=e,c=new mh(n,r,i,o,s,a),u&&(c.Oo=!0),c;var n,r,i,o,s,a,u,c},t.prototype.terminate=function(){return function(t){return n(this,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return e=Lr(t),kr("RemoteStore","RemoteStore shutting down."),e.$r.add(5),[4,Cc(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}}))}))}(this.remoteStore)},t}(),tl=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}(),el=function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return n(this,void 0,void 0,(function(){var e,i=this;return r(this,(function(o){switch(o.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new Dr(Sr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return n(this,void 0,void 0,(function(){var n,i,o,s,a,u;return r(this,(function(r){switch(r.label){case 0:return n=Lr(t),i=As(n.R)+"/documents",o={documents:e.map((function(t){return _s(n.R,t)}))},[4,n.Oi("BatchGetDocuments",i,o)];case 1:return s=r.sent(),a=new Map,s.forEach((function(t){var e,r,i=(e=n.R,"found"in(r=t)?function(t,e){Pr(!!e.found),e.found.name,e.found.updateTime;var n=Ss(t,e.found.name),r=Is(e.found.updateTime),i=new Ti({mapValue:{fields:e.found.fields}});return _i.newFoundDocument(n,r,i)}(e,r):"missing"in r?function(t,e){Pr(!!e.missing),Pr(!!e.readTime);var n=Ss(t,e.missing),r=Is(e.readTime);return _i.newNoDocument(n,r)}(e,r):Or());a.set(i.key.toString(),i)})),u=[],[2,(e.forEach((function(t){var e=a.get(t.toString());Pr(!!e),u.push(e)})),u)]}}))}))}(this.datastore,t)];case 1:return[2,((e=o.sent()).forEach((function(t){return i.recordVersion(t)})),e)]}}))}))},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(n){this.lastWriteError=n}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new Bo(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return n(this,void 0,void 0,(function(){var t,e=this;return r(this,(function(i){switch(i.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,n){var r=ui.fromPath(n);e.mutations.push(new jo(r,e.precondition(r)))})),[4,function(t,e){return n(this,void 0,void 0,(function(){var n,i,o;return r(this,(function(r){switch(r.label){case 0:return n=Lr(t),i=As(n.R)+"/documents",o={writes:e.map((function(t){return xs(n.R,t)}))},[4,n.Ni("Commit",i,o)];case 1:return r.sent(),[2]}}))}))}(this.datastore,this.mutations)];case 1:return i.sent(),this.committed=!0,[2]}}))}))},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw Or();e=jr.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Dr(Sr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?Do.updateTime(e):Do.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(jr.min()))throw new Dr(Sr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Do.updateTime(e)}return Do.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}(),nl=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new Tc(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji((function(){return n(t,void 0,void 0,(function(){var t,e,n=this;return r(this,(function(r){return t=new el(this.datastore),(e=this.sc(t))&&e.then((function(e){n.asyncQueue.enqueueAndForget((function(){return t.commit().then((function(){n.deferred.resolve(e)})).catch((function(t){n.ic(t)}))}))})).catch((function(t){n.ic(t)})),[2]}))}))}))},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!oi(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(n){return this.deferred.reject(n),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget((function(){return e.nc(),Promise.resolve()}))):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!Go(e)}return!1},t}(),rl=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=rc.UNAUTHENTICATED,this.clientId=Fr.u(),this.credentialListener=function(){},this.receivedInitialUser=new va,this.credentials.setChangeListener((function(t){kr("FirestoreClient","Received user=",t.uid),r.user=t,r.credentialListener(t),r.receivedInitialUser.resolve()}))}return t.prototype.getConfiguration=function(){return n(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,this.receivedInitialUser.promise];case 1:return[2,(t.sent(),{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100})]}}))}))},t.prototype.setCredentialChangeListener=function(t){var e=this;this.credentialListener=t,this.receivedInitialUser.promise.then((function(){return e.credentialListener(e.user)}))},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Dr(Sr.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new va;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((function(){return n(t,void 0,void 0,(function(){var t,n;return r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=eh(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}}))}))})),e.promise},t}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function il(t,e){return n(this,void 0,void 0,(function(){var i,o,s=this;return r(this,(function(a){switch(a.label){case 0:return t.asyncQueue.verifyOperationInProgress(),kr("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return i=a.sent(),[4,e.initialize(i)];case 2:return a.sent(),o=i.initialUser,t.setCredentialChangeListener((function(i){o.isEqual(i)||(o=i,t.asyncQueue.enqueueRetryable((function(){return n(s,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,Mu(e.localStore,i)];case 1:return t.sent(),[2]}}))}))})))})),e.persistence.setDatabaseDeletedListener((function(){return t.terminate()})),t.offlineComponents=e,[2]}}))}))}function ol(t,e){return n(this,void 0,void 0,(function(){var i,o;return r(this,(function(s){switch(s.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,sl(t)];case 1:return i=s.sent(),kr("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return o=s.sent(),[4,e.initialize(i,o)];case 3:return s.sent(),t.setCredentialChangeListener((function(i){return t.asyncQueue.enqueueRetryable((function(){return function(t,e){return n(this,void 0,void 0,(function(){var n,i;return r(this,(function(r){switch(r.label){case 0:return(n=Lr(t)).asyncQueue.verifyOperationInProgress(),kr("RemoteStore","RemoteStore received new credentials"),i=Fc(n),n.$r.add(3),[4,Cc(n)];case 1:return r.sent(),i&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return r.sent(),n.$r.delete(3),[4,kc(n)];case 3:return r.sent(),[2]}}))}))}(e.remoteStore,i)}))})),t.onlineComponents=e,[2]}}))}))}function sl(t){return n(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(kr("FirestoreClient","Using default OfflineComponentProvider"),[4,il(t,new Xh)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}}))}))}function al(t){return n(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(kr("FirestoreClient","Using default OnlineComponentProvider"),[4,ol(t,new Zh)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}}))}))}function ul(t){return sl(t).then((function(t){return t.persistence}))}function cl(t){return sl(t).then((function(t){return t.localStore}))}function hl(t){return al(t).then((function(t){return t.remoteStore}))}function ll(t){return al(t).then((function(t){return t.syncEngine}))}function fl(t){return n(this,void 0,void 0,(function(){var e,n;return r(this,(function(r){switch(r.label){case 0:return[4,al(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=wh.bind(null,e.syncEngine),n.onUnlisten=Ih.bind(null,e.syncEngine),n)]}}))}))}function dl(t,e,i){var o=this;void 0===i&&(i={});var s=new va;return t.asyncQueue.enqueueAndForget((function(){return n(o,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:return n=function(t,e,n,r,i){var o=new tl({next:function(o){e.enqueueAndForget((function(){return uh(t,s)}));var a=o.docs.has(n);!a&&o.fromCache?i.reject(new Dr(Sr.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new Dr(Sr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new fh(Hi(n.path),o,{includeMetadataChanges:!0,so:!0});return ah(t,s)},[4,fl(t)];case 1:return[2,n.apply(void 0,[r.sent(),t.asyncQueue,e,i,s])]}}))}))})),s.promise}function pl(t,e,i){var o=this;void 0===i&&(i={});var s=new va;return t.asyncQueue.enqueueAndForget((function(){return n(o,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:return n=function(t,e,n,r,i){var o=new tl({next:function(n){e.enqueueAndForget((function(){return uh(t,s)})),n.fromCache&&"server"===r.source?i.reject(new Dr(Sr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new fh(n,o,{includeMetadataChanges:!0,so:!0});return ah(t,s)},[4,fl(t)];case 1:return[2,n.apply(void 0,[r.sent(),t.asyncQueue,e,i,s])]}}))}))})),s.promise}var yl=function(t,e,n,r,i,o,s){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s},vl=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),gl=new Map,ml=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},wl=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t){this.changeListener=t,t(rc.UNAUTHENTICATED)},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),bl=function(){function t(t){this.token=t,this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(this.token)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t){this.changeListener=t,t(this.token.user)},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Il=function(){function t(t){var e=this;this.oc=null,this.currentUser=rc.UNAUTHENTICATED,this.receivedInitialUser=!1,this.cc=0,this.changeListener=null,this.forceRefresh=!1,this.oc=function(){e.cc++,e.currentUser=e.uc(),e.receivedInitialUser=!0,e.changeListener&&e.changeListener(e.currentUser)},this.cc=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.oc):(this.oc(null),t.get().then((function(t){e.auth=t,e.oc&&e.auth.addAuthTokenListener(e.oc)}),(function(){})))}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.cc!==e?(kr("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(Pr("string"==typeof n.accessToken),new ml(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t){this.changeListener=t,this.receivedInitialUser&&t(this.currentUser)},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.oc),this.oc=null,this.changeListener=null},t.prototype.uc=function(){var t=this.auth&&this.auth.getUid();return Pr(null===t||"string"==typeof t),new rc(t)},t}(),Tl=function(){function t(t,e,n){this.ac=t,this.hc=e,this.lc=n,this.type="FirstParty",this.user=rc.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.hc},e=this.ac.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.lc&&(t["X-Goog-Iam-Authorization-Token"]=this.lc),t},enumerable:!1,configurable:!0}),t}(),El=function(){function t(t,e,n){this.ac=t,this.hc=e,this.lc=n}return t.prototype.getToken=function(){return Promise.resolve(new Tl(this.ac,this.hc,this.lc))},t.prototype.setChangeListener=function(t){t(rc.FIRST_PARTY)},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _l(t,e,n){if(!n)throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function Sl(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Dl(t,e,n,r){if(!0===e&&!0===r)throw new Dr(Sr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function Nl(t){if(!ui.isDocumentKey(t))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function Al(t){if(ui.isDocumentKey(t))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function kl(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":Or()}function Cl(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Dr(Sr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=kl(t);throw new Dr(Sr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function xl(t,e){if(e<=0)throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Rl=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Dr(Sr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Dr(Sr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,Dl("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},t}(),Ol=function(){function t(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Rl({}),this._settingsFrozen=!1,t instanceof vl?(this._databaseId=t,this._credentials=new wl):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Dr(Sr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new vl(t.options.projectId)}(t),this._credentials=new Il(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new Dr(Sr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new Dr(Sr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Rl(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new wl;switch(t.type){case"gapi":var e=t.client;return Pr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new El(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new Dr(Sr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return this,(t=gl.get(this))&&(kr("ComponentProvider","Removing Datastore"),gl.delete(this),t.terminate()),Promise.resolve();var t},t}(),Pl=function(){function t(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Ml(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),Ll=function(){function t(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),Ml=function(e){function n(t,n,r){var i=this;return(i=e.call(this,t,n,Hi(r))||this)._path=r,i.type="collection",i}return t(n,e),Object.defineProperty(n.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new Pl(this.firestore,null,new ui(t))},enumerable:!1,configurable:!0}),n.prototype.withConverter=function(t){return new n(this.firestore,t,this._path)},n}(Ll);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fl(t,n){for(var r,i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];if(t=l(t),_l("collection","path",n),t instanceof Ol)return Al(r=Hr.fromString.apply(Hr,e([n],i))),new Ml(t,null,r);if(!(t instanceof Pl||t instanceof Ml))throw new Dr(Sr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Al(r=Hr.fromString.apply(Hr,e([t.path],i)).child(Hr.fromString(n))),new Ml(t.firestore,null,r)}function Vl(t,n){for(var r,i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];if(t=l(t),1===arguments.length&&(n=Fr.u()),_l("doc","path",n),t instanceof Ol)return Nl(r=Hr.fromString.apply(Hr,e([n],i))),new Pl(t,null,new ui(r));if(!(t instanceof Pl||t instanceof Ml))throw new Dr(Sr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Nl(r=t._path.child(Hr.fromString.apply(Hr,e([n],i)))),new Pl(t.firestore,t instanceof Ml?t.converter:null,new ui(r))}function Ul(t,e){return t=l(t),e=l(e),(t instanceof Pl||t instanceof Ml)&&(e instanceof Pl||e instanceof Ml)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function ql(t,e){return t=l(t),e=l(e),t instanceof Ll&&e instanceof Ll&&t.firestore===e.firestore&&no(t._query,e._query)&&t.converter===e.converter}var Bl=function(){function t(){var t=this;this.fc=Promise.resolve(),this.dc=[],this.wc=!1,this._c=[],this.mc=null,this.yc=!1,this.gc=[],this.Zi=new Tc(this,"async_queue_retry"),this.Ec=function(){var e=bc();e&&kr("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=bc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ec)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this.wc},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Tc(),this.Ic(t)},t.prototype.enterRestrictedMode=function(){if(!this.wc){this.wc=!0;var t=bc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ec)}},t.prototype.enqueue=function(t){return this.Tc(),this.wc?new Promise((function(t){})):this.Ic(t)},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget((function(){return e.dc.push(t),e.Ac()}))},t.prototype.Ac=function(){return n(this,void 0,void 0,(function(){var t,e=this;return r(this,(function(n){switch(n.label){case 0:if(0===this.dc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.dc[0]()];case 2:return n.sent(),this.dc.shift(),this.Zi.reset(),[3,4];case 3:if(!Ta(t=n.sent()))throw t;return kr("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.dc.length>0&&this.Zi.ji((function(){return e.Ac()})),n.label=5;case 5:return[2]}}))}))},t.prototype.Ic=function(t){var e=this,n=this.fc.then((function(){return e.yc=!0,t().catch((function(t){throw e.mc=t,e.yc=!1,Cr("INTERNAL UNHANDLED ERROR: ",(r=(n=t).message||"",n.stack&&(r=n.stack.includes(n.message)?n.stack:n.message+"\n"+n.stack),r)),t;var n,r})).then((function(t){return e.yc=!1,t}))}));return this.fc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Tc(),this.gc.indexOf(t)>-1&&(e=0);var i=th.createAndSchedule(this,t,e,n,(function(t){return r.Rc(t)}));return this._c.push(i),i},t.prototype.Tc=function(){this.mc&&Or()},t.prototype.verifyOperationInProgress=function(){},t.prototype.bc=function(){return n(this,void 0,void 0,(function(){var t;return r(this,(function(e){switch(e.label){case 0:return[4,t=this.fc];case 1:e.sent(),e.label=2;case 2:if(t!==this.fc)return[3,0];e.label=3;case 3:return[2]}}))}))},t.prototype.vc=function(t){for(var e=0,n=this._c;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Pc=function(t){var e=this;return this.bc().then((function(){e._c.sort((function(t,e){return t.targetTimeMs-e.targetTimeMs}));for(var n=0,r=e._c;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.bc()}))},t.prototype.Vc=function(t){this.gc.push(t)},t.prototype.Rc=function(t){var e=this._c.indexOf(t);this._c.splice(e,1)},t}();function jl(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}var Kl=function(e){function n(t,n){var r=this;return(r=e.call(this,t,n)||this).type="firestore",r._queue=new Bl,r._persistenceKey="name"in t?t.name:"[DEFAULT]",r}return t(n,e),n.prototype._terminate=function(){return this._firestoreClient||zl(this),this._firestoreClient.terminate()},n}(Ol);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gl(t){return t._firestoreClient||zl(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function zl(t){var e,n,r,i,o,s=t._freezeSettings(),a=(n=t._databaseId,r=(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",i=t._persistenceKey,new yl(n,r,i,(o=s).host,o.ssl,o.experimentalForceLongPolling,o.experimentalAutoDetectLongPolling));t._firestoreClient=new rl(t._credentials,t._queue,a)}function Ql(t,e,i){var o=this,s=new va;return t.asyncQueue.enqueue((function(){return n(o,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,il(t,i)];case 1:return r.sent(),[4,ol(t,e)];case 2:return r.sent(),s.resolve(),[3,4];case 3:if(!("FirebaseError"===(o=n=r.sent()).name?o.code===Sr.FAILED_PRECONDITION||o.code===Sr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&o instanceof DOMException)||22===o.code||20===o.code||11===o.code))throw n;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+n),s.reject(n),[3,4];case 4:return[2]}var o}))}))})).then((function(){return s.promise}))}function Hl(t){if(t._initialized||t._terminated)throw new Dr(Sr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Wl=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Yr(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),Yl=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(Jr.fromBase64String(e))}catch(n){throw new Dr(Sr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}},t.fromUint8Array=function(e){return new t(Jr.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),Xl=function(t){this._methodName=t},Jl=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new Dr(Sr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Dr(Sr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return Vr(this._lat,t._lat)||Vr(this._long,t._long)},t}(),$l=/^__.*__$/,Zl=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new Lo(t,this.data,this.fieldMask,e,this.fieldTransforms):new Po(t,this.data,e,this.fieldTransforms)},t}(),tf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new Lo(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ef(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Or()}}var nf=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Sc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dc",{get:function(){return this.settings.Dc},enumerable:!1,configurable:!0}),t.prototype.Cc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.Nc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Cc({path:n,xc:!1});return r.Fc(t),r},t.prototype.kc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Cc({path:n,xc:!1});return r.Sc(),r},t.prototype.Oc=function(t){return this.Cc({path:void 0,xc:!0})},t.prototype.$c=function(t){return Ef(t,this.settings.methodName,this.settings.Mc||!1,this.path,this.settings.Lc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find((function(e){return t.isPrefixOf(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.isPrefixOf(e.field)}))},t.prototype.Sc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.Fc(this.path.get(t))},t.prototype.Fc=function(t){if(0===t.length)throw this.$c("Document fields must not be empty");if(ef(this.Dc)&&$l.test(t))throw this.$c('Document fields cannot begin and end with "__"')},t}(),rf=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||Ic(t)}return t.prototype.Bc=function(t,e,n,r){return void 0===r&&(r=!1),new nf({Dc:t,methodName:e,Lc:n,path:Yr.emptyPath(),xc:!1,Mc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function of(t){var e=t._freezeSettings(),n=Ic(t._databaseId);return new rf(t._databaseId,!!e.ignoreUndefinedProperties,n)}function sf(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Bc(o.merge||o.mergeFields?2:0,e,n,i);wf("Data must be an object, but it was:",s,r);var a,u,c=gf(r,s);if(o.merge)a=new Xr(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var d=bf(e,f[l],n);if(!s.contains(d))throw new Dr(Sr.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");_f(h,d)||h.push(d)}a=new Xr(h),u=s.fieldTransforms.filter((function(t){return a.covers(t.field)}))}else a=null,u=s.fieldTransforms;return new Zl(new Ti(c),a,u)}var af=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype._toFieldTransform=function(t){if(2!==t.Dc)throw 1===t.Dc?t.$c(this._methodName+"() can only appear at the top level of your update data"):t.$c(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},n.prototype.isEqual=function(t){return t instanceof n},n}(Xl);function uf(t,e,n){return new nf({Dc:3,Lc:e.settings.Lc,methodName:t._methodName,xc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var cf=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype._toFieldTransform=function(t){return new _o(t.path,new vo)},n.prototype.isEqual=function(t){return t instanceof n},n}(Xl),hf=function(e){function n(t,n){var r=this;return(r=e.call(this,t)||this).qc=n,r}return t(n,e),n.prototype._toFieldTransform=function(t){var e=uf(this,t,!0),n=this.qc.map((function(t){return vf(t,e)})),r=new go(n);return new _o(t.path,r)},n.prototype.isEqual=function(t){return this===t},n}(Xl),lf=function(e){function n(t,n){var r=this;return(r=e.call(this,t)||this).qc=n,r}return t(n,e),n.prototype._toFieldTransform=function(t){var e=uf(this,t,!0),n=this.qc.map((function(t){return vf(t,e)})),r=new wo(n);return new _o(t.path,r)},n.prototype.isEqual=function(t){return this===t},n}(Xl),ff=function(e){function n(t,n){var r=this;return(r=e.call(this,t)||this).Uc=n,r}return t(n,e),n.prototype._toFieldTransform=function(t){var e=new Io(t.R,ho(t.R,this.Uc));return new _o(t.path,e)},n.prototype.isEqual=function(t){return this===t},n}(Xl);function df(t,e,n,r){var i=t.Bc(1,e,n);wf("Data must be an object, but it was:",i,r);var o=[],s=Ti.empty();Gr(r,(function(t,r){var a=Tf(e,t,n);r=l(r);var u=i.kc(a);if(r instanceof af)o.push(a);else{var c=vf(r,u);null!=c&&(o.push(a),s.set(a,c))}}));var a=new Xr(o);return new tf(s,a,i.fieldTransforms)}function pf(t,e,n,r,i,o){var s=t.Bc(1,e,n),a=[bf(e,r,n)],u=[i];if(o.length%2!=0)throw new Dr(Sr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(bf(e,o[c])),u.push(o[c+1]);for(var h=[],f=Ti.empty(),d=a.length-1;d>=0;--d)if(!_f(h,a[d])){var p=a[d],y=u[d];y=l(y);var v=s.kc(p);if(y instanceof af)h.push(p);else{var g=vf(y,v);null!=g&&(h.push(p),f.set(p,g))}}var m=new Xr(h);return new tf(f,m,s.fieldTransforms)}function yf(t,e,n,r){return void 0===r&&(r=!1),vf(n,t.Bc(r?4:3,e))}function vf(t,e){if(mf(t=l(t)))return wf("Unsupported field value:",e,t),gf(t,e);if(t instanceof Xl)return function(t,e){if(!ef(e.Dc))throw e.$c(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.$c(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.xc&&4!==e.Dc)throw e.$c("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=vf(o[i],e.Oc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=l(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return ho(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Br.fromDate(t);return{timestampValue:ms(e.R,n)}}if(t instanceof Br)return n=new Br(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:ms(e.R,n)};if(t instanceof Jl)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Yl)return{bytesValue:ws(e.R,t._byteString)};if(t instanceof Pl){n=e.databaseId;var r=t.firestore._databaseId;if(!r.isEqual(n))throw e.$c("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:Ts(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.$c("Unsupported field value: "+kl(t))}(t,e)}function gf(t,e){var n={};return zr(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Gr(t,(function(t,r){var i=vf(r,e.Nc(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function mf(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Br||t instanceof Jl||t instanceof Yl||t instanceof Pl||t instanceof Xl)}function wf(t,e,n){if(!mf(n)||("object"!=typeof(i=n)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i))){var r=kl(n);throw"an object"===r?e.$c(t+" a custom object"):e.$c(t+" "+r)}var i}function bf(t,e,n){if((e=l(e))instanceof Wl)return e._internalPath;if("string"==typeof e)return Tf(t,e);throw Ef("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var If=new RegExp("[~\\*/\\[\\]]");function Tf(t,n,r){if(n.search(If)>=0)throw Ef("Invalid field path ("+n+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,r);try{return(new(Wl.bind.apply(Wl,e([void 0],n.split(".")))))._internalPath}catch(i){throw Ef("Invalid field path ("+n+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,r)}}function Ef(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new Dr(Sr.INVALID_ARGUMENT,(a+=". ")+t+u)}function _f(t,e){return t.some((function(t){return t.isEqual(e)}))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Sf=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Pl(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new Df(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.toProto())}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(Nf("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),Df=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.data=function(){return e.prototype.data.call(this)},n}(Sf);function Nf(t,e){return"string"==typeof e?Tf(t,e):e instanceof Wl?e._internalPath:e._delegate._internalPath}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Af=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),kf=function(e){function n(t,n,r,i,o,s){var a=this;return(a=e.call(this,t,n,r,i,s)||this)._firestore=t,a._firestoreImpl=t,a.metadata=o,a}return t(n,e),n.prototype.exists=function(){return e.prototype.exists.call(this)},n.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new Cf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.toProto(),t.serverTimestamps)}},n.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(Nf("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},n}(Sf),Cf=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.data=function(t){return void 0===t&&(t={}),e.prototype.data.call(this,t)},n}(kf),xf=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Af(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach((function(r){t.call(e,new Cf(n._firestore,n._userDataWriter,r.key,r,new Af(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))}))},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Dr(Sr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map((function(e){var r=new Cf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Af(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);return e.doc,{type:"added",doc:r,oldIndex:-1,newIndex:n++}}))}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var n=new Cf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Af(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:Rf(e.type),doc:n,oldIndex:i,newIndex:o}}))}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function Rf(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Or()}}function Of(t,e){return t instanceof kf&&e instanceof kf?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof xf&&e instanceof xf&&t._firestore===e._firestore&&ql(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pf(t){if(Yi(t)&&0===t.explicitOrderBy.length)throw new Dr(Sr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Lf=function(){};function Mf(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o._apply(t)}return t}var Ff=function(e){function n(t,n,r){var i=this;return(i=e.call(this)||this).Qc=t,i.Kc=n,i.jc=r,i.type="where",i}return t(n,e),n.prototype._apply=function(t){var e,n,r,i=of(t.firestore),o=function(t,e,n,r,i,o,s){var a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){Gf(s,o);for(var u=[],c=0,h=s;c<h.length;c++){var l=h[c];u.push(Kf(r,t,l))}a={arrayValue:{values:u}}}else a=Kf(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||Gf(s,o),a=yf(n,"where",s,"in"===o||"not-in"===o);var f=Ci.create(i,o,a);return function(t,e){if(e.g()){var n=Ji(t);if(null!==n&&!n.isEqual(e.field))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=Xi(t);null!==r&&zf(t,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw i===e.op?new Dr(Sr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new Dr(Sr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,f),f}(t._query,0,i,t.firestore._databaseId,this.Qc,this.Kc,this.jc);return new Ll(t.firestore,t.converter,(e=t._query,n=o,r=e.filters.concat([n]),new zi(e.path,e.collectionGroup,e.explicitOrderBy.slice(),r,e.limit,e.limitType,e.startAt,e.endAt)))},n}(Lf),Vf=function(e){function n(t,n){var r=this;return(r=e.call(this)||this).Qc=t,r.Wc=n,r.type="orderBy",r}return t(n,e),n.prototype._apply=function(t){var e,n,r,i=function(t,e,n){if(null!==t.startAt)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Bi(e,n);return function(t,e){if(null===Xi(t)){var n=Ji(t);null!==n&&zf(t,n,e.field)}}(t,r),r}(t._query,this.Qc,this.Wc);return new Ll(t.firestore,t.converter,(e=t._query,n=i,r=e.explicitOrderBy.concat([n]),new zi(e.path,e.collectionGroup,r,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)))},n}(Lf),Uf=function(e){function n(t,n,r){var i=this;return(i=e.call(this)||this).type=t,i.Gc=n,i.zc=r,i}return t(n,e),n.prototype._apply=function(t){return new Ll(t.firestore,t.converter,eo(t._query,this.Gc,this.zc))},n}(Lf),qf=function(e){function n(t,n,r){var i=this;return(i=e.call(this)||this).type=t,i.Hc=n,i.Jc=r,i}return t(n,e),n.prototype._apply=function(t){var e,n,r=jf(t,this.type,this.Hc,this.Jc);return new Ll(t.firestore,t.converter,(e=t._query,n=r,new zi(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,n,e.endAt)))},n}(Lf),Bf=function(e){function n(t,n,r){var i=this;return(i=e.call(this)||this).type=t,i.Hc=n,i.Jc=r,i}return t(n,e),n.prototype._apply=function(t){var e,n,r=jf(t,this.type,this.Hc,this.Jc);return new Ll(t.firestore,t.converter,(e=t._query,n=r,new zi(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,n)))},n}(Lf);function jf(t,e,n,r){if(n[0]=l(n[0]),n[0]instanceof Sf)return function(t,e,n,r,i){if(!r)throw new Dr(Sr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=Zi(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push(vi(e,r.key));else{var c=r.data.field(u.field);if(ni(c))throw new Dr(Sr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=u.field.canonicalString();throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new Ui(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var i=of(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new Dr(Sr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!$i(t)&&-1!==c.indexOf("/"))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Hr.fromString(c));if(!ui.isDocumentKey(h))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var l=new ui(h);a.push(vi(e,l))}else{var f=yf(n,r,c);a.push(f)}}return new Ui(a,o)}(t._query,t.firestore._databaseId,i,e,n,r)}function Kf(t,e,n){if("string"==typeof(n=l(n))){if(""===n)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!$i(e)&&-1!==n.indexOf("/"))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(Hr.fromString(n));if(!ui.isDocumentKey(r))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return vi(t,new ui(r))}if(n instanceof Pl)return vi(t,n._key);throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+kl(n)+".")}function Gf(t,e){if(!Array.isArray(t)||0===t.length)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function zf(t,e,n){if(!n.isEqual(e))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Qf=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),ci(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ti(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(ei(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Or()}},t.prototype.convertObject=function(t,e){var n=this,r={};return Gr(t.fields||{},(function(t,i){r[t]=n.convertValue(i,e)})),r},t.prototype.convertGeoPoint=function(t){return new Jl(ti(t.latitude),ti(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map((function(t){return n.convertValue(t,e)}))},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=ri(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(ii(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=Zr(t);return new Br(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=Hr.fromString(t);Pr(Qs(n));var r=new vl(n.get(1),n.get(3)),i=new ui(n.popFirst(5));return r.isEqual(e)||Cr("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hf(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Wf=function(e){function n(t){var n=this;return(n=e.call(this)||this).firestore=t,n}return t(n,e),n.prototype.convertBytes=function(t){return new Yl(t)},n.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Pl(this.firestore,null,e)},n}(Qf),Yf=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=of(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=Xf(t,this._firestore),i=Hf(r.converter,e,n),o=sf(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,Do.none())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();var o,s=Xf(t,this._firestore);return o="string"==typeof(e=l(e))||e instanceof Wl?pf(this._dataReader,"WriteBatch.update",s._key,e,n,r):df(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,Do.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=Xf(t,this._firestore);return this._mutations=this._mutations.concat(new Bo(e._key,Do.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new Dr(Sr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xf(t,e){if((t=l(t)).firestore!==e)throw new Dr(Sr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Jf=function(e){function n(t){var n=this;return(n=e.call(this)||this).firestore=t,n}return t(n,e),n.prototype.convertBytes=function(t){return new Yl(t)},n.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Pl(this.firestore,null,e)},n}(Qf);function $f(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=Cl(t,Pl);var o=Cl(t.firestore,Kl),s=of(o);return td(o,[("string"==typeof(e=l(e))||e instanceof Wl?pf(s,"updateDoc",t._key,e,n,r):df(s,"updateDoc",t._key,e)).toMutation(t._key,Do.exists(!0))])}function Zf(t){for(var e,i,o,s=[],a=1;a<arguments.length;a++)s[a-1]=arguments[a];t=l(t);var u={includeMetadataChanges:!1},c=0;"object"!=typeof s[c]||jl(s[c])||(u=s[c],c++);var h,f,d,p={includeMetadataChanges:u.includeMetadataChanges};if(jl(s[c])){var y=s[c];s[c]=null===(e=y.next)||void 0===e?void 0:e.bind(y),s[c+1]=null===(i=y.error)||void 0===i?void 0:i.bind(y),s[c+2]=null===(o=y.complete)||void 0===o?void 0:o.bind(y)}if(t instanceof Pl)f=Cl(t.firestore,Kl),d=Hi(t._key.path),h={next:function(e){s[c]&&s[c](ed(f,t,e))},error:s[c+1],complete:s[c+2]};else{var v=Cl(t,Ll);f=Cl(v.firestore,Kl),d=v._query;var g=new Jf(f);h={next:function(t){s[c]&&s[c](new xf(f,g,v,t))},error:s[c+1],complete:s[c+2]},Pf(t._query)}return function(t,e,i,o){var s=this,a=new tl(o),u=new fh(e,a,i);return t.asyncQueue.enqueueAndForget((function(){return n(s,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return e=ah,[4,fl(t)];case 1:return[2,e.apply(void 0,[n.sent(),u])]}}))}))})),function(){a.Wo(),t.asyncQueue.enqueueAndForget((function(){return n(s,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return e=uh,[4,fl(t)];case 1:return[2,e.apply(void 0,[n.sent(),u])]}}))}))}))}}(Gl(f),d,p,h)}function td(t,e){return function(t,e){var i=this,o=new va;return t.asyncQueue.enqueueAndForget((function(){return n(i,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:return n=Th,[4,ll(t)];case 1:return[2,n.apply(void 0,[r.sent(),e,o])]}}))}))})),o.promise}(Gl(t),e)}function ed(t,e,n){var r=n.docs.get(e._key),i=new Jf(t);return new kf(t,i,e._key,r,new Af(n.hasPendingWrites,n.fromCache),e.converter)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nd=function(e){function n(t,n){var r=this;return(r=e.call(this,t,n)||this)._firestore=t,r}return t(n,e),n.prototype.get=function(t){var n=this,r=Xf(t,this._firestore),i=new Jf(this._firestore);return e.prototype.get.call(this,t).then((function(t){return new kf(n._firestore,i,r._key,t._document,new Af(!1,!1),r.converter)}))},n}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=of(t)}return t.prototype.get=function(t){var e=this,n=Xf(t,this._firestore),r=new Wf(this._firestore);return this._transaction.lookup([n._key]).then((function(t){if(!t||1!==t.length)return Or();var i=t[0];if(i.isFoundDocument())return new Sf(e._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new Sf(e._firestore,r,n._key,null,n.converter);throw Or()}))},t.prototype.set=function(t,e,n){var r=Xf(t,this._firestore),i=Hf(r.converter,e,n),o=sf(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,s=Xf(t,this._firestore);return o="string"==typeof(e=l(e))||e instanceof Wl?pf(this._dataReader,"Transaction.update",s._key,e,n,r):df(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,o),this},t.prototype.delete=function(t){var e=Xf(t,this._firestore);return this._transaction.delete(e._key),this},t}());
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rd(){if("undefined"==typeof Uint8Array)throw new Dr(Sr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function id(){if("undefined"==typeof atob)throw new Dr(Sr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var od=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return id(),new t(Yl.fromBase64String(e))},t.fromUint8Array=function(e){return rd(),new t(Yl.fromUint8Array(e))},t.prototype.toBase64=function(){return id(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return rd(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),sd=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){Hl(t=Cl(t,Kl));var n=Gl(t),r=t._freezeSettings(),i=new Zh;return Ql(n,i,new Jh(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){Hl(t=Cl(t,Kl));var e=Gl(t),n=t._freezeSettings(),r=new Zh;return Ql(e,r,new $h(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new Dr(Sr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var i=new va;return t._queue.enqueueAndForgetEvenWhileRestricted((function(){return n(e,void 0,void 0,(function(){var e;return r(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t){return n(this,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return wa.yt()?(e=t+"main",[4,wa.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}}))}))}(Cu(t._databaseId,t._persistenceKey))];case 1:return o.sent(),i.resolve(),[3,3];case 2:return e=o.sent(),i.reject(e),[3,3];case 3:return[2]}}))}))})),i.promise}(t._delegate)},t}(),ad=function(){function t(t,e,n){var r=this;this._delegate=e,this.Yc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof vl||(this.Xc=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this._delegate._getSettings()),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e,n){void 0===n&&(n={}),function(t,e,n,r){void 0===r&&(r={});var i=(t=Cl(t,Ol))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&xr("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},i),{host:e+":"+n,ssl:!1})),r.mockUserToken){var o=f(r.mockUserToken),s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new Dr(Sr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t._credentials=new bl(new ml(o,new rc(s)))}}(this._delegate,t,e,n)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return n(e,void 0,void 0,(function(){var e,n;return r(this,(function(r){switch(r.label){case 0:return[4,ul(t)];case 1:return e=r.sent(),[4,hl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),i=n,o=Lr(i),o.$r.delete(0),kc(o))]}var i,o}))}))}))}(Gl(Cl(this._delegate,Kl)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return n(e,void 0,void 0,(function(){var e,i;return r(this,(function(o){switch(o.label){case 0:return[4,ul(t)];case 1:return e=o.sent(),[4,hl(t)];case 2:return i=o.sent(),[2,(e.setNetworkEnabled(!1),function(t){return n(this,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return(e=Lr(t)).$r.add(0),[4,Cc(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}}))}))}(i))]}}))}))}))}(Gl(Cl(this._delegate,Kl)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&Dl("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Yc.enableMultiTabIndexedDbPersistence(this):this.Yc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Yc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.Xc&&(this.Xc._removeServiceInstance("firestore"),this.Xc._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,i=new va;return t.asyncQueue.enqueueAndForget((function(){return n(e,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return e=Ah,[4,ll(t)];case 1:return[2,e.apply(void 0,[n.sent(),i])]}}))}))})),i.promise}(Gl(Cl(this._delegate,Kl)))},t.prototype.onSnapshotsInSync=function(t){return e=this._delegate,i=t,function(t,e){var i=this,o=new tl(e);return t.asyncQueue.enqueueAndForget((function(){return n(i,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return e=function(t,e){Lr(t).Gr.add(e),e.next()},[4,fl(t)];case 1:return[2,e.apply(void 0,[n.sent(),o])]}}))}))})),function(){o.Wo(),t.asyncQueue.enqueueAndForget((function(){return n(i,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return e=function(t,e){Lr(t).Gr.delete(e)},[4,fl(t)];case 1:return[2,e.apply(void 0,[n.sent(),o])]}}))}))}))}}(Gl(e=Cl(e,Kl)),jl(i)?i:{next:i});var e,i},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.Xc)throw new Dr(Sr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Xc},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Id(this,Fl(this._delegate,t))}catch(e){throw dd(e,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new fd(this,Vl(this._delegate,t))}catch(e){throw dd(e,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new md(this,function(t,e){if(t=Cl(t,Ol),_l("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new Ll(t,null,(n=e,new zi(Hr.emptyPath(),n)));var n}(this._delegate,t))}catch(e){throw dd(e,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e,i=this;return function(t,e){var i=this,o=new va;return t.asyncQueue.enqueueAndForget((function(){return n(i,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:return[4,(i=t,al(i).then((function(t){return t.datastore})))];case 1:return n=r.sent(),new nl(t.asyncQueue,n,e,o).run(),[2]}var i}))}))})),o.promise}(Gl(e=this._delegate),(function(n){return function(e){return t(new cd(i,e))}(new nd(e,n))}))},t.prototype.batch=function(){var t=this;return Gl(this._delegate),new hd(new Yf(this._delegate,(function(e){return td(t._delegate,e)})))},t.prototype.loadBundle=function(t){throw new Dr(Sr.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new Dr(Sr.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),ud=function(e){function n(t){var n=this;return(n=e.call(this)||this).firestore=t,n}return t(n,e),n.prototype.convertBytes=function(t){return new od(new Yl(t))},n.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return fd.Zc(e,this.firestore,null)},n}(Qf);var cd=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new ud(t)}return t.prototype.get=function(t){var e=this,n=Td(t);return this._delegate.get(n).then((function(t){return new vd(e._firestore,new kf(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))}))},t.prototype.set=function(t,e,n){var r=Td(t);return n?(Sl("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,n,r){for(var i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];var a=Td(t);return 2===arguments.length?this._delegate.update(a,n):(i=this._delegate).update.apply(i,e([a,n,r],o)),this},t.prototype.delete=function(t){var e=Td(t);return this._delegate.delete(e),this},t}(),hd=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=Td(t);return n?(Sl("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,n,r){for(var i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];var a=Td(t);return 2===arguments.length?this._delegate.update(a,n):(i=this._delegate).update.apply(i,e([a,n,r],o)),this},t.prototype.delete=function(t){var e=Td(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),ld=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new Cf(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new gd(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.tu=function(e,n){var r=t.eu,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new ud(e),n),i.set(n,o)),o},t}();ld.eu=new WeakMap;var fd=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new ud(t)}return t.nu=function(e,n,r){if(e.length%2!=0)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new Pl(n._delegate,r,new ui(e)))},t.Zc=function(e,n,r){return new t(n,new Pl(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Id(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Id(this.firestore,Fl(this._delegate,t))}catch(e){throw dd(e,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=l(t))instanceof Pl&&Ul(this._delegate,t)},t.prototype.set=function(t,e){e=Sl("DocumentReference.set",e);try{return function(t,e,n){t=Cl(t,Pl);var r=Cl(t.firestore,Kl),i=Hf(t.converter,e,n);return td(r,[sf(of(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,Do.none())])}(this._delegate,t,e)}catch(n){throw dd(n,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];try{return 1===arguments.length?$f(this._delegate,t):$f.apply(void 0,e([this._delegate,t,n],r))}catch(o){throw dd(o,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return td(Cl((t=this._delegate).firestore,Kl),[new Bo(t._key,Do.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=pd(e),i=yd(e,(function(e){return new vd(t.firestore,new kf(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))}));return Zf(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Cl(t,Pl);var e=Cl(t.firestore,Kl),i=Gl(e),o=new Jf(e);return function(t,e){var i=this,o=new va;return t.asyncQueue.enqueueAndForget((function(){return n(i,void 0,void 0,(function(){var i;return r(this,(function(s){switch(s.label){case 0:return i=function(t,e,i){return n(this,void 0,void 0,(function(){var n,o;return r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,(s=t,a=e,u=Lr(s),u.persistence.runTransaction("read document","readonly",(function(t){return u.Mn.mn(t,a)})))];case 1:return(o=r.sent()).isFoundDocument()?i.resolve(o):o.isNoDocument()?i.resolve(null):i.reject(new Dr(Sr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return n=r.sent(),o=eh(n,"Failed to get document '"+e+" from cache"),i.reject(o),[3,3];case 3:return[2]}var s,a,u}))}))},[4,cl(t)];case 1:return[2,i.apply(void 0,[s.sent(),e,o])]}}))}))})),o.promise}(i,t._key).then((function(n){return new kf(e,o,t._key,n,new Af(null!==n&&n.hasLocalMutations,!0),t.converter)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Cl(t,Pl);var e=Cl(t.firestore,Kl);return dl(Gl(e),t._key,{source:"server"}).then((function(n){return ed(e,t,n)}))}(this._delegate):function(t){t=Cl(t,Pl);var e=Cl(t.firestore,Kl);return dl(Gl(e),t._key).then((function(n){return ed(e,t,n)}))}(this._delegate)).then((function(t){return new vd(e.firestore,new kf(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))}))},t.prototype.withConverter=function(e){return new t(this.firestore,e?this._delegate.withConverter(ld.tu(this.firestore,e)):this._delegate.withConverter(null))},t}();function dd(t,e,n){return t.message=t.message.replace(e,n),t}function pd(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!jl(r))return r}return{}}function yd(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=jl(t[0])?t[0]:jl(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var vd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new fd(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return Of(this._delegate,t._delegate)},t}(),gd=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.data=function(t){return this._delegate.data(t)},n}(vd),md=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new ud(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,Mf(this._delegate,(o=r,s=i=n,a=Nf("where",e),new Ff(a,s,o))))}catch(i){throw dd(i,/(orderBy|where)\(\)/,"Query.$1()")}var i,o,s,a},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,Mf(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=Nf("orderBy",t);return new Vf(r,n)}(e,n)))}catch(r){throw dd(r,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,Mf(this._delegate,(xl("limit",n=e),new Uf("limit",n,"F"))))}catch(r){throw dd(r,"limit()","Query.limit()")}var n},t.prototype.limitToLast=function(e){try{return new t(this.firestore,Mf(this._delegate,(xl("limitToLast",n=e),new Uf("limitToLast",n,"L"))))}catch(r){throw dd(r,"limitToLast()","Query.limitToLast()")}var n},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Mf(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new qf("startAt",t,!0)}.apply(void 0,e)))}catch(r){throw dd(r,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Mf(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new qf("startAfter",t,!1)}.apply(void 0,e)))}catch(r){throw dd(r,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Mf(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Bf("endBefore",t,!0)}.apply(void 0,e)))}catch(r){throw dd(r,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Mf(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Bf("endAt",t,!1)}.apply(void 0,e)))}catch(r){throw dd(r,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return ql(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Cl(t,Ll);var e=Cl(t.firestore,Kl),i=Gl(e),o=new Jf(e);return function(t,e){var i=this,o=new va;return t.asyncQueue.enqueueAndForget((function(){return n(i,void 0,void 0,(function(){var i;return r(this,(function(s){switch(s.label){case 0:return i=function(t,e,i){return n(this,void 0,void 0,(function(){var n,o,s,a,u;return r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,Ku(t,e,!0)];case 1:return u=r.sent(),n=new yh(e,u.Bn),o=n._o(u.documents),s=n.applyChanges(o,!1),i.resolve(s.snapshot),[3,3];case 2:return a=r.sent(),u=eh(a,"Failed to execute query '"+e+" against cache"),i.reject(u),[3,3];case 3:return[2]}}))}))},[4,cl(t)];case 1:return[2,i.apply(void 0,[s.sent(),e,o])]}}))}))})),o.promise}(i,t._query).then((function(n){return new xf(e,o,t,n)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Cl(t,Ll);var e=Cl(t.firestore,Kl),n=Gl(e),r=new Jf(e);return pl(n,t._query,{source:"server"}).then((function(n){return new xf(e,r,t,n)}))}(this._delegate):function(t){t=Cl(t,Ll);var e=Cl(t.firestore,Kl),n=Gl(e),r=new Jf(e);return Pf(t._query),pl(n,t._query).then((function(n){return new xf(e,r,t,n)}))}(this._delegate)).then((function(t){return new bd(e.firestore,new xf(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))}))},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=pd(e),i=yd(e,(function(e){return new bd(t.firestore,new xf(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))}));return Zf(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,e?this._delegate.withConverter(ld.tu(this.firestore,e)):this._delegate.withConverter(null))},t}(),wd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new gd(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),bd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new md(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map((function(e){return new gd(t._firestore,e)}))},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map((function(t){return new wd(e._firestore,t)}))},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach((function(r){t.call(e,new gd(n._firestore,r))}))},t.prototype.isEqual=function(t){return Of(this._delegate,t._delegate)},t}(),Id=function(e){function n(t,n){var r=this;return(r=e.call(this,t,n)||this).firestore=t,r._delegate=n,r}return t(n,e),Object.defineProperty(n.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new fd(this.firestore,t):null},enumerable:!1,configurable:!0}),n.prototype.doc=function(t){try{return new fd(this.firestore,void 0===t?Vl(this._delegate):Vl(this._delegate,t))}catch(e){throw dd(e,"doc()","CollectionReference.doc()")}},n.prototype.add=function(t){var e,n,r,i,o,s=this;return(e=this._delegate,n=t,r=Cl(e.firestore,Kl),i=Vl(e),o=Hf(e.converter,n),td(r,[sf(of(e.firestore),"addDoc",i._key,o,null!==e.converter,{}).toMutation(i._key,Do.exists(!1))]).then((function(){return i}))).then((function(t){return new fd(s.firestore,t)}))},n.prototype.isEqual=function(t){return Ul(this._delegate,t._delegate)},n.prototype.withConverter=function(t){return new n(this.firestore,t?this._delegate.withConverter(ld.tu(this.firestore,t)):this._delegate.withConverter(null))},n}(md);function Td(t){return Cl(t,Pl)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ed,_d=function(){function t(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._delegate=new(Wl.bind.apply(Wl,e([void 0],t)))}return t.documentId=function(){return new t(Yr.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=l(t))instanceof Wl&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),Sd=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new cf("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new af("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new hf("arrayUnion",t)}.apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new lf("arrayRemove",t)}.apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=new ff("increment",e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}(),Dd={Firestore:ad,GeoPoint:Jl,Timestamp:Br,Blob:od,Transaction:cd,WriteBatch:hd,DocumentReference:fd,DocumentSnapshot:vd,Query:md,QueryDocumentSnapshot:gd,QuerySnapshot:bd,CollectionReference:Id,FieldPath:_d,FieldValue:Sd,setLogLevel:function(t){var e;e=t,Nr.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};(Ed=v).INTERNAL.registerComponent(new y("firestore",(function(t){return function(t,e){return new ad(t,new Kl(t,e),new sd)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))}),"PUBLIC").setServiceProps(Object.assign({},Dd))),Ed.registerVersion("@firebase/firestore","2.3.0");
